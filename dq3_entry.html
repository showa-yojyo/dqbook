<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>5.15. 仲間登録所解析</title>
    <link rel="stylesheet" type="text/css" href="dqbook.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="home" href="index.html" title="ドラクエ命" />
    <link rel="up" href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)" />
    <link rel="prev" href="dq3_pub.html" title="5.14. ルイーダの酒場解析" />
    <link rel="next" href="dq3_bank.html" title="5.16. ゴールド銀行解析" />
  </head>
  <body>
    <div class="navigation"><table><tr><td class="online-navigation"><a href="dq3_pub.html" title="5.14. ルイーダの酒場解析"><img src="image/docbook/prev.png" alt="戻る" /></a></td><td class="online-navigation"><a href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)"><img src="image/docbook/up.png" alt="上に戻る" /></a></td><td class="online-navigation"><a href="dq3_bank.html" title="5.16. ゴールド銀行解析"><img src="image/docbook/next.png" alt="次へ" /></a></td><td>ドラクエ命</td><td class="online-navigation"><a href="index.html" title="ドラクエ命"><img src="image/docbook/home.png" alt="ホーム" /></a></td><td class="online-navigation"><a href="" title=""><img src="image/docbook/index.png" alt="索引" /></a></td></tr></table><b class="navlabel">Previous: </b><a accesskey="p" class="sectref" href="dq3_pub.html">5.14. ルイーダの酒場解析</a> <b class="navlabel">Up: </b><a accesskey="u" class="sectref" href="dq3.html">第 5 章 SFC 版ドラクエ 3 (1996)</a> <b class="navlabel">Next: </b><a accesskey="n" class="sectref" href="dq3_bank.html">5.16. ゴールド銀行解析</a><hr /></div>
    <div class="section">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a id="dq3.entry"></a>5.15. 仲間登録所解析</h2>
          </div>
        </div>
      </div>
      <div class="toc">
        <dl class="toc">
          <dt>
            <span class="section">
              <a href="dq3_entry.html#dq3.entry.hack">5.15.1. 解析</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="dq3_entry.html#dq3.entry.hack.C3DAEB">5.15.1.1. 登録所共通処理サブルーチン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_entry.html#dq3.entry.hack.C3DD13">5.15.1.2. キャラクター削除サブルーチン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_entry.html#dq3.entry.hack.C3DDBF">5.15.1.3. 入力が仲間の名前と同じかチェック</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_entry.html#dq3.entry.hack.C3DE20">5.15.1.4. パラメータ増加処理サブルーチン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_entry.html#dq3.entry.hack.C3DE95">5.15.1.5. 性格決定サブルーチン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_entry.html#dq3.entry.hack.C3E2D0">5.15.1.6. 登録屋が性格を告げるサブルーチン</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="section">
              <a href="dq3_entry.html#dq3.entry.data">5.15.2. データ</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="dq3_entry.html#dq3.entry.data.C30EFD">5.15.2.1. <code class="varname">$C30EFD</code> 構造体 - 登録所・性格条件群</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_entry.html#dq3.entry.data.C30FFC">5.15.2.2. <code class="varname">$C30FFC</code> 構造体 - 登録所・性格群</a>
                </span>
              </dt>
            </dl>
          </dd>
        </dl>
      </div>
      <a id="term.dq3.entry" class="indexterm"></a>
      <p>
	このセクションではルイーダの酒場二階に開設されている登録所の処理を解析する。
	新規キャラクターの追加処理において、リメイク版は、オリジナル版とは決定的に違う処理を含んでいる。
	それはタネ・木の実による能力パラメーターの調整処理であり、それに依存する初期性格の決定という処理が伴う。
	この過程を可能な限り詳細に調査していこう。
</p>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="dq3.entry.hack"></a>5.15.1. 解析</h3>
            </div>
          </div>
        </div>
        <p>
	まだアリアハン王に旅立ちの報告を済ませていない等の、特殊なイベント中でない限り、
	登録屋に「はなす」とすぐに<a class="link" href="dq3_entry.html#dq3.entry.hack.C3DAEB" title="5.15.1.1. 登録所共通処理サブルーチン">登録所共通処理サブルーチン</a>が開始する。
	ここから処理をたどっていき、どのように仲間キャラクターが追加・削除されるのかを調べていく。
</p>
        <p>
	<a class="link" href="dq3_entry.html#dq3.entry.hack.C3DAEB" title="5.15.1.1. 登録所共通処理サブルーチン">登録所共通処理サブルーチン</a>および、
	それが呼び出すすべてのサブルーチンは、
	登録屋による台詞表示と、
	システムメッセージ表示には、
	メッセージ表示サブルーチンとして <code class="varname">$C1A92E</code> と
	<code class="varname">$C1A8D4</code> をそれぞれ用いるようだ。
	この事実を利用して、逆アセンブルコードと台詞メッセージ表とをにらめっこしながら処理を読み解いていくことになる。
</p>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.entry.hack.C3DAEB"></a>5.15.1.1. 登録所共通処理サブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$C3DAEB</code> は、登録屋に「はなす」と通常始まる処理だ。
	キャラクター新規追加処理をメインとするプログラムの体裁をとっている。
	一枚岩の長いアセンブリコードを文章化すると、大体以下のような感じになった。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			台詞「ここは冒険者たちの登録所」(ID: <code class="literal">#$0B31</code>) を表示する。
		</p>
              </li>
              <li class="listitem">
                <p>
			フラグチェックサブルーチン <code class="varname">$C909AE</code> を呼び出し、
			<code class="varname">$7E353A</code> の最下位ビットから見て <code class="literal">#$0014</code> ビット目をテストする。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					フラグが未セット⇒
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							台詞「あなたが仲間にしたい人をさがしだし～」(ID: <code class="literal">#$0B32</code>) を表示する。
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							フラグセットサブルーチン <code class="varname">$C908F0</code> を呼び出し、
							<code class="varname">$7E353A</code> の最下位ビットから見て <code class="literal">#$0014</code> ビット目をセットする。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			台詞「新しい人を名簿に登録しますか」(ID: <code class="literal">#$0B33</code>) を表示する。
		</p>
              </li>
              <li class="listitem">
                <p>
			「はい・いいえ」ウィンドウを表示して、プレイヤーの入力を待つ。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					キャンセルボタン or 「いいえ」⇒【またおいで】へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【新しく登録する】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<a class="link" href="dq3_entry.html#dq3.entry.hack.C3DD13" title="5.15.1.2. キャラクター削除サブルーチン">キャラクター削除サブルーチン <code class="varname">$C3DD13</code></a> を呼び出す。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャラクターがいっぱいだが、削除しなかった ⇒【またおいで】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					台詞「どんな人をご希望ですか？」(ID: <code class="literal">#$0B34</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					サブルーチン <code class="varname">$C3C345</code> を呼び出すことで、名前文字列入力用バッファを初期化する。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【名前入力ループ】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					「なまえをいれてください」ウィンドウを表示し、プレイヤーの入力を待つ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャンセルボタン ⇒【まだ登録する？】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					サブルーチン <code class="varname">$C3C37F</code> を呼び出し、
					<span class="emphasis"><em>プレイヤーが入力した文字列を配列 <code class="varname">$3332,X</code> にコピーする。</em></span>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					ロトテストサブルーチン <code class="varname">$C3C66B</code> を呼び出し、
					入力した名前が「ロト」「ろと」「ロと」……等（アドレス <code class="varname">$C3C6A4</code> で定義）とマッチしないかテストする。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							マッチしない ⇒【入力と予約名と照合】へジャンプ。
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							マッチする ⇒ 
						</p>
                            <div class="itemizedlist">
                              <ul class="itemizedlist" style="list-style-type: disc; ">
                                <li class="listitem">
                                  <p>
									台詞「ロト！？ ロトでございますか！？」(ID: <code class="literal">#$09C8</code>) を表示する。
								</p>
                                </li>
                                <li class="listitem">
                                  <p>
									【名前入力ループ】へジャンプ。<span class="emphasis"><em>入力ウィンドウは変更されていない。</em></span>
								</p>
                                </li>
                              </ul>
                            </div>
                          </li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【入力と予約名と照合】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<a class="link" href="dq3_rename.html#dq3.rename.hack.C3EB3F" title="5.18.1.3. 入力が予約名かどうかチェック">サブルーチン <code class="varname">$C3EB3F</code></a> を呼び出して、
					入力が予約名かどうかチェックする。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							入力が予約名でない ⇒【入力と同名のキャラクター検索】へジャンプ。
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							入力が予約名である ⇒
						</p>
                            <div class="itemizedlist">
                              <ul class="itemizedlist" style="list-style-type: disc; ">
                                <li class="listitem">
                                  <p>
									台詞「申し訳ありませんがその名前の人を～」(ID: <code class="literal">#$0B45</code>) を表示する。
								</p>
                                </li>
                                <li class="listitem">
                                  <p>
									【別の人を探す？】へジャンプ。
								</p>
                                </li>
                              </ul>
                            </div>
                          </li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【入力と同名のキャラクター検索】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					サブルーチン <code class="varname">$C3DDBF</code> を呼び出して、入力と同じ名前の仲間キャラクターがいるかテストする。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							いない ⇒【同名チェックをクリア】へジャンプ。
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							いる ⇒
						</p>
                            <div class="itemizedlist">
                              <ul class="itemizedlist" style="list-style-type: disc; ">
                                <li class="listitem">
                                  <p>
									台詞「その人ならすでに登録されていますが」(ID: <code class="literal">#$0B44</code>) を表示する。
								</p>
                                </li>
                                <li class="listitem">
                                  <p>
									【別の人を探す？】へジャンプ。
								</p>
                                </li>
                              </ul>
                            </div>
                          </li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【別の人を探す？】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					「はい・いいえ」ウィンドウを表示して、プレイヤーの入力を待つ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャンセルボタン or 「いいえ」⇒【またおいで】へジャンプ。
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							「はい」⇒【新しく登録する】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【同名チェックをクリア】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					「おとこ・おんな」ウィンドウを表示して、プレイヤーの入力を待つ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャンセルボタン ⇒【名前入力ループ】へジャンプ。<span class="emphasis"><em>入力ウィンドウは変更されていない。</em></span>
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					サブルーチン <code class="varname">$C3C3D5</code> を呼び出して、プレイヤーの入力を
					「おとこ」だったら <code class="literal">0</code> へ、「おんな」だったら <code class="literal">1</code> へ変換する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">$405F = A;</code> 性別
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					職業リストウィンドウを表示して、プレイヤーの入力を待つ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャンセルボタン ⇒【同名チェックをクリア】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			<code class="code">$4063 = A;</code> 職業 ID
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">$4061 = 0;</code> 詳細不明
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">$4054 = 2;</code> 詳細不明
		</p>
              </li>
              <li class="listitem">
                <p>
			サブルーチン <code class="varname">$C441AE</code> を呼び出し、
			新規作成キャラクターのデータ格納領域を <code class="varname">$3925</code> 系統のアドレスに割り当てる
			（同時に決定分のパラメータをセットする）。
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">$2BB4 = A;</code> キャラクターのデータアドレス
		</p>
              </li>
              <li class="listitem">
                <p>
			サブルーチン <code class="varname">$C42F5E</code> を呼び出し、
			キャラクター (<code class="varname">A</code>) の ID を取得 (<code class="varname">A</code>) する。
		</p>
              </li>
              <li class="listitem">
                <p>
			新規作成キャラクター (<code class="varname">A</code>) の名前・職業・性別・レベルを表示するウィンドウと、
			ちから～さいだいＭＰまでのパラメータリストを表示するウィンドウを表示する。
		</p>
              </li>
              <li class="listitem">
                <p>
			台詞「ご希望の条件だとこの人が見つかりましたが～」(ID: <code class="literal">#$0B35</code>) を表示する。
		</p>
              </li>
              <li class="listitem">
                <p>
			「はい・いいえ」ウィンドウを表示して、プレイヤーの入力を待つ。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					キャンセルボタン or 「いいえ」⇒【その人ではダメ】へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			フラグチェックサブルーチン <code class="varname">$C909AE</code> を呼び出し、
			<code class="varname">$7E353A</code> の最下位ビットから見て <code class="literal">#$0015</code> ビット目をテストする。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					フラグが未セット⇒
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							台詞「お仲間には王さまから特別に激励の品が～」(ID: <code class="literal">#$0B36</code>) を表示する。
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							フラグセットサブルーチン <code class="varname">$C908F0</code> を呼び出し、
							<code class="varname">$7E353A</code> の最下位ビットから見て <code class="literal">#$0015</code> ビット目をセットする。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			台詞「では ○○○○さんへのたねの使い方はどうしますか？」(ID: <code class="literal">#$0B37</code>) を表示する。
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">A = #$003F</code>
		</p>
              </li>
              <li class="listitem">
                <p>
			乱数取得サブルーチン <code class="varname">$C0133E</code> を呼び出し、乱数を取得 (<code class="varname">A</code>) する。
			<code class="varname">A</code> レジスタには <code class="literal">0</code> 以上 <code class="literal">63</code> 以下のいずれかの値がロードされる。
			<span class="emphasis"><em><code class="literal">1/64</code> の確率で新規作成キャラに <code class="literal">6</code> 回タネ・木の実が使えることを意味する。</em></span>
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="code">A != 0</code> ⇒ <code class="code">A = 5</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">A == 0</code> ⇒ <code class="code">A = 6</code>
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【タネ個数決定直後】へジャンプ。
		</p>
              </li>
              <li class="listitem">
                <p>
			【その人ではダメ】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					表示ウィンドウ周りの処理を行う（詳細不明）。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					【まだ登録する？】へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【タネ個数決定直後】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="code">$2BB2 = A;</code> 使えるタネ・木の実の個数
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					「じぶんで やる・おまかせにする」ウィンドウを表示して、プレイヤーの入力を待つ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャンセルボタン ⇒【まだ登録する？】へジャンプ。
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							「じぶんで やる」⇒【じぶんで】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">$2A60 = 1;</code> 「登録屋がタネを使う」フラグ
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					【タネ蒔き】へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【じぶんで】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「使える回数は ○回です。ではどうぞ」(ID: <code class="literal">#$0B38</code>) を表示する。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【タネ蒔き】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					以下の反復処理を行う。反復回数はタネ・木の実の個数、つまり <code class="varname">$2BB2</code> だ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							<code class="code">A = 4</code>
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							乱数取得サブルーチン <code class="varname">$C0133E</code> を用いて、<code class="literal">0</code> 以上 <code class="literal">4</code> 以下の乱数を得る。
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							<code class="code">$2A62 = A;</code> 乱数
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							<span class="emphasis"><em>プレイヤーまたは登録屋がパラメータ種別を入力するのを待つ。</em></span>
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							<a class="link" href="dq3_entry.html#dq3.entry.hack.C3DE20" title="5.15.1.4. パラメータ増加処理サブルーチン">サブルーチン <code class="varname">$DE20</code></a> を呼び出すことで、
							選択パラメータの増分を決定する。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					メッセージ「[CE][D6][AF][AC]」(ID: <code class="literal">#$0150</code>) を表示する。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							<code class="code">$2A60 != 0</code> ⇒
						</p>
                            <div class="itemizedlist">
                              <ul class="itemizedlist" style="list-style-type: disc; ">
                                <li class="listitem">
                                  <p>
									台詞「さて……。おわりました」(ID: <code class="literal">#$0B3E</code>) を表示する。
								</p>
                                </li>
                                <li class="listitem">
                                  <p>
									<code class="code">$2A60 = 0</code>
								</p>
                                </li>
                              </ul>
                            </div>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">A = $2BB4;</code> キャラクター ID
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<a class="link" href="dq3_entry.html#dq3.entry.hack.C3DE95" title="5.15.1.5. 性格決定サブルーチン">サブルーチン <code class="varname">$C3DE95</code></a> を呼び出し、
					<span class="emphasis"><em>新規作成キャラクターの初期性格を決定する。</em></span>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<a class="link" href="dq3_entry.html#dq3.entry.hack.C3E2D0" title="5.15.1.6. 登録屋が性格を告げるサブルーチン">サブルーチン <code class="varname">$E2D0</code></a> を呼び出し、
					登録屋に性格を言わせる。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					台詞「では○○○○さんを登録します。よろしいですか？」(ID: <code class="literal">#$0B39</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					「はい・いいえ」ウィンドウを表示して、プレイヤーの入力を待つ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャンセルボタン or 「いいえ」⇒【登録しない】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					<span class="emphasis"><em>サブルーチン <code class="varname">$C44566</code> を呼び出し、新規作成キャラクターを正式に登録する。</em></span>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					台詞「たしかに登録しました」(ID: <code class="literal">#$0B3A</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					【まだ登録する？】 へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【登録しない】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「それは残念です」(ID: <code class="literal">#$0B3B</code>) を表示する。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【まだ登録する？】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「他の人も名簿に登録しますか？」(ID: <code class="literal">#$0B3C</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					「はい・いいえ」ウィンドウを表示して、プレイヤーの入力を待つ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャンセルボタン or 「いいえ」⇒【またおいで】へジャンプ。
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							「はい」⇒【新しく登録する】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【やっぱりやめる】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「おや やめるのですね」(ID: <code class="literal">#$0B46</code>) を表示する。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【またおいで】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「では新しい仲間を欲しくなったとき またおいでください」(ID: <code class="literal">#$0B47</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					呼び出し元に制御を戻す。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
          <p>
オリジナル版に比べると、キャラクターの追加処理が遥かに複雑になっている。
名前の決定に関しては、有名な新規作成キャラクターの名前の「ロトテスト」に加えて、「予約名との照合テスト」が仕様追加されている。
これはリメイク版では改名機能システムが追加されているので、そちらで利用されている機能を登録所システムにも採り入れたということだろう。
</p>
          <p>
さらに、キャラクターの能力値をプレイヤーがある程度底上げできるという、面白い仕様がここには追加されている。
タネ・木の実を定数個を使ってよいというルールがある。
この個数は通常 <code class="literal">5</code> だが、<code class="literal">1/64</code> という決して高くない確率で <code class="literal">6</code> になる。
この事実一つとっても、ドラクエというゲームが不思議なバランス感覚を有する設計の上にあるものだということを強く認識させられる。
</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.entry.hack.C3DD13"></a>5.15.1.2. キャラクター削除サブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$C3DD13</code> は、既存のキャラクターのいずれかを削除することができる処理だ。
	
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			サブルーチン <code class="varname">$C4467F</code> を呼び出し、登録済みのキャラクター数が上限に達しているか (<code class="varname">Carry</code>) 調べる。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					上限に達していない場合は【終了】へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「これ以上登録するにはだれかを名簿から外さないと～」(ID: <code class="literal">#$0B3F</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					「はい・いいえ」ウィンドウを表示して、プレイヤーの入力を待つ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャンセルボタン or 「いいえ」⇒【やめる】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【誰を外す】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「誰を外しますか？」(ID: <code class="literal">#$0B40</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					ウィンドウ「だれを」を表示し、酒場にいるキャラクターだけをリストする。
					そしてプレイヤーの入力を待つ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャンセルボタン ⇒【やめる】へジャンプ。
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							キャラクターを選択 ⇒ <code class="varname">$33D6</code> = 選択番号
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					キャラクター登録 ID 取得サブルーチン <code class="varname">$C42F5E</code> を呼び出し、
					選択キャラクター (<code class="varname">A</code>) の登録 ID を取得 (<code class="varname">X</code>) する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">$BE77 = X</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					キャラクターデータ格納アドレス取得サブルーチン <code class="varname">$C429DA</code> を呼び出し、
					選択キャラクター (<code class="varname">A</code>) のアドレスを取得 (<code class="varname">X</code>) する。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							<span class="emphasis"><em><code class="code">X == $3604</code> ⇒【削除不可】へジャンプ。</em></span>
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					主人公判定サブルーチン <code class="varname">$C42DA1</code> を呼び出し、
					選択キャラクター (<code class="varname">A</code>) が主人公であるか否かを調べる。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							主人公である ⇒【主人公が選択された】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					台詞「○○○○さんを外すのですね？そうすると２度と会えないかも～」(ID: <code class="literal">#$0B41</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					「はい・いいえ」ウィンドウを表示して、プレイヤーの入力を待つ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャンセルボタン or 「いいえ」⇒【やめる】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					サブルーチン <code class="varname">$C3DAC4</code> を呼び出し、選択キャラクター (<code class="varname">A</code>) のすべての所持品をふくろへ移す。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<span class="emphasis"><em>キャラクター削除サブルーチン <code class="varname">$C445F8</code> を呼び出し、選択キャラクター (<code class="varname">X</code>) を削除する。</em></span>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					台詞「残念ですが○○○○さんを外しました。これで新しい人を登録できます」(ID: <code class="literal">#$0B42</code>) を表示する。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【終了】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="varname">Carry</code> ビットをクリアする。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					呼び出し元に制御を戻す。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【やめる】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「おや気が変わりましたか」(ID: <code class="literal">#$0B43</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">Carry</code> ビットをセットする。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					呼び出し元に制御を戻す。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【主人公が選択された】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「えっ○○○○さんをっ！？無茶を言わないでください」(ID: <code class="literal">#$0B4C</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					【誰を外す】へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【削除不可】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「申し訳ありませんがその人を消すことはできません」(ID: <code class="literal">#$0B4D</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					【誰を外す】へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【事後条件】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					キャラクターを削除した場合に限り、<code class="varname">Carry</code> ビットはセット状態。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
          <p>
オリジナル版の処理を踏襲したものになっている。
削除できないキャラクターがいるらしいことが、プログラムコードから確認できる。
これはバークに預けた商人キャラクターのはずだ。
</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.entry.hack.C3DDBF"></a>5.15.1.3. 入力が仲間の名前と同じかチェック</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$C3DDBF</code> は入力した名前を持つ仲間キャラクターが既に存在するかどうかを調べる。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			キャラクター人数取得サブルーチン <code class="varname">$C4297C</code> を呼び出し、
			パーティとルイーダの酒場にいるキャラクターの人数 (<code class="code">$36E2 + $36E4</code>) を得る (<code class="varname">$78</code>) 。
		</p>
              </li>
              <li class="listitem">
                <p>
			【<code class="code">for A in $78 - 1 .. 0</code>】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					名前文字列照合サブルーチン <code class="varname">$C3DDE5</code> を呼び出し、
					キャラクター (<code class="varname">A</code>) の名前と、プレイヤーが入力した名前文字列 <code class="varname">$3332,X</code> と比較する。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							入力文字列がキャラクター (<code class="varname">A</code>) のそれと完全に一致 ⇒【終了】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			<code class="varname">Carry</code> ビットをクリアする。
		</p>
              </li>
              <li class="listitem">
                <p>
			【終了】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					呼び出し元に制御を戻す。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【事後条件】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					入力した名前を持つキャラクターが既にいる場合に限り、<code class="varname">Carry</code> ビットがセットされている。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.entry.hack.C3DE20"></a>5.15.1.4. パラメータ増加処理サブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$DE20</code> は、作成キャラクターに対し、
	「ちから」「すばやさ」といった指定のパラメータを上げる処理だ。
	これは「何ポイント上がった」というメッセージ表示を含む。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			【事前条件】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="varname">A</code> レジスタはタネウィンドウで選択した項目の番号を示す。
					実際は <code class="literal">0</code> 以上 <code class="literal">4</code> 以下の値がセットされている。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			<code class="code">A = $C3DE40,(A * 2)</code> として、
			<code class="varname">A</code> レジスタにタネウィンドウで選択した項目のアイテムのアイテム構造体 ID をセットする。
		</p>
              </li>
              <li class="listitem">
                <p>
			サブルーチン <code class="varname">$C45254</code> を呼び出し、
			<span class="emphasis"><em>このアイテムに対応する戦闘行動構造体 ID を取得 (<code class="varname">A</code>) する。</em></span>
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">X = A</code>
		</p>
              </li>
              <li class="listitem">
                <p>
			<span class="emphasis"><em>ダメージ値サブルーチン <code class="varname">$C90B3A</code> を呼び出し、
			行動 (<code class="varname">X</code>) によるダメージを決定 (<code class="varname">A</code>) する。</em></span>
			文脈上、これはダメージと呼ばず、パラメータ上昇値と呼ぶことにする。
		</p>
              </li>
              <li class="listitem">
                <p>
			メッセージ表示用に <code class="code">$BE81 = A</code> とし、パラメータ上昇値を覚えておく。
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">X = (呼び出し直後の A) * 2</code> とする。ジャンプテーブルのインデックスをセットだ。
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">Y = $2BB4</code> とする。作成キャラクターを示す何かの値だ。
		</p>
              </li>
              <li class="listitem">
                <p>
			ジャンプテーブル <code class="varname">$DE45</code> に従いジャンプ (<code class="varname">X</code>) する。
			呼び出し元に制御を戻すのはジャンプ先のどこかになる。
		</p>
              </li>
            </ul>
          </div>
          <p>
	配列 <code class="varname">$C3DE40,X</code> は以下のようになっている。
	タネウィンドウで表示するアイテムリストに対応するアイテム ID を配列したものだ。
</p>
          <pre class="programlisting">
C3/DE40:    B2  ; ちからのたね
C3/DE41:    B3  ; すばやさのたね
C3/DE42:    B4  ; スタミナのたね
C3/DE43:    B6  ; かしこさのたね
C3/DE44:    B5  ; ラックのたね
</pre>
          <p>
	ジャンプテーブル <code class="varname">$DE45</code> は、
	各パラメータに対応するパラメータ上昇処理コードのアドレス配列だ。
	以下にジャンプテーブルを示す。
</p>
          <pre class="programlisting">
C3/DE45:    4FDE  ; ちから
C3/DE47:    5DDE  ; すばやさ
C3/DE49:    6BDE  ; たいりょく
C3/DE4B:    79DE  ; かしこさ
C3/DE4D:    87DE  ; うんのよさ
</pre>
          <p>
	これを見ると、例えば「ちから」を上げる場合は <code class="varname">$DE4F</code> にジャンプすることがわかる。
	実装は以下のようになっていて、キャラクターの能力値上限を更新し、
	メッセージを表示するという処理だ。
	その他のパラメータに関しても、同様のコードになっている。
</p>
          <pre class="programlisting">
C3/DE4F:    226834C4    JSR $C43468 ; (RTL+3) キャラクター::ちからアップ
C3/DE53:    06FDFF
C3/DE56:    22D4A8C1    JSR $C1A8D4 ; [B2]の ちからが[AD][BB]あがった！[AC]
C3/DE5A:    CF00
C3/DE5C:    60          RTS
</pre>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.entry.hack.C3DE95"></a>5.15.1.5. 性格決定サブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$C3DE95</code> は、作成キャラクターの初期の性格を決定する処理だ。
	説明を詳細にし過ぎるすると解析の要点がボケる恐れがあるので、ここでは記述の粒度を粗くする。
	概略は以下の通り。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			下の表に示すアドレスに、
			新規作成キャラクター (<code class="varname">A</code>) に関する表の値をそれぞれ取得または計算し、セットする。
		</p>
                <div class="table">
                  <a id="table.dq3.C3DE95"></a>
                  <p class="title">
                    <strong>表 5.23 $C3DE95 前半部処理</strong>
                  </p>
                  <div class="table-contents">
                    <table id="table.dq3.C3DE95" class="lighttable">
                      <thead>
                        <tr>
                          <th>Address</th>
                          <th>Value</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>
                            <code class="varname">$2BB8</code>
                          </td>
                          <td>職業 ID</td>
                        </tr>
                        <tr>
                          <td>
                            <code class="varname">$2BBA</code>
                          </td>
                          <td>性別</td>
                        </tr>
                        <tr>
                          <td>
                            <code class="varname">$2BBC</code>
                          </td>
                          <td>キャラクター ID</td>
                        </tr>
                        <tr><td><code class="varname">$2BBE,X</code> (<code class="code">X = 0,2,4,6,8</code>)</td>
					<td>パラメータ種別を表す数値。以下の通り。
						<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
									<code class="code">$2BBE = #$0000</code>: ちから
								</p></li><li class="listitem"><p>
									<code class="code">$2BC0 = #$0001</code>: すばやさ
								</p></li><li class="listitem"><p>
									<code class="code">$2BC2 = #$0002</code>: たいりょく
								</p></li><li class="listitem"><p>
									<code class="code">$2BC4 = #$0003</code>: かしこさ
								</p></li><li class="listitem"><p>
									<code class="code">$2BC6 = #$0004</code>: うんのよさ
								</p></li></ul></div>
					</td>
				</tr>
                        <tr><td><code class="varname">$2BC8,X</code> (<code class="code">X = 0,2,4,6,8</code>)</td>
					<td>パラメータ値の増分（後述）。
						ちから、すばやさ、たいりょく、かしこさ、うんのよさの順に格納する。
					</td></tr>
                        <tr><td><code class="varname">$2BD2,X</code> (<code class="code">X = 0,2,4,6,8</code>)</td>
					<td>パラメータ値デフォルト。
						<span class="emphasis"><em>職業構造体で定義されているレベル <code class="literal">1</code> での各パラメータの値</em></span>を格納する。
						パラメータ種別の格納順序は上記 (<code class="varname">$2BC8,X</code>) と合わせる。
					</td></tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <br class="table-break" />
              </li>
              <li class="listitem">
                <p>
			<a class="link" href="dq3_entry.html#dq3.entry.hack.C3DF8E" title="5.15.1.5.1. パラメータ増分値配列を降順ソート">サブルーチン <code class="varname">$DF8E</code></a> を呼び出すことで、
			新規作成キャラクターの<span class="emphasis"><em>パラメータ増分値配列 <code class="varname">$2BC8,X</code> を降順にソートする。</em></span>
			かつ、対になっている配列 <code class="varname">$2BBE,X</code> と <code class="varname">$2BD2,X</code> も対応関係を保つように並び替える。
		</p>
              </li>
              <li class="listitem">
                <p>
			<a class="link" href="dq3_entry.html#dq3.entry.hack.C3DFF9" title="5.15.1.5.2. 性格条件群の決定">サブルーチン <code class="varname">$DFF9</code></a> を呼び出すことで、
			新規作成キャラクターの<span class="emphasis"><em>性格条件群 ID を決定 (<code class="varname">A</code>) する。</em></span>
		</p>
              </li>
              <li class="listitem">
                <p>
			<a class="link" href="dq3_entry.html#dq3.entry.hack.C3E018" title="5.15.1.5.3. 性格グループ構造体 ID 決定">サブルーチン <code class="varname">$E018</code></a> を呼び出すことで、
			性格条件群構造体 ID (<code class="varname">A</code>) のデータから、
			<span class="emphasis"><em>性格グループ構造体 ID を決定 (<code class="varname">A</code>) する。</em></span>
		</p>
              </li>
              <li class="listitem">
                <p>
			<a class="link" href="dq3_entry.html#dq3.entry.hack.C3E134" title="5.15.1.5.4. 性格を決定">サブルーチン <code class="varname">$E134</code></a> を呼び出すことで、
			決定した<span class="emphasis"><em>性格グループ構造体データから、性格を決定する。</em></span>
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">X = $2BB4</code>
		</p>
              </li>
              <li class="listitem">
                <p>
			キャラクター性格セットサブルーチン <code class="varname">$C42ED6</code> を呼び出し、
			<span class="emphasis"><em>新規キャラクター (<code class="varname">X</code>) の性格 ID をキャラクターデータ内にセット (<code class="varname">A</code>) する。</em></span>
		</p>
              </li>
              <li class="listitem">
                <p>
			【事後条件】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="varname">A</code> == 決定した性格の性格構造体 ID
				</p>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
          <p>
	パラメータ値の増分とは、
	タネ・木の実を使ったことによる能力パラメータの増加ポイントということだ。
	このサブルーチンでは、
	それらを「タネを使い切ったときの値」と「タネを全然使っていないときの値」の差をとることで得ている。
</p>
          <div class="section">
            <div class="titlepage">
              <div>
                <div>
                  <h5 class="title"><a id="dq3.entry.hack.C3DF8E"></a>5.15.1.5.1. パラメータ増分値配列を降順ソート</h5>
                </div>
              </div>
            </div>
            <p>
	サブルーチン <code class="varname">$DF8E</code> は前項サブルーチンで初期化した三配列を、ある基準に従ってソートする。
	ゲームロジックとは直接関係のない処理なので、
	アルゴリズムに興味のない読者は読み飛ばして構わない。
</p>
            <div class="itemizedlist">
              <ul class="itemizedlist" style="list-style-type: disc; ">
                <li class="listitem">
                  <p>
			【事前条件】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<code class="varname">$2BBE,X</code> (<code class="code">X = 0,2,4,6,8</code>) が<a class="link" href="dq3_entry.html#dq3.entry.hack.C3DE95" title="5.15.1.5. 性格決定サブルーチン">前項</a>の説明のようにセット済
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="varname">$2BC8,X</code> (<code class="code">X = 0,2,4,6,8</code>) が<a class="link" href="dq3_entry.html#dq3.entry.hack.C3DE95" title="5.15.1.5. 性格決定サブルーチン">前項</a>の説明のようにセット済
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="varname">$2BD2,X</code> (<code class="code">X = 0,2,4,6,8</code>) が<a class="link" href="dq3_entry.html#dq3.entry.hack.C3DE95" title="5.15.1.5. 性格決定サブルーチン">前項</a>の説明のようにセット済
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			【古典的なバブルソート】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<span class="emphasis"><em>パラメータ増分値配列 <code class="varname">$2BC8,X</code> に対して、降順ソートを行う。</em></span>
					すなわち、大きいほうが前に来るように隣接要素を交換する。
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							隣接する二項が等しい場合、
							<span class="emphasis"><em>初期パラメータ値配列 <code class="varname">$2BD2,X</code> において</em></span>隣接する二項の大小比較を行う。
							これも、大きいほうが前に来るように隣接要素を交換する。
						</p>
                              <div class="itemizedlist">
                                <ul class="itemizedlist" style="list-style-type: disc; ">
                                  <li class="listitem">
                                    <p>
									そこでも隣接する二項が等しい場合、
									<code class="code">A = #$0001</code> とした上で、乱数取得サブルーチン <code class="varname">$C0133E</code> を呼び出す。
									これにより、乱数 <code class="literal">0</code> または <code class="literal">1</code> を得る。
									<span class="emphasis"><em><code class="literal">0</code> の場合に限り、隣接する二要素を交換する。</em></span>
								</p>
                                  </li>
                                </ul>
                              </div>
                            </li>
                          </ul>
                        </div>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			【事後条件】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<code class="varname">$2BBE,X</code> と <code class="varname">$2BC8,X</code> と <code class="varname">$2BD2,X</code> が各
					<code class="varname">X</code> (<code class="code">X = 0,2,4,6,8</code>) について、それぞれ対応している。
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					<span class="emphasis"><em><code class="varname">$2BC6,X</code> &gt; <code class="varname">$2BC8,X</code> (for <code class="code">X = 2,4,6,8</code>)</em></span>
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							ただし <code class="code">$2BC6,X == $2BC8,X</code> のときは
							<code class="code">$2BD0,X &gt;= $2BD2,X</code> が成り立つ。
						</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
            <p>
	上のロジックで、配列内の隣接要素の交換はサブルーチン <code class="varname">$DFCF</code> の呼び出しにより行う。
	三配列間の対応関係を保つべく、三配列それぞれに対して隣接要素交換操作を行う。
</p>
          </div>
          <div class="section">
            <div class="titlepage">
              <div>
                <div>
                  <h5 class="title"><a id="dq3.entry.hack.C3DFF9"></a>5.15.1.5.2. 性格条件群の決定</h5>
                </div>
              </div>
            </div>
            <p>
	サブルーチン <code class="varname">$DFF9</code> は、新規作成キャラクターのための性格条件群構造体データを決定する。
	かいつまんで言うと、初期性格候補一覧が定義されたデータ
	（これを性格条件群と呼ぶ）を選択する処理だ。
</p>
            <div class="itemizedlist">
              <ul class="itemizedlist" style="list-style-type: disc; ">
                <li class="listitem">
                  <p>
			【事前条件】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<span class="emphasis"><em><code class="varname">$2BBE</code> == 最も増分が大きいパラメータの種別</em></span>
					<code class="literal">0..4</code> のどれか。
					すなわち、ちから、すばやさ、たいりょく、かしこさ、うんのよさのいずれかだ。
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			<code class="code">X = $C3E00E,X</code> (where <code class="code">X == $2BBE</code>) に対して、
			職業構造体サブルーチン <code class="varname">$C46AFD</code> を呼び出し、
			作成キャラクターの職業に対応する職業構造体データの
			<code class="varname">X</code> バイト目の値 <code class="code">&amp; #$00FF</code> を取得 (<code class="varname">A</code>) する。
		</p>
                </li>
                <li class="listitem">
                  <p>
			【事後条件】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<span class="emphasis"><em><code class="varname">A</code> == 性格条件群構造体 ID</em></span>
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
            <p>
	配列 <code class="varname">$C3E00E,X</code> は <code class="literal">#$0006</code> から <code class="literal">#$000A</code> の値が連続して配列されているだけだ。
	取りも直さず、
	職業構造体のメモリレイアウトにおいて <code class="literal">#$0006</code> バイト目から <code class="literal">#$000A</code> バイト目は、
	<span class="emphasis"><em>性格条件群構造体 ID</em></span> の配列になっていることがわかる。
</p>
          </div>
          <div class="section">
            <div class="titlepage">
              <div>
                <div>
                  <h5 class="title"><a id="dq3.entry.hack.C3E018"></a>5.15.1.5.3. 性格グループ構造体 ID 決定</h5>
                </div>
              </div>
            </div>
            <p>
	サブルーチン <code class="varname">$E018</code> は新規作成キャラクターの初期性格の性格 ID を決定する。
</p>
            <div class="itemizedlist">
              <ul class="itemizedlist" style="list-style-type: disc; ">
                <li class="listitem">
                  <p>
			【事前条件】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<code class="varname">A</code> == <a class="link" href="dq3_entry.html#dq3.entry.data.C30EFD" title="5.15.2.1. $C30EFD 構造体 - 登録所・性格条件群"><code class="varname">$C30EFD</code> 構造体</a>の ID
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			<code class="code">X = A</code>
		</p>
                </li>
                <li class="listitem">
                  <p>
			構造体アクセス汎用サブルーチン <code class="varname">$C9050D</code> を呼び出し、
			<a class="link" href="dq3_entry.html#dq3.entry.data.C30EFD" title="5.15.2.1. $C30EFD 構造体 - 登録所・性格条件群"><code class="varname">$C30EFD</code> 構造体</a>データを格納しているアドレスを取得 (<code class="varname">$78</code>) する。
		</p>
                </li>
                <li class="listitem">
                  <p>
			【判定 0】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					データの二位フラグ <code class="code">[0]</code> を見る。
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							1 ⇒
							作成キャラクターのパラメータ種別 <code class="code">[0]</code> の増分が、
							<span class="emphasis"><em>五種類のパラメータの中で二番目に増加が大きいものであるか調べる。</em></span>
						</p>
                              <div class="itemizedlist">
                                <ul class="itemizedlist" style="list-style-type: disc; ">
                                  <li class="listitem">
                                    <p>
									YES ⇒ <code class="code">A = ID [0]</code> をセットし、呼び出し元に制御を戻す。
								</p>
                                  </li>
                                  <li class="listitem">
                                    <p>
									NO ⇒【判定 1】へジャンプ。
								</p>
                                  </li>
                                </ul>
                              </div>
                            </li>
                            <li class="listitem">
                              <p>
							0 ⇒
							作成キャラクターのパラメータ種別 <code class="code">[0]</code> の増分が、
							<span class="emphasis"><em>閾値 <code class="code">[0]</code> 以上であるか調べる。</em></span>
						</p>
                              <div class="itemizedlist">
                                <ul class="itemizedlist" style="list-style-type: disc; ">
                                  <li class="listitem">
                                    <p>
									YES ⇒ <code class="code">A = ID [0]</code> をセットし、呼び出し元に制御を戻す。
								</p>
                                  </li>
                                </ul>
                              </div>
                            </li>
                          </ul>
                        </div>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			【判定 1】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					【判定 0】と同様。説明省略。
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			【判定 2】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					【判定 1】と同様。説明省略。
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			【判定 3】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					【判定 2】と同様。説明省略。
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			【判定 4】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					【判定 3】と同様。説明省略。
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			呼び出し元に制御を戻す。
		</p>
                </li>
                <li class="listitem">
                  <p>
			【事後条件】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<span class="emphasis"><em><code class="varname">A</code> == 性格 ID</em></span>
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
            <p>
こう書いておいてなんだが、上記プログラムコードの書き下しは理解しにくい。
最低限 <code class="varname">$C30EFD</code> 構造体のダンプを手許に置いて、
それを見ながらコードを机上トレースしないと、ここでの処理が感覚でわからぬのではないかと思う。
</p>
          </div>
          <div class="section">
            <div class="titlepage">
              <div>
                <div>
                  <h5 class="title"><a id="dq3.entry.hack.C3E134"></a>5.15.1.5.4. 性格を決定</h5>
                </div>
              </div>
            </div>
            <p>
	サブルーチン <code class="varname">$E134</code> は、新規作成キャラクターの初期の性格を決める。
</p>
            <div class="itemizedlist">
              <ul class="itemizedlist" style="list-style-type: disc; ">
                <li class="listitem">
                  <p>
			【事前条件】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<code class="varname">A</code> == <a class="link" href="dq3_entry.html#dq3.entry.data.C30FFC" title="5.15.2.2. $C30FFC 構造体 - 登録所・性格群"><code class="varname">$C30FFC</code> 構造体</a> ID
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="code">2BBA == 0 || $2BBA == 1</code>（性別）
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			<code class="code">X = A</code>
		</p>
                </li>
                <li class="listitem">
                  <p>
			汎用構造体アドレス取得サブルーチン <code class="varname">$C9050D</code> 呼び出しにより、
			指定 ID (<code class="varname">X</code>) に対する構造体 <code class="varname">$C30FFC</code> のデータアドレスを (<code class="varname">$78</code>) 得る。
		</p>
                </li>
                <li class="listitem">
                  <p>
			下の表の各アドレスにある値をゼロにセットする。
		</p>
                  <div class="table">
                    <a id="table.dq3.C3E134.1"></a>
                    <p class="title">
                      <strong>表 5.24 $E134 ゼロクリア表</strong>
                    </p>
                    <div class="table-contents">
                      <table id="table.dq3.C3E134.1" class="lighttable">
                        <thead>
                          <tr>
                            <th>Address</th>
                            <th>Value</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>
                              <code class="varname">$2BBE</code>
                            </td>
                            <td>配列 <code class="varname">$2BD2,X</code> の要素数を表すために用いる</td>
                          </tr>
                          <tr>
                            <td>
                              <code class="varname">$2BC0</code>
                            </td>
                            <td>配列 <code class="varname">$2BD2,X</code> の各要素の和</td>
                          </tr>
                          <tr>
                            <td><code class="varname">$2BC2,X</code> (<code class="code">X = 0,2,..E</code>)</td>
                            <td>性格 ID の配列</td>
                          </tr>
                          <tr>
                            <td><code class="varname">$2BD2,X</code> (<code class="code">X = 0,2,..E</code>)</td>
                            <td>配列 <code class="varname">$2BC2,X</code> の各要素の「重み」</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <br class="table-break" />
                </li>
                <li class="listitem">
                  <p>
			下の表の各アドレスに、構造体データの各フィールドをセットする。
			これらの値は性格 ID だ。
		</p>
                  <div class="table">
                    <a id="table.dq3.C3E134.2"></a>
                    <p class="title">
                      <strong>表 5.25 $E134 配列表 1</strong>
                    </p>
                    <div class="table-contents">
                      <table id="table.dq3.C3E134.2" class="lighttable">
                        <thead>
                          <tr>
                            <th>Address</th>
                            <th>Value</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>
                              <code class="varname">$2BC2</code>
                            </td>
                            <td>構造体データ<code class="code">[#$0004] &amp; #$00FF</code></td>
                          </tr>
                          <tr>
                            <td>
                              <code class="varname">$2BC4</code>
                            </td>
                            <td>構造体データ<code class="code">[#$0005] &amp; #$00FF</code></td>
                          </tr>
                          <tr>
                            <td>
                              <code class="varname">$2BC6</code>
                            </td>
                            <td>構造体データ<code class="code">[#$0006] &amp; #$00FF</code></td>
                          </tr>
                          <tr>
                            <td>
                              <code class="varname">$2BC8</code>
                            </td>
                            <td>構造体データ<code class="code">[#$0007] &amp; #$00FF</code></td>
                          </tr>
                          <tr>
                            <td>
                              <code class="varname">$2BCA</code>
                            </td>
                            <td>構造体データ<code class="code">[#$0008] &amp; #$00FF</code></td>
                          </tr>
                          <tr>
                            <td>
                              <code class="varname">$2BCC</code>
                            </td>
                            <td>構造体データ<code class="code">[#$0009] &amp; #$00FF</code></td>
                          </tr>
                          <tr>
                            <td>
                              <code class="varname">$2BCE</code>
                            </td>
                            <td>構造体データ<code class="code">[#$000A] &amp; #$00FF</code></td>
                          </tr>
                          <tr>
                            <td>
                              <code class="varname">$2BD0</code>
                            </td>
                            <td>構造体データ<code class="code">[#$000B] &amp; #$00FF</code></td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <br class="table-break" />
                </li>
                <li class="listitem">
                  <p>
			下の表の各アドレスに、
			サブルーチン <code class="varname">$C90717</code> を用いることで構造体データの各フィールドを
			（必要に応じて右シフトされた値を）セットする。
			これらの値は、上記配列に格納されている各性格の「重み」だ。
		</p>
                  <div class="table">
                    <a id="table.dq3.C3E134.3"></a>
                    <p class="title">
                      <strong>表 5.26 $E134 配列表 2</strong>
                    </p>
                    <div class="table-contents">
                      <table id="table.dq3.C3E134.3" class="lighttable">
                        <thead>
                          <tr>
                            <th>Address</th>
                            <th>Value</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>
                              <code class="varname">$2BD2</code>
                            </td>
                            <td>構造体データ<code class="code">[#$0000] &amp; #$000F</code></td>
                          </tr>
                          <tr>
                            <td>
                              <code class="varname">$2BD4</code>
                            </td>
                            <td>構造体データ<code class="code">[#$0000] &amp; #$00F0</code></td>
                          </tr>
                          <tr>
                            <td>
                              <code class="varname">$2BD6</code>
                            </td>
                            <td>構造体データ<code class="code">[#$0001] &amp; #$000F</code></td>
                          </tr>
                          <tr>
                            <td>
                              <code class="varname">$2BD8</code>
                            </td>
                            <td>構造体データ<code class="code">[#$0001] &amp; #$00F0</code></td>
                          </tr>
                          <tr>
                            <td>
                              <code class="varname">$2BDA</code>
                            </td>
                            <td>構造体データ<code class="code">[#$0002] &amp; #$000F</code></td>
                          </tr>
                          <tr>
                            <td>
                              <code class="varname">$2BDC</code>
                            </td>
                            <td>構造体データ<code class="code">[#$0002] &amp; #$00F0</code></td>
                          </tr>
                          <tr>
                            <td>
                              <code class="varname">$2BDE</code>
                            </td>
                            <td>構造体データ<code class="code">[#$0003] &amp; #$000F</code></td>
                          </tr>
                          <tr>
                            <td>
                              <code class="varname">$2BD0</code>
                            </td>
                            <td>構造体データ<code class="code">[#$0003] &amp; #$00F0</code></td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <br class="table-break" />
                </li>
                <li class="listitem">
                  <p>
			性格 ID 配列 <code class="varname">$2BC2,X</code> に対して以下の反復処理を行う。
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<code class="code">A = $2BC2,X</code>
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							<code class="code">A == 0</code> ⇒ 反復処理を次へ進める
						</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li class="listitem">
                        <p>
					性格サブルーチン <code class="varname">$C46BED</code> を呼び出して、性格 (<code class="varname">A</code>) の性別情報を取得 (<code class="varname">A</code>) する。
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							もしその性格が新規作成キャラクターのそれと相容れないものであれば、
							<span class="emphasis"><em>配列 <code class="varname">$2BC2,X</code> と <code class="varname">$2BD2,X</code> を前方へ詰める。</em></span>
							そして反復処理を次へ進める。
						</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li class="listitem">
                        <p>
					「重みの和」を加算する： <code class="code">$2BC0 += $2BD2,X</code>
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="varname">$2BD2,X</code> に今の和を格納する： <code class="code">$2BD2,X = $2BC0</code>
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			【乱数取得】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					乱数の範囲を決める： <code class="code">A = $2BC0 - 1</code>
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					乱数取得サブルーチン <code class="varname">$C0135F</code> を呼び出し、乱数を取得 (<code class="varname">A</code>) する。
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					配列 <code class="varname">$2BD2,X</code> (<code class="code">X = 0,..,<code class="varname">$2BBE</code></code>) に対して、
					<code class="varname">A</code> を超える値を前方から検索する。
					この配列は単調増加だ。
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							そのような値を検索できたならば、
							<code class="varname">$2BC2,X</code> の値を <code class="varname">A</code> にロードして、呼び出し元に制御を戻す。
						</p>
                            </li>
                            <li class="listitem">
                              <p>
							見つからなかった場合は、
							<code class="varname">$2BC2</code> の値を <code class="varname">A</code> にロードして、呼び出し元に制御を戻す。
						</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			【事後条件】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<code class="code">A == 性格 ID</code>
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
            <p>
	紙面の都合上説明できないが
	「配列 <code class="varname">$2BC2,X</code> と <code class="varname">$2BD2,X</code> を前方へ詰める」のは、
	補助サブルーチン <code class="varname">$C3E2B4</code> の呼び出しで行う。
</p>
            <p>
	キャラクターの能力値、およびそのバランスだけで初期性格が一意に決まるのではないことが読み取れる。
	ちょっとした乱数的要素も性格決定に関与する。
</p>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.entry.hack.C3E2D0"></a>5.15.1.6. 登録屋が性格を告げるサブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$E2D0</code> は、
	性格が決まったばかりのキャラクターに対する寸評を登録屋が与える処理だ。
	これは見方を変えれば、ゲームからプレイヤーに向けてのレポート処理だ。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			【事前条件】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="varname">A</code> == 性格 ID
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			性格名文字列 ID 取得サブルーチン <code class="varname">$C42F28</code> を呼び出し、
			性格 (<code class="varname">A</code>) の名前文字列 ID を取得 (<code class="varname">X</code>) する。
		</p>
              </li>
              <li class="listitem">
                <p>
			次のメッセージ表示のため、<code class="code">$BE77 = X</code> とする。
		</p>
              </li>
              <li class="listitem">
                <p>
			性格構造体の <code class="literal">7</code>バイト目 &amp; <code class="literal">#$001C</code> ビット取得サブルーチン
			<code class="varname">$C46C28</code> を呼び出す。
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">A = $C3E2EA,X</code> (where <code class="code">X = A * 2</code>) とし、
			<code class="varname">A</code> の値をメッセージ ID と解釈する台詞表示サブルーチン <code class="varname">$C1A95A</code> を呼び出す。
		</p>
              </li>
            </ul>
          </div>
          <p>
	配列 <code class="varname">$C3E2EA,X</code> は小さいので、すぐに中身を確認できる。
	登録屋は性格の名前によって、台詞回しを微妙に変える。
</p>
          <pre class="programlisting">
C3/E2EA:    480B  ; [D6]なかなか [B2][AD]のようですね。[AF][AC]
C3/E2EC:    490B  ; [D6]なかなか [B2][AD]なようですね。[AF][AC]
C3/E2EE:    4A0B  ; [D6]なかなか [B2][AD]ようですね。[AF][AC]
C3/E2F0:    4B0B  ; [D6]なかなか [B2]さん[AD]のようですね。[AF][AC]
</pre>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="dq3.entry.data"></a>5.15.2. データ</h3>
            </div>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.entry.data.C30EFD"></a>5.15.2.1. <code class="varname">$C30EFD</code> 構造体 - 登録所・性格条件群</h4>
              </div>
            </div>
          </div>
          <p>
	アドレス <code class="varname">$C30EFD</code> には登録所処理で参照される構造体データが定義されている。
	この構造体のメモリレイアウトは以下の通り。
</p>
          <div class="table">
            <a id="table.dq3.C30EFD"></a>
            <p class="title">
              <strong>表 5.27 $C30EFD 構造体 - 登録所・性格条件群</strong>
            </p>
            <div class="table-contents">
              <table id="table.dq3.C30EFD" class="memorylayout">
                <colgroup>
		<col width="12%" />
		<col span="7" width="11%" />
	</colgroup>
                <thead>
                  <tr><th>Byte:Bit</th>
			<th>80</th>
			<th>40</th>
			<th>20</th>
			<th>10</th>
			<th>08</th>
			<th>04</th>
			<th>02</th>
			<th>01</th>
		</tr>
                </thead>
                <tbody>
                  <tr><th>00</th>
			<td>二位フラグ<code class="code">[0]</code></td>
			<td colspan="7">増分の閾値<code class="code">[0]</code></td>
		</tr>
                  <tr><th>01</th>
			<td colspan="8">パラメータ種別<code class="code">[0]</code></td>
		</tr>
                  <tr><th>02</th>
			<td colspan="8"><code class="varname">$C30FFC</code> 構造体 ID <code class="code">[0]</code></td>
		</tr>
                  <tr><th>03</th>
			<td>二位フラグ<code class="code">[1]</code></td>
			<td colspan="7">増分の閾値<code class="code">[1]</code></td>
		</tr>
                  <tr><th>04</th>
			<td colspan="8">パラメータ種別<code class="code">[1]</code></td>
		</tr>
                  <tr><th>05</th>
			<td colspan="8"><code class="varname">$C30FFC</code> 構造体 ID <code class="code">[1]</code></td>
		</tr>
                  <tr><th>06</th>
			<td>二位フラグ<code class="code">[2]</code></td>
			<td colspan="7">増分の閾値<code class="code">[2]</code></td>
		</tr>
                  <tr><th>07</th>
			<td colspan="8">パラメータ種別<code class="code">[2]</code></td>
		</tr>
                  <tr><th>08</th>
			<td colspan="8"><code class="varname">$C30FFC</code> 構造体 ID <code class="code">[2]</code></td>
		</tr>
                  <tr><th>09</th>
			<td>二位フラグ<code class="code">[3]</code></td>
			<td colspan="7">増分の閾値<code class="code">[3]</code></td>
		</tr>
                  <tr><th>0A</th>
			<td colspan="8">パラメータ種別<code class="code">[3]</code></td>
		</tr>
                  <tr><th>0B</th>
			<td colspan="8"><code class="varname">$C30FFC</code> 構造体 ID <code class="code">[3]</code></td>
		</tr>
                  <tr><th>0C</th>
			<td>二位フラグ<code class="code">[4]</code></td>
			<td colspan="7">増分の閾値<code class="code">[4]</code></td>
		</tr>
                  <tr><th>0D</th>
			<td colspan="8">パラメータ種別<code class="code">[4]</code></td>
		</tr>
                  <tr><th>0E</th>
			<td colspan="8"><code class="varname">$C30FFC</code> 構造体 ID <code class="code">[4]</code></td>
		</tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p>
	各フィールドの意味は以下の通りだが、決してわかりやすいものではない。
</p>
          <div class="glosslist">
            <dl>
              <dt>
                <span class="glossterm">増分の閾値<code class="code">[i]</code></span>
              </dt>
              <dd class="glossdef">
                <p>
				二位フラグ<code class="code">[i] == 0</code> のとき、判定サブルーチンは登録時のタネによるパラメータ種別<code class="code">[i]</code>
				のパラメータ増分値がこの値以上であるかを調べる。
			</p>
                <p>
				二位フラグ<code class="code">[i] == 1</code> のとき、このフィールドは未使用。
			</p>
              </dd>
              <dt>
                <span class="glossterm">二位フラグ<code class="code">[i]</code></span>
              </dt>
              <dd class="glossdef">
                <p>
				二位フラグ<code class="code">[i] == 1</code> のとき、
				新規作成キャラクターのパラメータ種別<code class="code">[i]</code> の増分値が、
				二番目に大きいパラメータであるか調べる。
			</p>
              </dd>
              <dt>
                <span class="glossterm">パラメータ種別 <code class="code">[i]</code></span>
              </dt>
              <dd class="glossdef">
                <p>
				パラメータ種別を表す値だ。値とパラメータ名との対応は
				<a class="link" href="dq3_entry.html#dq3.entry.hack.C3DE95" title="5.15.1.5. 性格決定サブルーチン">性格決定サブルーチン</a>の表を参照。
			</p>
              </dd>
              <dt>
                <span class="glossterm"><code class="varname">$C30FFC</code> 構造体 ID <code class="code">[i]</code></span>
              </dt>
              <dd class="glossdef">
                <p>
				<a class="link" href="dq3_entry.html#dq3.entry.data.C30FFC" title="5.15.2.2. $C30FFC 構造体 - 登録所・性格群"><code class="varname">$C30FFC</code> 構造体</a>の ID だ。
				そこから初期性格を絞り込む。
			</p>
              </dd>
            </dl>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.entry.data.C30FFC"></a>5.15.2.2. <code class="varname">$C30FFC</code> 構造体 - 登録所・性格群</h4>
              </div>
            </div>
          </div>
          <p>
	アドレス <code class="varname">$C30FFC</code> には登録所処理で参照される構造体データが定義されている。
	新規作成キャラクターの初期性格を抽選するための表だ。
	この構造体のメモリレイアウトは以下の通り。
</p>
          <div class="table">
            <a id="table.dq3.C30FFC"></a>
            <p class="title">
              <strong>表 5.28 $C30FFC 構造体 - 登録所・性格群</strong>
            </p>
            <div class="table-contents">
              <table id="table.dq3.C30FFC" class="memorylayout">
                <colgroup>
		<col width="12%" />
		<col span="7" width="11%" />
	</colgroup>
                <thead>
                  <tr><th>Byte:Bit</th>
			<th>80</th>
			<th>40</th>
			<th>20</th>
			<th>10</th>
			<th>08</th>
			<th>04</th>
			<th>02</th>
			<th>01</th>
		</tr>
                </thead>
                <tbody>
                  <tr><th>00</th>
			<td colspan="4">性格<code class="code">[1]</code> 確率</td>
			<td colspan="4">性格<code class="code">[0]</code> 確率</td>
		</tr>
                  <tr><th>01</th>
			<td colspan="4">性格<code class="code">[3]</code> 確率</td>
			<td colspan="4">性格<code class="code">[2]</code> 確率</td>
		</tr>
                  <tr><th>02</th>
			<td colspan="4">性格<code class="code">[5]</code> 確率</td>
			<td colspan="4">性格<code class="code">[4]</code> 確率</td>
		</tr>
                  <tr><th>03</th>
			<td colspan="4">性格<code class="code">[7]</code> 確率</td>
			<td colspan="4">性格<code class="code">[6]</code> 確率</td>
		</tr>
                  <tr><th>04</th>
			<td colspan="8">性格<code class="code">[0]</code></td>
		</tr>
                  <tr><th>05</th>
			<td colspan="8">性格<code class="code">[1]</code></td>
		</tr>
                  <tr><th>06</th>
			<td colspan="8">性格<code class="code">[2]</code></td>
		</tr>
                  <tr><th>07</th>
			<td colspan="8">性格<code class="code">[3]</code></td>
		</tr>
                  <tr><th>08</th>
			<td colspan="8">性格<code class="code">[4]</code></td>
		</tr>
                  <tr><th>09</th>
			<td colspan="8">性格<code class="code">[5]</code></td>
		</tr>
                  <tr><th>0A</th>
			<td colspan="8">性格<code class="code">[6]</code></td>
		</tr>
                  <tr><th>0B</th>
			<td colspan="8">性格<code class="code">[7]</code></td>
		</tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p>
	各フィールドの意味は以下の通り。
</p>
          <div class="glosslist">
            <dl>
              <dt>
                <span class="glossterm">性格<code class="code">[i]</code> 確率</span>
              </dt>
              <dd class="glossdef">
                <p>
				新規作成キャラクターの性格が性格<code class="code">[i]</code> になる確率の分子。
				分母は（性別によるなれる性格の違いを無視すれば）
				性格<code class="code">[0]</code> 確率から性格<code class="code">[7]</code> 確率までの和だ。
			</p>
              </dd>
              <dt>
                <span class="glossterm">性格<code class="code">[i]</code></span>
              </dt>
              <dd class="glossdef">
                <p>
				新規作成キャラクターのなり得る性格の性格 ID だ。
			</p>
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>
    <div class="navigation"><hr /><table><tr><td class="online-navigation"><a href="dq3_pub.html" title="5.14. ルイーダの酒場解析"><img src="image/docbook/prev.png" alt="戻る" /></a></td><td class="online-navigation"><a href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)"><img src="image/docbook/up.png" alt="上に戻る" /></a></td><td class="online-navigation"><a href="dq3_bank.html" title="5.16. ゴールド銀行解析"><img src="image/docbook/next.png" alt="次へ" /></a></td><td>ドラクエ命</td><td class="online-navigation"><a href="index.html" title="ドラクエ命"><img src="image/docbook/home.png" alt="ホーム" /></a></td><td class="online-navigation"><a href="" title=""><img src="image/docbook/index.png" alt="索引" /></a></td></tr></table><b class="navlabel">Previous: </b><a accesskey="p" class="sectref" href="dq3_pub.html">5.14. ルイーダの酒場解析</a> <b class="navlabel">Up: </b><a accesskey="u" class="sectref" href="dq3.html">第 5 章 SFC 版ドラクエ 3 (1996)</a> <b class="navlabel">Next: </b><a accesskey="n" class="sectref" href="dq3_bank.html">5.16. ゴールド銀行解析</a></div>
  </body>
</html>
