<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>5.29. しらべる</title>
    <link rel="stylesheet" type="text/css" href="dqbook.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="home" href="index.html" title="ドラクエ命" />
    <link rel="up" href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)" />
    <link rel="prev" href="dq3_locations.html" title="5.28. 空間情報" />
    <link rel="next" href="dq3_encounter.html" title="5.30. 敵との遭遇" />
  </head>
  <body>
    <div class="navigation"><table><tr><td class="online-navigation"><a href="dq3_locations.html" title="5.28. 空間情報"><img src="image/docbook/prev.png" alt="戻る" /></a></td><td class="online-navigation"><a href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)"><img src="image/docbook/up.png" alt="上に戻る" /></a></td><td class="online-navigation"><a href="dq3_encounter.html" title="5.30. 敵との遭遇"><img src="image/docbook/next.png" alt="次へ" /></a></td><td>ドラクエ命</td><td class="online-navigation"><a href="index.html" title="ドラクエ命"><img src="image/docbook/home.png" alt="ホーム" /></a></td><td class="online-navigation"><a href="" title=""><img src="image/docbook/index.png" alt="索引" /></a></td></tr></table><b class="navlabel">Previous: </b><a accesskey="p" class="sectref" href="dq3_locations.html">5.28. 空間情報</a> <b class="navlabel">Up: </b><a accesskey="u" class="sectref" href="dq3.html">第 5 章 SFC 版ドラクエ 3 (1996)</a> <b class="navlabel">Next: </b><a accesskey="n" class="sectref" href="dq3_encounter.html">5.30. 敵との遭遇</a><hr /></div>
    <div class="section">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a id="dq3.search"></a>5.29. しらべる</h2>
          </div>
        </div>
      </div>
      <div class="toc">
        <dl class="toc">
          <dt>
            <span class="section">
              <a href="dq3_search.html#dq3.search.model">5.29.1. モデル</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="dq3_search.html#dq3.search.model.C898E2">5.29.1.1. 構造体 <code class="varname">$C898E2</code>: 「しらべる」対象分類</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_search.html#dq3.search.model.base">5.29.1.2. 「しらべる」対象抽象基底構造体</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_search.html#dq3.search.model.C87067">5.29.1.3. 構造体 <code class="varname">$C87067</code>: アイテム発見</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_search.html#dq3.search.model.C87C99">5.29.1.4. 構造体 <code class="varname">$C87C99</code>: ゴールド発見</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_search.html#dq3.search.model.C87DB1">5.29.1.5. 構造体 <code class="varname">$C87DB1</code>: 情報取得</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_search.html#dq3.search.model.C88185">5.29.1.6. 構造体 <code class="varname">$C88185</code>: 罠</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_search.html#dq3.search.model.C88218">5.29.1.7. 構造体 <code class="varname">$C88218</code>: 特殊イベント</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="section">
              <a href="dq3_search.html#dq3.search.process">5.29.2. 処理手順</a>
            </span>
          </dt>
        </dl>
      </div>
      <p>
本節では移動コマンド「しらべる」の実装詳細について述べる。
まずは「しらべる」コマンドの対象であるオブジェクトのすべてを表現する ROM データの構造について説明する。
また、それらの構造それぞれについて、その型のオブジェクトデータを解釈して得られるテキスト CSV ファイルを提示する。
それから「しらべる」コマンドを実行するときのプログラムの手順を、可能な限りコードを引用した上で説明する。
</p>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="dq3.search.model"></a>5.29.1. モデル</h3>
            </div>
          </div>
        </div>
        <p>
本節では移動コマンド「しらべる」に直接関係するデータ構造を説明していく。
本質的には前作モデルのマイナーチェンジでしかないので、
<a class="xref" href="dq6_search.html#dq6.search.model" title="4.5.1. モデル">4.5.1 モデル</a> での説明が通用する要素についてはここでは繰り返さない。
また、読者の必要に応じて <a class="xref" href="appendix_b.html" title="付録 B データ">付録 B <em>データ</em></a> に収録したデータを確認しながら読んで欲しい。
</p>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.search.model.C898E2"></a>5.29.1.1. 構造体 <code class="varname">$C898E2</code>: 「しらべる」対象分類</h4>
              </div>
            </div>
          </div>
          <p>
アドレス <code class="varname">$C898E2</code> には以下に示すメモリレイアウトのオブジェクトが 30 弱配列されている。
この構造体は前作の <a class="xref" href="dq6_search.html#dq6.search.model.C20000" title="4.5.1.1. 構造体 $C20000: 「しらべる」対象分類">4.5.1.1 構造体 <code class="varname">$C20000</code>: 「しらべる」対象分類</a> と同じ役割がある。
</p>
          <div class="table">
            <a id="table.dq3.search.model.C898E2"></a>
            <p class="title">
              <strong>表 5.66 構造体 $C898E2</strong>
            </p>
            <div class="table-contents">
              <table id="table.dq3.search.model.C898E2" class="lighttable">
                <thead>
                  <tr>
                    <th>オフセット</th>
                    <th>桁</th>
                    <th>属性</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <code class="literal">#$00</code>
                    </td>
                    <td>
                      <code class="literal">#$00F0</code>
                    </td>
                    <td>ヒットテスト座標成分上限</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$00</code>
                    </td>
                    <td>
                      <code class="literal">#$000F</code>
                    </td>
                    <td>ヒットテスト座標成分右限</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$01</code>
                    </td>
                    <td>
                      <code class="literal">#$00F0</code>
                    </td>
                    <td>ヒットテスト座標成分下限</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$01</code>
                    </td>
                    <td>
                      <code class="literal">#$000F</code>
                    </td>
                    <td>ヒットテスト座標成分左限</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$02</code>
                    </td>
                    <td>
                      <code class="literal">#$0007</code>
                    </td>
                    <td>キャラクターが上向きのときの対応座標成分オフセット</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$02</code>
                    </td>
                    <td>
                      <code class="literal">#$01C0</code>
                    </td>
                    <td>キャラクターが右向きのときの対応座標成分オフセット</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$02</code>
                    </td>
                    <td>
                      <code class="literal">#$0038</code>
                    </td>
                    <td>キャラクターが下向きのときの対応座標成分オフセット</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$0010</code>
                    </td>
                    <td>キャラクターが左向きのときの対応座標成分オフセット</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$0020</code>
                    </td>
                    <td>キャラクターが上向き禁止</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$0040</code>
                    </td>
                    <td>キャラクターが右向き禁止</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$0080</code>
                    </td>
                    <td>キャラクターが下向き禁止</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$000E</code>
                    </td>
                    <td>キャラクターが左向き禁止</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$04</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td>初訪問時のメッセージ</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$06</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td>無効な方向からのメッセージ</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$08</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td>罠であるときのメッセージ</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$0A</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td>何もないときのメッセージ</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$0C</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td>再訪問時のメッセージ</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$0E</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td>王さま用実行メッセージ</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$10</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td>王さま用結果メッセージ</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$12</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td>女王さま用実行メッセージ</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$14</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td>女王さま用結果メッセージ</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$16</code>
                    </td>
                    <td>
                      <code class="literal">#$01FF</code>
                    </td>
                    <td>初訪問時の効果音</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$17</code>
                    </td>
                    <td>
                      <code class="literal">#$03FE</code>
                    </td>
                    <td>再訪問時の効果音</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p>
以下、前作の対応構造体に存在しない属性しか記さない。次節以降も同様。
</p>
          <div class="variablelist">
            <dl class="variablelist">
              <dt>
                <span class="term">王さま用実行メッセージ, </span>
                <span class="term">王さま用結果メッセージ</span>
              </dt>
              <dd>
                <p>
        これらの属性は、主人公がロマリアで王様になっているときに参照される。
        主人公が何をしらべても、これらの値を ID とするメッセージがウィンドウに出力され、
        「しらべる」対象の状態が変化することを防ぐ。
      </p>
              </dd>
              <dt>
                <span class="term">女王さま用実行メッセージ, </span>
                <span class="term">女王さま用結果メッセージ</span>
              </dt>
              <dd>
                <p>
        これらの属性は、主人公が女勇者のときのロマリアイベントで参照される。
        上述の対と同じ意味がこれらの属性にはある。
      </p>
              </dd>
            </dl>
          </div>
          <p>
以降、本節ではロマリアで王様なり女王様なりにさせられたときの状態をロマリアモードと称することにする。
</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.search.model.base"></a>5.29.1.2. 「しらべる」対象抽象基底構造体</h4>
              </div>
            </div>
          </div>
          <p>
前作と設計が同様であるため、本節でも次のような概念上の構造体を導入しておく。
これを抽象クラスとみなして、後述の構造体群をその派生クラスとみなすことで論理的な構造を見通しやすくなるはずだ。
</p>
          <div class="table">
            <a id="table.dq3.search.model.base"></a>
            <p class="title">
              <strong>表 5.67 「しらべる」対象抽象基底構造体</strong>
            </p>
            <div class="table-contents">
              <table id="table.dq3.search.model.base" class="lighttable">
                <thead>
                  <tr>
                    <th>オフセット</th>
                    <th>桁</th>
                    <th>属性</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <code class="literal">#$00</code>
                    </td>
                    <td>
                      <code class="literal">#$001F</code>
                    </td>
                    <td>分類</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$00</code>
                    </td>
                    <td>
                      <code class="literal">#$3FE0</code>
                    </td>
                    <td>MX</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$01</code>
                    </td>
                    <td>
                      <code class="literal">#$7FC0</code>
                    </td>
                    <td>MY</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$02</code>
                    </td>
                    <td>
                      <code class="literal">#$0180</code>
                    </td>
                    <td>LV</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$007E</code>
                    </td>
                    <td>描画関連</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p>
これについては属性を省略しないで説明しておきたい。
</p>
          <div class="variablelist">
            <dl class="variablelist">
              <dt>
                <span class="term">分類</span>
              </dt>
              <dd>
                <p>
        分類とは、<a class="xref" href="dq3_search.html#dq3.search.model.C898E2" title="5.29.1.1. 構造体 $C898E2: 「しらべる」対象分類">5.29.1.1 構造体 <code class="varname">$C898E2</code>: 「しらべる」対象分類</a> オブジェクト ID を値とする属性だ。
        この値が「足もと」「宝箱」「ツボ」「タル」等々を表現していると解釈できる。
        これは前作にもあった属性だ。
      </p>
              </dd>
              <dt>
                <span class="term">MX, </span>
                <span class="term">MY</span>
              </dt>
              <dd>
                <p>
        MX または MY とは、それぞれこのオブジェクトの位置する MX または MY 座標を M 座標系で表現した値をとる属性だ。
        これらの属性は前作モデルにも存在する。
      </p>
              </dd>
              <dt>
                <span class="term">LV</span>
              </dt>
              <dd>
                <p>
        LV とは、これも前作から引き継いだ概念の属性であり、このオブジェクトが存在する空間内のどの「高さ」に配置されるかを示す値をとる属性だ。
      </p>
              </dd>
              <dt>
                <span class="term">描画関連</span>
              </dt>
              <dd>
                <p>
        描画関連とは、このオブジェクトがどのように描画されるのかを制御する数をとる属性だと思われる。
        既に開封済みの宝箱のスプライトをどうするか、等に影響を与えるのではないだろうか。
        本書では現在詳細不明の属性だ。
      </p>
              </dd>
            </dl>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.search.model.C87067"></a>5.29.1.3. 構造体 <code class="varname">$C87067</code>: アイテム発見</h4>
              </div>
            </div>
          </div>
          <p>
アドレス <code class="varname">$C87067</code> には以下に示すメモリレイアウトのオブジェクトが 450 弱配列されている。
この構造体は前作の <a class="xref" href="dq6_search.html#dq6.search.model.C83E5C" title="4.5.1.3. 構造体 $C83E5C: アイテム発見">4.5.1.3 構造体 <code class="varname">$C83E5C</code>: アイテム発見</a> と同じ役割がある。
</p>
          <div class="table">
            <a id="table.dq3.search.model.C87067"></a>
            <p class="title">
              <strong>表 5.68 構造体 $C87067</strong>
            </p>
            <div class="table-contents">
              <table id="table.dq3.search.model.C87067" class="lighttable">
                <thead>
                  <tr>
                    <th>オフセット</th>
                    <th>桁</th>
                    <th>属性</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <code class="literal">#$00</code>
                    </td>
                    <td>
                      <code class="literal">#$001F</code>
                    </td>
                    <td>分類</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$00</code>
                    </td>
                    <td>
                      <code class="literal">#$3FE0</code>
                    </td>
                    <td>MX</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$01</code>
                    </td>
                    <td>
                      <code class="literal">#$7FC0</code>
                    </td>
                    <td>MY</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$02</code>
                    </td>
                    <td>
                      <code class="literal">#$0180</code>
                    </td>
                    <td>LV</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$007E</code>
                    </td>
                    <td>描画関連</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$7F80</code>
                    </td>
                    <td>アイテム</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$04</code>
                    </td>
                    <td>
                      <code class="literal">#$0080</code>
                    </td>
                    <td>（未使用）</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$05</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td>フラグ</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p>
以下、抽象基底構造体にない属性しか記述しない（後続の構造体も同様）。
</p>
          <div class="variablelist">
            <dl class="variablelist">
              <dt>
                <span class="term">アイテム</span>
              </dt>
              <dd>
                <p>
        アイテムとは、この対象を「しらべる」ことによって入手できるアイテムの ID を値とする属性だ。
        前作同様。
      </p>
              </dd>
              <dt>
                <span class="term">フラグ</span>
              </dt>
              <dd>
                <p>
        フラグ ID とは、この対象が調査済みであるかどうかを管理するフラグの ID を値とする属性だ。
        仕様は前作と同様だが、本作ではフラグビット列のベースアドレスは <code class="varname">$7E353A</code> だ。
      </p>
              </dd>
            </dl>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.search.model.C87C99"></a>5.29.1.4. 構造体 <code class="varname">$C87C99</code>: ゴールド発見</h4>
              </div>
            </div>
          </div>
          <p>
アドレス <code class="varname">$C8477E</code> には以下に示すメモリレイアウトのオブジェクトが 30 以上配列されている。
この構造体は前作の <a class="xref" href="dq6_search.html#dq6.search.model.C8477E" title="4.5.1.4. 構造体 $C8477E: ゴールド発見">4.5.1.4 構造体 <code class="varname">$C8477E</code>: ゴールド発見</a> と同じ役割がある。
</p>
          <div class="table">
            <a id="table.dq3.search.model.C87C99"></a>
            <p class="title">
              <strong>表 5.69 構造体 $C87C99</strong>
            </p>
            <div class="table-contents">
              <table id="table.dq3.search.model.C87C99" class="lighttable">
                <thead>
                  <tr>
                    <th>オフセット</th>
                    <th>桁</th>
                    <th>属性</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <code class="literal">#$00</code>
                    </td>
                    <td>
                      <code class="literal">#$001F</code>
                    </td>
                    <td>分類</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$00</code>
                    </td>
                    <td>
                      <code class="literal">#$3FE0</code>
                    </td>
                    <td>MX</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$01</code>
                    </td>
                    <td>
                      <code class="literal">#$7FC0</code>
                    </td>
                    <td>MY</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$02</code>
                    </td>
                    <td>
                      <code class="literal">#$0180</code>
                    </td>
                    <td>LV</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$007E</code>
                    </td>
                    <td>描画関連</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$04</code>
                    </td>
                    <td>
                      <code class="literal">#$0080</code>
                    </td>
                    <td>（未使用）</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$04</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td>ゴールド</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$06</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td>フラグ</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <div class="variablelist">
            <dl class="variablelist">
              <dt>
                <span class="term">ゴールド</span>
              </dt>
              <dd>
                <p>
        ゴールドとは、このオブジェクトを「しらべる」ことで入手できるゴールドの正味の額面を値とする属性だ。
        前作とは異なり、金額が直接一つの属性値として表現されている。
      </p>
              </dd>
            </dl>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.search.model.C87DB1"></a>5.29.1.5. 構造体 <code class="varname">$C87DB1</code>: 情報取得</h4>
              </div>
            </div>
          </div>
          <p>
アドレス <code class="varname">$C848B6</code> には以下に示すメモリレイアウトのオブジェクトが 140 配列されている。
この構造体は前作の <a class="xref" href="dq6_search.html#dq6.search.model.C848B6" title="4.5.1.5. 構造体 $C848B6: 情報取得">4.5.1.5 構造体 <code class="varname">$C848B6</code>: 情報取得</a> と同じ役割がある。
</p>
          <div class="table">
            <a id="table.dq3.search.model.C87DB1"></a>
            <p class="title">
              <strong>表 5.70 構造体 $C87DB1</strong>
            </p>
            <div class="table-contents">
              <table id="table.dq3.search.model.C87DB1" class="lighttable">
                <thead>
                  <tr>
                    <th>オフセット</th>
                    <th>桁</th>
                    <th>属性</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <code class="literal">#$00</code>
                    </td>
                    <td>
                      <code class="literal">#$001F</code>
                    </td>
                    <td>分類</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$00</code>
                    </td>
                    <td>
                      <code class="literal">#$3FE0</code>
                    </td>
                    <td>MX</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$01</code>
                    </td>
                    <td>
                      <code class="literal">#$7FC0</code>
                    </td>
                    <td>MY</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$02</code>
                    </td>
                    <td>
                      <code class="literal">#$0180</code>
                    </td>
                    <td>LV</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$007E</code>
                    </td>
                    <td>描画関連</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$0080</code>
                    </td>
                    <td>とうぞくのはな</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$04</code>
                    </td>
                    <td>
                      <code class="literal">#$0001</code>
                    </td>
                    <td>レミラーマ</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$05</code>
                    </td>
                    <td>
                      <code class="literal">#$00FE</code>
                    </td>
                    <td>（未使用）</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$05</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td>メッセージ</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p>
派生部分の属性については前作と同様につき、説明を省く。
<a class="xref" href="dq6_search.html#dq6.search.model.C848B6" title="4.5.1.5. 構造体 $C848B6: 情報取得">4.5.1.5 構造体 <code class="varname">$C848B6</code>: 情報取得</a> を参照して欲しい。
</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.search.model.C88185"></a>5.29.1.6. 構造体 <code class="varname">$C88185</code>: 罠</h4>
              </div>
            </div>
          </div>
          <p>
アドレス <code class="varname">$C85534</code> には以下に示すメモリレイアウトのオブジェクトが 20 強配列されている。
この構造体は前作の <a class="xref" href="dq6_search.html#dq6.search.model.C85534" title="4.5.1.6. 構造体 $C85534: 罠">4.5.1.6 構造体 <code class="varname">$C85534</code>: 罠</a> と同じ役割がある。
</p>
          <div class="table">
            <a id="table.dq3.search.model.C88185"></a>
            <p class="title">
              <strong>表 5.71 構造体 $C85534</strong>
            </p>
            <div class="table-contents">
              <table id="table.dq3.search.model.C88185" class="lighttable">
                <thead>
                  <tr>
                    <th>オフセット</th>
                    <th>桁</th>
                    <th>属性</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <code class="literal">#$00</code>
                    </td>
                    <td>
                      <code class="literal">#$001F</code>
                    </td>
                    <td>分類</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$00</code>
                    </td>
                    <td>
                      <code class="literal">#$3FE0</code>
                    </td>
                    <td>MX</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$01</code>
                    </td>
                    <td>
                      <code class="literal">#$7FC0</code>
                    </td>
                    <td>MY</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$02</code>
                    </td>
                    <td>
                      <code class="literal">#$0180</code>
                    </td>
                    <td>LV</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$007E</code>
                    </td>
                    <td>描画関連</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$1F80</code>
                    </td>
                    <td>イベント戦</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$05</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td>フラグ</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <div class="variablelist">
            <dl class="variablelist">
              <dt>
                <span class="term">イベント戦</span>
              </dt>
              <dd>
                <p>
        この属性値は配列 <code class="varname">$C8AC66</code> のインデックス、
        すなわち「しらべる」コマンド実行後に発生する戦闘に対するイベント戦の ID だ。
      </p>
              </dd>
            </dl>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.search.model.C88218"></a>5.29.1.7. 構造体 <code class="varname">$C88218</code>: 特殊イベント</h4>
              </div>
            </div>
          </div>
          <p>
アドレス <code class="varname">$C855AB</code> には以下に示すメモリレイアウトのオブジェクトが 140 配列されている。
この構造体は前作の <a class="xref" href="dq6_search.html#dq6.search.model.C855AB" title="4.5.1.7. 構造体 $C855AB: 特殊イベント">4.5.1.7 構造体 <code class="varname">$C855AB</code>: 特殊イベント</a> と同じ役割がある。
</p>
          <div class="table">
            <a id="table.dq3.search.model.C88218"></a>
            <p class="title">
              <strong>表 5.72 構造体 $C88218</strong>
            </p>
            <div class="table-contents">
              <table id="table.dq3.search.model.C88218" class="lighttable">
                <thead>
                  <tr>
                    <th>オフセット</th>
                    <th>桁</th>
                    <th>属性</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <code class="literal">#$00</code>
                    </td>
                    <td>
                      <code class="literal">#$001F</code>
                    </td>
                    <td>分類</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$00</code>
                    </td>
                    <td>
                      <code class="literal">#$3FE0</code>
                    </td>
                    <td>MX</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$01</code>
                    </td>
                    <td>
                      <code class="literal">#$7FC0</code>
                    </td>
                    <td>MY</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$02</code>
                    </td>
                    <td>
                      <code class="literal">#$0180</code>
                    </td>
                    <td>LV</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$007E</code>
                    </td>
                    <td>描画関連</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$0080</code>
                    </td>
                    <td>とうぞくのはな</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$04</code>
                    </td>
                    <td>
                      <code class="literal">#$0001</code>
                    </td>
                    <td>レミラーマ</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$04</code>
                    </td>
                    <td>
                      <code class="literal">#$00FE</code>
                    </td>
                    <td>（未使用）</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$05</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td rowspan="2">しらべる処理</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$07</code>
                    </td>
                    <td>
                      <code class="literal">#$00FF</code>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$08</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td rowspan="2">インパス処理</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$0A</code>
                    </td>
                    <td>
                      <code class="literal">#$00FF</code>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$0B</code>
                    </td>
                    <td>
                      <code class="literal">#$FFFF</code>
                    </td>
                    <td>フラグ</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <div class="variablelist">
            <dl class="variablelist">
              <dt>
                <span class="term">インパス処理</span>
              </dt>
              <dd>
                <p>
        インパス処理とは、このオブジェクトに移動コマンド「インパス」を適用したときの処理の開始アドレスを値とする属性だ。
        前作ではオブジェクトの型および中身で色を決定したが、本作ではサブルーチンへのジャンプで実装されている。
        しかし、データによると各処理の中身は定数を共通する変数に設定するだけに過ぎない。
      </p>
              </dd>
            </dl>
          </div>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="dq3.search.process"></a>5.29.2. 処理手順</h3>
            </div>
          </div>
        </div>
        <p>
サブルーチン <code class="varname">$C66F59</code> が「しらべる」処理の主要部だ。
以下に主要処理、各工程失敗時の処理、後始末処理の流れを述べるが、
そのうちの <a class="xref" href="dq6_search.html#dq6.search.process" title="4.5.2. 処理手順">4.5.2 処理手順</a> と同様の工程については説明を繰り返さない。
</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt>
              <span class="term">意味のないテストをする</span>
            </dt>
            <dd>
              <p>
        単にキャリーレジスターをオンにするだけのサブルーチンを呼び出すが、これは前作コードの残骸だ。
        仮にパーティー全員がカンオケ状態であったとしても、
        <span class="quote">「<span class="quote">このままでは 調べられない！</span>」</span>のメッセージをプレイヤーが目にすることはないはずだ。
      </p>
            </dd>
            <dt>
              <span class="term">各種変数を設定・保存する</span>
            </dt>
            <dd>
              <p>
        この工程は前作とほぼ同様だ。
        生存状態のパーティーメンバーを一人、
        および「しらべる」処理最中であることを示すフラグを設定・保存しておく。
      </p>
            </dd>
            <dt>
              <span class="term">乗り物を使用中かどうかテストする</span>
            </dt>
            <dd>
              <p>
        参照する変数が <code class="varname">$7EDB05</code> となるが、前作の対応工程と同様だ。
      </p>
            </dd>
            <dt>
              <span class="term">「しらべる」対象があるかどうかテストする</span>
            </dt>
            <dd>
              <p>
        前作の対応工程と同様だ。
      </p>
            </dd>
            <dt>
              <span class="term">ロマリアモードかどうかテストする</span>
            </dt>
            <dd>
              <p>
        この工程は本作固有のものだ。
        変数 <code class="varname">$7E354F</code> のビット <code class="literal">#$0002</code> をテストすることで、現在ロマリアモードどうかを判定する。
        もしそうであれば、後述のロマリアモード専用工程に処理を移る。
      </p>
            </dd>
            <dt>
              <span class="term">パーティー先頭者と対象との向きがマッチしているかテストする</span>
            </dt>
            <dd>
              <p>
        前作の対応工程と同様だ。
      </p>
            </dd>
            <dt>
              <span class="term">対象が調査済みであるかどうかをテストする</span>
            </dt>
            <dd>
              <p>
        前作の対応工程と同様だ。
      </p>
            </dd>
            <dt>
              <span class="term">初めて対象を「しらべる」場合</span>
            </dt>
            <dd>
              <p>
        前作の対応工程と同様だ。ただしデータ構造の変化に伴う変更がある。
      </p>
              <div class="variablelist">
                <dl class="variablelist">
                  <dt>
                    <span class="term">アイテム発見</span>
                  </dt>
                  <dd>
                    <p>
              対象の分類がアイテムであれば、パーティーはオブジェクトに設定されたアイテムを入手する。
              万が一アイテムを表す属性値がゼロである場合は、何もないときのメッセージの出力しかしない。
            </p>
                    <p>
              メッセージ<span class="quote">「<span class="quote">なんと！[AD][B5]を みつけた！</span>」</span>を出力した直後で行う、
              発見アイテムのアイコン表示と効果音再生における若干処理は、
              アイテムが処分可能かつ希少であるかそれ以外であるかで異なるのだが、詳細は割愛する。
            </p>
                    <p>
              残りの処理は前作と同様だ。
              余談だが、ふくろの利用可能判定も一応行っており、
              変数 <code class="varname">$7E353E</code> のビット <code class="literal">#$0001</code> が立っている必要がある。
              このような判定はプログラム全体を通してここにしかないと思われる。
            </p>
                  </dd>
                  <dt>
                    <span class="term">ゴールド発見</span>
                  </dt>
                  <dd>
                    <p>
              対象の分類がゴールドであれば、しらべる対象のゴールド属性をそのまま参照し、
              メッセージ<span class="quote">「<span class="quote">[C0]は[AD][BB]ゴールドを 手に入れた。</span>」</span>を出力してから、
              パーティー所持金のその金額を直接加算する。
            </p>
                  </dd>
                  <dt>
                    <span class="term">情報取得, </span>
                    <span class="term">罠, </span>
                    <span class="term">特殊イベント</span>
                  </dt>
                  <dd>
                    <p>
              それぞれ前作と同様だ。
            </p>
                  </dd>
                </dl>
              </div>
            </dd>
            <dt>
              <span class="term">「しらべる」コマンドの後始末前のテスト</span>
            </dt>
            <dd>
              <p>
        前作と同様だ。
      </p>
            </dd>
          </dl>
        </div>
        <p>
本流の処理中に何らかのテストが失敗したときに処理される工程を以下に示す。
ここに挙げる工程それぞれにはお互いに関係しない。
また、いずれの工程の終了後も後述の後始末処理に移るものだ。
</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt>
              <span class="term">何もない場合</span>
            </dt>
            <dd>
              <p>
        まずロマリアモードかどうかのテストを実施する。これは前述した方法と同じようにする。
        ロマリアモードでない場合には、現在使用中の乗り物に応じてメッセージを 2 通出力する。
      </p>
              <div class="table">
                <a id="table.dq3.search.process.C67171"></a>
                <p class="title">
                  <strong>表 5.73 配列 $C67171: 何もないときのメッセージ</strong>
                </p>
                <div class="table-contents">
                  <table id="table.dq3.search.process.C67171" class="lighttable">
                    <thead>
                      <tr>
                        <th>乗り物</th>
                        <th>メッセージ</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>徒歩</td>
                        <td>[C0]は 足もとを 調べた！[AF]</td>
                      </tr>
                      <tr>
                        <td>船</td>
                        <td>[C0]は 水面を 目をこらして[AD]みつめた。[AF]</td>
                      </tr>
                      <tr>
                        <td>船（不明）</td>
                        <td>[C0]は 水面を 目をこらして[AD]みつめた。[AF]</td>
                      </tr>
                      <tr>
                        <td>船（屋内）</td>
                        <td>[C0]は 水面を 目をこらして[AD]みつめた。[AF]</td>
                      </tr>
                      <tr>
                        <td>ラーミア</td>
                        <td>[C0]は 大空から[AD]大地をながめた。[AF]</td>
                      </tr>
                      <tr>
                        <td>船（アレフガルド）</td>
                        <td>[C0]は 水面を 目をこらして[AD]みつめた。[AF]</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <br class="table-break" />
              <div class="table">
                <a id="table.dq3.search.process.C6717D"></a>
                <p class="title">
                  <strong>表 5.74 配列 $C6717D: 何もないときのメッセージ</strong>
                </p>
                <div class="table-contents">
                  <table id="table.dq3.search.process.C6717D" class="lighttable">
                    <thead>
                      <tr>
                        <th>乗り物</th>
                        <th>メッセージ</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>徒歩</td>
                        <td>しかし 何も 見つからなかった。</td>
                      </tr>
                      <tr>
                        <td>船</td>
                        <td>しかし 何も 見つからなかった。</td>
                      </tr>
                      <tr>
                        <td>船（不明）</td>
                        <td>しかし 何も 見つからなかった。</td>
                      </tr>
                      <tr>
                        <td>船（屋内）</td>
                        <td>しかし 何も 見つからなかった。</td>
                      </tr>
                      <tr>
                        <td>ラーミア</td>
                        <td>しかし 空からでは よく わからない！</td>
                      </tr>
                      <tr>
                        <td>船（アレフガルド）</td>
                        <td>しかし 何も 見つからなかった。</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <br class="table-break" />
            </dd>
            <dt>
              <span class="term">無効な方向からしらべた場合</span>
            </dt>
            <dd>
              <p>
        前作の対応工程と同様だ。
      </p>
            </dd>
            <dt>
              <span class="term">ロマリアモード</span>
            </dt>
            <dd>
              <p>
        しらべる対象の分類とパーティー先頭の性別でパラメーター化されている。
        パーティー先頭の性別がおんなならば、女王さま用実行メッセージと女王さま用結果メッセージを出力し、
        そうでなければ、王さま用実行メッセージと王さま用結果メッセージを出力する。
        どちらの場合でも、メッセージの間にメッセージ ID <code class="literal">#$0150</code> が割り込む。
      </p>
            </dd>
            <dt>
              <span class="term">調査済みの場合</span>
            </dt>
            <dd>
              <p>
        前作の対応工程と同様だ。
      </p>
            </dd>
          </dl>
        </div>
        <p>
後処理処理は前作と同様だ。
</p>
      </div>
    </div>
    <div class="navigation"><hr /><table><tr><td class="online-navigation"><a href="dq3_locations.html" title="5.28. 空間情報"><img src="image/docbook/prev.png" alt="戻る" /></a></td><td class="online-navigation"><a href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)"><img src="image/docbook/up.png" alt="上に戻る" /></a></td><td class="online-navigation"><a href="dq3_encounter.html" title="5.30. 敵との遭遇"><img src="image/docbook/next.png" alt="次へ" /></a></td><td>ドラクエ命</td><td class="online-navigation"><a href="index.html" title="ドラクエ命"><img src="image/docbook/home.png" alt="ホーム" /></a></td><td class="online-navigation"><a href="" title=""><img src="image/docbook/index.png" alt="索引" /></a></td></tr></table><b class="navlabel">Previous: </b><a accesskey="p" class="sectref" href="dq3_locations.html">5.28. 空間情報</a> <b class="navlabel">Up: </b><a accesskey="u" class="sectref" href="dq3.html">第 5 章 SFC 版ドラクエ 3 (1996)</a> <b class="navlabel">Next: </b><a accesskey="n" class="sectref" href="dq3_encounter.html">5.30. 敵との遭遇</a></div>
  </body>
</html>
