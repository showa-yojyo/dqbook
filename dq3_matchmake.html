<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>5.20. 格闘場</title>
    <link rel="stylesheet" type="text/css" href="dqbook.css" />
    <meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" />
    <link rel="home" href="index.html" title="ドラクエ命" />
    <link rel="up" href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)" />
    <link rel="prev" href="dq3_rename.html" title="5.19. 命名神" />
    <link rel="next" href="dq3_horoscope.html" title="5.21. 星座" />
  </head>
  <body>
    <div class="navigation"><table><tr><td class="online-navigation"><a href="dq3_rename.html" title="5.19. 命名神"><img src="image/docbook/prev.png" alt="戻る" /></a></td><td class="online-navigation"><a href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)"><img src="image/docbook/up.png" alt="上に戻る" /></a></td><td class="online-navigation"><a href="dq3_horoscope.html" title="5.21. 星座"><img src="image/docbook/next.png" alt="次へ" /></a></td><td>ドラクエ命</td><td class="online-navigation"><a href="index.html" title="ドラクエ命"><img src="image/docbook/home.png" alt="ホーム" /></a></td><td class="online-navigation"><a href="" title=""><img src="image/docbook/index.png" alt="索引" /></a></td></tr></table><b class="navlabel">Previous: </b><a accesskey="p" class="sectref" href="dq3_rename.html">5.19. 命名神</a> <b class="navlabel">Up: </b><a accesskey="u" class="sectref" href="dq3.html">第 5 章 SFC 版ドラクエ 3 (1996)</a> <b class="navlabel">Next: </b><a accesskey="n" class="sectref" href="dq3_horoscope.html">5.21. 星座</a><hr /></div>
    <div class="section">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a id="dq3.matchmake"></a>5.20. 格闘場</h2>
          </div>
        </div>
      </div>
      <div class="toc">
        <dl class="toc">
          <dt>
            <span class="section">
              <a href="dq3_matchmake.html#dq3.matchmake.structure">5.20.1. 構造に関する構成要素</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="dq3_matchmake.html#dq3.matchmake.structure.C30DC5">5.20.1.1. 構造体 <code class="varname">$C30DC5</code>: マッチメイク</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="section">
              <a href="dq3_matchmake.html#dq3.matchmake.behavior">5.20.2. 振る舞いに関する構成要素</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="dq3_matchmake.html#dq3.matchmake.behavior.C3EC84">5.20.2.1. サブルーチン <code class="varname">$C3EC84</code>: マッチメイク処理</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_matchmake.html#dq3.matchmake.behavior.C3EE64">5.20.2.2. サブルーチン <code class="varname">$C3EE64</code>: 格闘場処理</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_matchmake.html#dq3.matchmake.behavior.C3EFBE">5.20.2.3. サブルーチン <code class="varname">$C3EFBE</code>: 予想屋処理</a>
                </span>
              </dt>
            </dl>
          </dd>
        </dl>
      </div>
      <p>
本節では格闘場について述べる。
</p>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="dq3.matchmake.structure"></a>5.20.1. 構造に関する構成要素</h3>
            </div>
          </div>
        </div>
        <p>
格闘場に関する各種データ構造について述べる。
</p>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.matchmake.structure.C30DC5"></a>5.20.1.1. 構造体 <code class="varname">$C30DC5</code>: マッチメイク</h4>
              </div>
            </div>
          </div>
          <p>
アドレス <code class="varname">$C30DC5</code> には下に示すような構造のオブジェクトが配列されている。
このそれぞれが格闘場での一試合を表現している。
</p>
          <div class="table">
            <a id="table.dq3.C30DC5"></a>
            <p class="title">
              <strong>表 5.41 構造体 $C30DC5</strong>
            </p>
            <div class="table-contents">
              <table id="table.dq3.C30DC5" class="lighttable">
                <thead>
                  <tr>
                    <th>オフセット</th>
                    <th>桁</th>
                    <th>属性</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <code class="literal">#$00</code>
                    </td>
                    <td>
                      <code class="literal">#$00FF</code>
                    </td>
                    <td>モンスター 0</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$01</code>
                    </td>
                    <td>
                      <code class="literal">#$00FF</code>
                    </td>
                    <td>オッズ 0</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$02</code>
                    </td>
                    <td>
                      <code class="literal">#$00FF</code>
                    </td>
                    <td>モンスター 1</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$03</code>
                    </td>
                    <td>
                      <code class="literal">#$00FF</code>
                    </td>
                    <td>オッズ 1</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$04</code>
                    </td>
                    <td>
                      <code class="literal">#$00FF</code>
                    </td>
                    <td>モンスター 2</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$05</code>
                    </td>
                    <td>
                      <code class="literal">#$00FF</code>
                    </td>
                    <td>オッズ 2</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$06</code>
                    </td>
                    <td>
                      <code class="literal">#$00FF</code>
                    </td>
                    <td>モンスター 3</td>
                  </tr>
                  <tr>
                    <td>
                      <code class="literal">#$07</code>
                    </td>
                    <td>
                      <code class="literal">#$00FF</code>
                    </td>
                    <td>オッズ 3</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p>
以下、このオブジェクト型の各属性の意味を記す。
</p>
          <div class="variablelist">
            <dl class="variablelist">
              <dt>
                <span class="term">モンスター k (k = 0..3)</span>
              </dt>
              <dd>
                <p>
        この試合に出場するモンスターを表すモンスター ID を値に取る属性だ。
        モンスターについては <a class="xref" href="dq3_monsters.html" title="5.5. モンスター">5.5 モンスター</a> で述べる。
      </p>
              </dd>
              <dt>
                <span class="term">オッズ k (k = 0..3)</span>
              </dt>
              <dd>
                <p>
        モンスター k のオッズの基になる表す数を値に取る属性だ。
      </p>
              </dd>
            </dl>
          </div>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="dq3.matchmake.behavior"></a>5.20.2. 振る舞いに関する構成要素</h3>
            </div>
          </div>
        </div>
        <p>
格闘場に関するさまざまな振る舞いについて述べる。
</p>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.matchmake.behavior.C3EC84"></a>5.20.2.1. サブルーチン <code class="varname">$C3EC84</code>: マッチメイク処理</h4>
              </div>
            </div>
          </div>
          <p>
マッチメイクを担当するサブルーチンは <code class="varname">$C3EC84</code> で定義されている。
これは画面が格闘場内に切り替わったときに呼び出される。
以下、処理の要点を列挙する。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
      マッチメイクオブジェクトを主人公のレベルに依存する乱数で決定する。
      レベルと候補 ID との対応は次のようになっている。
    </p>
                <div class="table">
                  <a id="table.dq3.C3ED78"></a>
                  <p class="title">
                    <strong>表 5.42 配列 $C3ED78</strong>
                  </p>
                  <div class="table-contents">
                    <table id="table.dq3.C3ED78" class="lighttable">
                      <thead>
                        <tr>
                          <th>レベル</th>
                          <th>試合 ID</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="right"> 1..10</td>
                          <td><code class="literal">#$00</code>..<code class="literal">#$0A</code></td>
                        </tr>
                        <tr>
                          <td align="right">11..15</td>
                          <td><code class="literal">#$00</code>..<code class="literal">#$13</code></td>
                        </tr>
                        <tr>
                          <td align="right">16..21</td>
                          <td><code class="literal">#$00</code>..<code class="literal">#$18</code></td>
                        </tr>
                        <tr>
                          <td align="right">22..29</td>
                          <td><code class="literal">#$00</code>..<code class="literal">#$21</code></td>
                        </tr>
                        <tr>
                          <td align="right">30..99</td>
                          <td><code class="literal">#$00</code>..<code class="literal">#$26</code></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <br class="table-break" />
              </li>
              <li class="listitem">
                <p>
      後述する予想屋の予想内容をこの時点で決めておく。出場選手数と乱数によって決まる。
    </p>
              </li>
              <li class="listitem">
                <p>
      マッチメイクオブジェクトのオッズ属性値により、
      次の表で示す中間生成値を求め、それと 10 との商 Q や余り R を用いて最終的なオッズの整数部と小数部をそれぞれ決定する。
    </p>
                <div class="table">
                  <a id="table.dq3.C3EDBB"></a>
                  <p class="title">
                    <strong>表 5.43 格闘場オッズの計算方法</strong>
                  </p>
                  <div class="table-contents">
                    <table id="table.dq3.C3EDBB" class="lighttable">
                      <thead>
                        <tr>
                          <th>属性値</th>
                          <th>中間生成値</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td align="right">1..5</td>
                          <td>
                            <code class="code">randint(0, 6) - 3</code>
                          </td>
                        </tr>
                        <tr>
                          <td align="right">6..10</td>
                          <td>
                            <code class="code">randint(0, 14) - 7</code>
                          </td>
                        </tr>
                        <tr>
                          <td align="right">11..30</td>
                          <td>
                            <code class="code">randint(0, 40) - 20</code>
                          </td>
                        </tr>
                        <tr>
                          <td align="right">31..100</td>
                          <td>
                            <code class="code">randint(0, 100) -  50</code>
                          </td>
                        </tr>
                        <tr>
                          <td align="right">101..255</td>
                          <td>
                            <code class="code">randint(0, 200) - 100</code>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <br class="table-break" />
                <p>
      例えば中間生成値が非負ならば、整数部は属性値と Q との和、小数部は R として決定する。
      中間生成値が負であったり、剰余が 0 であったり、属性値と商との和がゼロ以下になるような場合についても適宜対処している。
    </p>
              </li>
            </ul>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.matchmake.behavior.C3EE64"></a>5.20.2.2. サブルーチン <code class="varname">$C3EE64</code>: 格闘場処理</h4>
              </div>
            </div>
          </div>
          <p>
サブルーチン <code class="varname">$C3EE64</code> は格闘場チケット屋の窓口処理を行う。
以下、処理の要点を列挙する。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
      冒頭で賭け金を計算する。主人公のレベルと 10 の積とする。
    </p>
              </li>
              <li class="listitem">
                <p>
      出場選手ウィンドウ表示時にキャンセルすると、「なんだ やめるのか」の後に支払い済みの賭け金が払い戻されることが確認できるようになっている。
    </p>
              </li>
              <li class="listitem">
                <p>
      賭けが成立すると、<code class="varname">$7E2011</code> の格闘場モードフラグを意味するビットをセットする。
    </p>
              </li>
            </ul>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.matchmake.behavior.C3EFBE"></a>5.20.2.3. サブルーチン <code class="varname">$C3EFBE</code>: 予想屋処理</h4>
              </div>
            </div>
          </div>
          <p>
サブルーチン <code class="varname">$C3EFBE</code> は格闘場内にある予想屋の台詞処理だ。
以下、処理の要点を列挙する。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
      予想代は一律 5 ゴールドだ。
    </p>
              </li>
              <li class="listitem">
                <p>
      予想を聞かないと答えたときと、予想を聞くが所持金が 5 ゴールド未満のときの処理は同じだ。
    </p>
              </li>
              <li class="listitem">
                <p>
      予想内容は上述のマッチメイク処理で決定済みである。
    </p>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="navigation"><hr /><table><tr><td class="online-navigation"><a href="dq3_rename.html" title="5.19. 命名神"><img src="image/docbook/prev.png" alt="戻る" /></a></td><td class="online-navigation"><a href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)"><img src="image/docbook/up.png" alt="上に戻る" /></a></td><td class="online-navigation"><a href="dq3_horoscope.html" title="5.21. 星座"><img src="image/docbook/next.png" alt="次へ" /></a></td><td>ドラクエ命</td><td class="online-navigation"><a href="index.html" title="ドラクエ命"><img src="image/docbook/home.png" alt="ホーム" /></a></td><td class="online-navigation"><a href="" title=""><img src="image/docbook/index.png" alt="索引" /></a></td></tr></table><b class="navlabel">Previous: </b><a accesskey="p" class="sectref" href="dq3_rename.html">5.19. 命名神</a> <b class="navlabel">Up: </b><a accesskey="u" class="sectref" href="dq3.html">第 5 章 SFC 版ドラクエ 3 (1996)</a> <b class="navlabel">Next: </b><a accesskey="n" class="sectref" href="dq3_horoscope.html">5.21. 星座</a></div>
  </body>
</html>
