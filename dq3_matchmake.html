<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>5.19. 格闘場マッチメイク解析</title>
    <link rel="stylesheet" type="text/css" href="dqbook.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="home" href="index.html" title="ドラクエ命" />
    <link rel="up" href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)" />
    <link rel="prev" href="dq3_rename.html" title="5.18. 命名神解析" />
    <link rel="next" href="dq3_stadium.html" title="5.20. 格闘場解析" />
  </head>
  <body>
    <div class="navigation"><table><tr><td class="online-navigation"><a href="dq3_rename.html" title="5.18. 命名神解析"><img src="image/docbook/prev.png" alt="戻る" /></a></td><td class="online-navigation"><a href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)"><img src="image/docbook/up.png" alt="上に戻る" /></a></td><td class="online-navigation"><a href="dq3_stadium.html" title="5.20. 格闘場解析"><img src="image/docbook/next.png" alt="次へ" /></a></td><td>ドラクエ命</td><td class="online-navigation"><a href="index.html" title="ドラクエ命"><img src="image/docbook/home.png" alt="ホーム" /></a></td><td class="online-navigation"><a href="" title=""><img src="image/docbook/index.png" alt="索引" /></a></td></tr></table><b class="navlabel">Previous: </b><a accesskey="p" class="sectref" href="dq3_rename.html">5.18. 命名神解析</a> <b class="navlabel">Up: </b><a accesskey="u" class="sectref" href="dq3.html">第 5 章 SFC 版ドラクエ 3 (1996)</a> <b class="navlabel">Next: </b><a accesskey="n" class="sectref" href="dq3_stadium.html">5.20. 格闘場解析</a><hr /></div>
    <div class="section">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a id="dq3.matchmake"></a>5.19. 格闘場マッチメイク解析</h2>
          </div>
        </div>
      </div>
      <div class="toc">
        <dl class="toc">
          <dt>
            <span class="section">
              <a href="dq3_matchmake.html#dq3.matchmake.hack">5.19.1. 解析</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="dq3_matchmake.html#dq3.matchmake.hack.C3EC84">5.19.1.1. 格闘場マッチメイクサブルーチン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_matchmake.html#dq3.matchmake.hack.C3ED82">5.19.1.2. 主人公のレベルを取得するサブルーチン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_matchmake.html#dq3.matchmake.hack.C3EDBB">5.19.1.3. オッズ設定サブルーチン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_matchmake.html#dq3.matchmake.hack.C30DC5">5.19.1.4. マッチメイク構造体</a>
                </span>
              </dt>
            </dl>
          </dd>
        </dl>
      </div>
      <a id="term.dq3.matchmake.1" class="indexterm"></a>
      <a id="term.dq3.matchmake.2" class="indexterm"></a>
      <p>
	本節では、格闘場のマッチメイク処理の解析を行う。
	リメイク版では、オリジナル版のように多様なマッチメイクが実現することはない。
	格闘場に出てくるモンスターたちの組み合わせには、すでに何個かのパターンが決まっており、
	そこから無作為に選択されるというのが、一般的なプレイヤーの認識だろう。
	以下では、出場選手モンスターとオッズがどのように決まるのかを見ていこう。
</p>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="dq3.matchmake.hack"></a>5.19.1. 解析</h3>
            </div>
          </div>
        </div>
        <p>
	格闘場のあるフロアに場面が切り替わる直前に、マッチメイク処理を行っているようだ。
	すなわちフロア進入時と観戦終了後に、ここで紹介するサブルーチンの呼び出しが発生する。
</p>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.matchmake.hack.C3EC84"></a>5.19.1.1. 格闘場マッチメイクサブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	マッチメイクを担当するサブルーチンは <code class="varname">$C3EC84</code> で定義されている。
	逆アセンブルコードから読み下したアウトラインを説明する。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			<a class="link" href="dq3_matchmake.html#dq3.matchmake.hack.C3ED82" title="5.19.1.2. 主人公のレベルを取得するサブルーチン">主人公のレベルを取得するサブルーチン</a>を呼び出し、
			取得した主人公のレベル <code class="varname">A</code> を <code class="varname">$337A</code> にセットする。
		</p>
              </li>
              <li class="listitem">
                <p>【乱数取得のための幅を設定】</p>
                <p>値 <code class="varname">range</code> を以下のように決める。</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="code">A &lt; #$000B</code> ⇒ <code class="code">range = $C3ED78</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">A &lt; #$0010</code> ⇒ <code class="code">range = $C3ED7A</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">A &lt; #$0016</code> ⇒ <code class="code">range = $C3ED7C</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">A &lt; #$001E</code> ⇒ <code class="code">range = $C3ED7E</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">A</code> がそれ以外の値ならば <code class="code">range = $C3ED80</code>
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			乱数生成サブルーチン <code class="varname">$C0133E</code> の呼び出しにより、
			<code class="varname">A</code> レジスタに <code class="literal">0</code> から
			<code class="varname">range</code> までのランダムに決まった値をセットする。
			この値がマッチメイク ID となる。
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">$3370 = マッチメイク ID</code>
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">$78 = マッチメイク ID のデータが格納されているアドレス</code> となるように、
			構造体データアドレス取得サブルーチン <code class="varname">$C9050D</code> を呼び出す。
		</p>
              </li>
              <li class="listitem">
                <p>【各選手のオッズを初期化】</p>
                <p>
			<a class="link" href="dq3_matchmake.html#dq3.matchmake.hack.C3EDBB" title="5.19.1.3. オッズ設定サブルーチン">オッズ設定サブルーチン</a>を
			<code class="varname">X</code> レジスタの値を変えつつ <code class="literal">4</code> 回呼び出すことで、
			以下のアドレスに値をセットする。
			見栄えの都合上、アドレスの順序でセット内容を記すが、実際の処理順序は選手の登場順序と一致する。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="varname">$337C</code>: マッチメイク構造体データにある選手<code class="code">[0]</code> のオッズ整数部
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$337E</code>: マッチメイク構造体データにある選手<code class="code">[1]</code> のオッズ整数部
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$3380</code>: マッチメイク構造体データにある選手<code class="code">[2]</code> のオッズ整数部
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$3382</code>: マッチメイク構造体データにある選手<code class="code">[3]</code> のオッズ整数部
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$3384</code>: マッチメイク構造体データにある選手<code class="code">[0]</code> のオッズ小数点以下
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$3386</code>: マッチメイク構造体データにある選手<code class="code">[1]</code> のオッズ小数点以下
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$3388</code>: マッチメイク構造体データにある選手<code class="code">[2]</code> のオッズ小数点以下
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$338A</code>: マッチメイク構造体データにある選手<code class="code">[3]</code> のオッズ小数点以下
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>【各選手のモンスター ID を初期化】</p>
                <p>
			単純作業で以下の各アドレスに値をセットする。
			ここでも見栄えの都合上、アドレスの順序でセット内容を記す。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="varname">$2000</code>: マッチメイク構造体データにある選手<code class="code">[0]</code> のモンスター ID
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$2002</code>: マッチメイク構造体データにある選手<code class="code">[1]</code> のモンスター ID
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$2004</code>: マッチメイク構造体データにある選手<code class="code">[2]</code> のモンスター ID
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$2006</code>: マッチメイク構造体データにある選手<code class="code">[3]</code> のモンスター ID
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$2008</code>: 選手<code class="code">[0]</code> のモンスター ID が <code class="literal">0</code> でなければ 1 とし、
					<code class="literal">0</code> ならば <code class="literal">0</code> とする。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$200A</code>: 選手<code class="code">[1]</code> のモンスター ID が <code class="literal">0</code> でなければ 1 とし、
					<code class="literal">0</code> ならば <code class="literal">0</code> とする。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$200C</code>: 選手<code class="code">[2]</code> のモンスター ID が <code class="literal">0</code> でなければ 1 とし、
					<code class="literal">0</code> ならば <code class="literal">0</code> とする。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$200E</code>: 選手<code class="code">[3]</code> のモンスター ID が <code class="literal">0</code> でなければ 1 とし、
					<code class="literal">0</code> ならば <code class="literal">0</code> とする。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$3372</code>: 参戦選手数。すなわち <code class="code">$2008 + $200A + $200C + $200E</code> と同じ値
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【予想屋の予想を初期化】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="code">A = $3372 - 1</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">A</code> が正の値であれば、<code class="literal">0</code> から <code class="varname">A</code> までの乱数を取得するべく、
					乱数取得サブルーチン <code class="varname">$C0133E</code> を呼び出す。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">$3378 = 乱数 * 2</code>
				</p>
                      <p>
					例えば、選手が <code class="literal">4</code> 匹いるとき、
					<code class="varname">$3378</code> のとり得る値は <code class="literal">0, 2, 4, 6</code> のいずれかである。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
          <p>
まず最初に主人公キャラクターのレベルを参照している。
レベルにより、五段階で選択肢の個数が変化するというわけだ。
配列 <code class="varname">$C3ED78</code> の内容は次のようになっている。
</p>
          <pre class="programlisting">
C3/ED78:    0A00    <a id="dq3.matchmake.co.1"></a><span><img src="image/docbook/callouts/1.png" alt="1" border="0" /></span>
C3/ED7A:    1300    <a id="dq3.matchmake.co.2"></a><span><img src="image/docbook/callouts/2.png" alt="2" border="0" /></span>
C3/ED7C:    1800    <a id="dq3.matchmake.co.3"></a><span><img src="image/docbook/callouts/3.png" alt="3" border="0" /></span>
C3/ED7E:    2100    <a id="dq3.matchmake.co.4"></a><span><img src="image/docbook/callouts/4.png" alt="4" border="0" /></span>
C3/ED80:    2600    <a id="dq3.matchmake.co.5"></a><span><img src="image/docbook/callouts/5.png" alt="5" border="0" /></span>
</pre>
          <div class="calloutlist">
            <table border="0" summary="Callout list">
              <tr>
                <td width="5%" valign="top" align="left">
                  <p><a href="#dq3.matchmake.co.1"><span><img src="image/docbook/callouts/1.png" alt="1" border="0" /></span></a> </p>
                </td>
                <td valign="top" align="left">
                  <p>主人公のレベルが <code class="literal">11</code> 未満の場合、<code class="literal">10</code> 通りの組み合わせだけが観戦できる。</p>
                </td>
              </tr>
              <tr>
                <td width="5%" valign="top" align="left">
                  <p><a href="#dq3.matchmake.co.2"><span><img src="image/docbook/callouts/2.png" alt="2" border="0" /></span></a> </p>
                </td>
                <td valign="top" align="left">
                  <p>主人公のレベルが <code class="literal">16</code> 未満の場合、<code class="literal">19</code> 通りの組み合わせだけが観戦できる。</p>
                </td>
              </tr>
              <tr>
                <td width="5%" valign="top" align="left">
                  <p><a href="#dq3.matchmake.co.3"><span><img src="image/docbook/callouts/3.png" alt="3" border="0" /></span></a> </p>
                </td>
                <td valign="top" align="left">
                  <p>主人公のレベルが <code class="literal">22</code> 未満の場合、<code class="literal">24</code> 通りの組み合わせだけが観戦できる。</p>
                </td>
              </tr>
              <tr>
                <td width="5%" valign="top" align="left">
                  <p><a href="#dq3.matchmake.co.4"><span><img src="image/docbook/callouts/4.png" alt="4" border="0" /></span></a> </p>
                </td>
                <td valign="top" align="left">
                  <p>主人公のレベルが <code class="literal">30</code> 未満の場合、<code class="literal">33</code> 通りの組み合わせだけが観戦できる。</p>
                </td>
              </tr>
              <tr>
                <td width="5%" valign="top" align="left">
                  <p><a href="#dq3.matchmake.co.5"><span><img src="image/docbook/callouts/5.png" alt="5" border="0" /></span></a> </p>
                </td>
                <td valign="top" align="left">
                  <p>主人公のレベルがそれより大きければ、<code class="literal">38</code> 通りの組み合わせが観戦できる。
この個数は、後述するマッチメイク配列 <code class="varname">$C30DC5</code> の要素数と一致する。
</p>
                </td>
              </tr>
            </table>
          </div>
          <p>
その後は、乱数処理でマッチメイクデータを制限範囲内から一つ取り、
胴元と予想屋の処理と台詞に必要なパラメータを然るべきアドレスにセットするという処理となる。
<a class="link" href="dq3_stadium.html#dq3.stadium.hack.C3EE64" title="5.20.1.1. 格闘場共通処理サブルーチン">格闘場の胴元共通処理サブルーチン</a>と
<a class="link" href="dq3_tipster.html#dq3.tipster.hack.C3EFBE" title="5.21.1.1. 予想屋共通処理サブルーチン">予想屋の共通処理サブルーチン</a>の実装は、
当サブルーチンの処理結果に依存するということだ。
</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.matchmake.hack.C3ED82"></a>5.19.1.2. 主人公のレベルを取得するサブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$ED82</code> は主人公のレベルを <code class="varname">A</code> レジスタにロードする。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			キャラクター人数取得サブルーチン <code class="varname">$C4297C</code> 呼び出しにより、
			<code class="literal">X = パーティ内の人数 - 1</code> とする。
		</p>
              </li>
              <li class="listitem">
                <p>【主人公チェック】</p>
                <p>
			キャラクター <code class="varname">X</code> が主人公であるかを調べるべく、
			主人公判定サブルーチン <code class="varname">$C42DA1</code> を呼び出す
			（キャラクターデータのあるビット列が <code class="literal">1</code> と等しいか否かをテストするサブルーチンである）。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					キャラクター <code class="varname">X</code> が主人公であれば
					【パーティの中に主人公を見つけた】
					に制御を移す。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					キャラクター <code class="varname">X</code> が主人公でなければ、
					前のキャラクターに関して 【主人公チェック】を行う。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					パーティ内に調べたいキャラクターがいなくなったら、
					【酒場チェック】に制御を移す。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【パーティの中に主人公を見つけた】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					キャラクターレベル取得サブルーチン <code class="varname">$C42FEB</code> を呼び出す。
					これで <code class="varname">A</code> レジスタの値はパーティキャラ <code class="varname">X</code> のレベルとなっている。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					呼び出し元に制御を戻す。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			キャラクター人数取得サブルーチン <code class="varname">$C4297C</code> 呼び出しにより、
			<code class="code">X = パーティ内の人数 - 1</code> とする。
		</p>
              </li>
              <li class="listitem">
                <p>
			【酒場内のキャラクターをチェック】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					キャラクター人数取得サブルーチン <code class="varname">$C4297C</code> 呼び出しにより、
					<code class="code">X = 酒場内の人数 - 1</code> とする。
				</p>
                    </li>
                    <li class="listitem">
                      <p>【酒場にいるキャラの主人公チェック】</p>
                      <p>
					パーティ内のチェックと同様に、キャラクター <code class="varname">X</code> を調べるべく、
					主人公判定サブルーチン <code class="varname">$C42DA1</code> を呼び出す。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャラクター <code class="varname">X</code> が主人公であれば
							【酒場に主人公を見つけた】
							に制御を移す。
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							キャラクター <code class="varname">X</code> が主人公でなければ、
							前のキャラクターに関して 【酒場にいるキャラの主人公チェック】を行う。
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							パーティ内に調べたいキャラクターがいなくなったら、
							そのまま (<code class="code">X == #$FFFF</code>) 【酒場に主人公を見つけた】へ進む。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【酒場に主人公を見つけた】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					キャラクターレベル取得サブルーチン <code class="varname">$C42FEB</code> を呼び出す。
					これで <code class="varname">A</code> レジスタの値は酒場にいるキャラ <code class="varname">X</code> のレベルとなっている。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					呼び出し元に制御を戻す。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.matchmake.hack.C3EDBB"></a>5.19.1.3. オッズ設定サブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$EDBB</code> は、格闘場に出場する選手一匹のオッズを決定する。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			【事前条件】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="code">A == マッチメイク構造体にあるオッズデータ</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">X == 選手の順番 * 2 (== 0, 2, 4, 6)</code>
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>【初期化】</p>
                <p>
			<code class="code">$337C,X = A, $3384,X = 0</code>
		</p>
              </li>
              <li class="listitem">
                <p>【乱数】</p>
                <p>
			マッチメイク構造体データの与える初期値 <code class="varname">A</code> により、
			さらに <code class="varname">A</code> を変更する。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="varname">A</code> が <code class="literal">#$0006</code> 未満 ⇒ <code class="code">A = #$0006</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">A</code> が <code class="literal">#$000B</code> 未満 ⇒ <code class="code">A = #$000E</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">A</code> が <code class="literal">#$001F</code> 未満 ⇒ <code class="code">A = #$0028</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">A</code> が <code class="literal">#$0065</code> 未満 ⇒ <code class="code">A = #$0064</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">A</code> が <code class="literal">#$0065</code> 以上 ⇒ <code class="code">A = #$00C8</code>
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			乱数取得サブルーチン <code class="varname">$C0133E</code> で乱数を取得する。
			この乱数は <code class="literal">0</code> 以上 <code class="varname">A</code> 以下の値である。
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">A = 乱数 - (A &gt;&gt; 1)</code> とする。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="code">A &gt;= 0</code> ⇒ 【プラス】へ制御を移す。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					それ以外 ⇒ 次に進む。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【マイナス】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="code">A = -A + 1</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">$70 = A / 10; A %= 10</code> とする（汎用除算サブルーチン <code class="varname">$C0121C</code> 利用）
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">A = 10 - A</code> をテストする。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							<code class="code">A == 0</code> ⇒ 【減算】へスキップ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">$3384,X = A</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">$337C,X = #$FFFF if $337C,X == 0</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>【減算】</p>
                      <p>
					<code class="code">A = $337C,X - $70</code> に対して、
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							<code class="code">A &gt; 0</code> ⇒ <code class="code">$337C,X = A</code>
						</p>
                          </li>
                          <li class="listitem">
                            <p>
							<code class="code">A &lt;= 0</code> ⇒ <code class="code">$3384,X = 0 $337C,X = 1</code>
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					【終了】へ進む。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【プラス】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="code">$70 = A / 10; A %= 10</code> とする（汎用除算サブルーチン <code class="varname">$C0121C</code> 利用）
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">$3384,X = A</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">$337C,X += $70</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					【終了】へ進む。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>【終了】</p>
                <p>制御を呼び出し元に戻す。</p>
              </li>
              <li class="listitem">
                <p>
			【事後条件】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="code">$337C,X &gt;= 1</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">0 &lt;= $3384,X &amp;&amp; $3384,X &lt; 10</code>
				</p>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
          <p>
	オッズが各選手の持つある定数を元に生成する乱数から決まることが読み取れる。
	モンスターたちの持つオッズ用定数にそれを乗じて、実オッズが <code class="literal">1.0</code>
	を下回らないようにスケーリングする数値計算が、本サブルーチンの主要な処理だ。
</p>
          <p>
	オッズは小数点を持つ値なので、整数部分と小数点以下の部分両方を扱っている。
	<code class="varname">$337C,X</code> が整数部で、<code class="varname">$3384,X</code> が小数部だ。
	さらに言えば、小数部は一桁しかない。
</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.matchmake.hack.C30DC5"></a>5.19.1.4. マッチメイク構造体</h4>
              </div>
            </div>
          </div>
          <p>
	配列 <code class="varname">$C30DC5</code> が全マッチメイク <code class="literal">38</code> パターンを定義する。
	マッチメイク一つ当たり、<code class="literal">8</code> バイトサイズの構造体として表現する。
	その構造体のメモリレイアウトは以下のように解釈できる。
</p>
          <div class="table">
            <a id="table.dq3.C30DC5"></a>
            <p class="title">
              <strong>表 5.31 マッチメイク構造体</strong>
            </p>
            <div class="table-contents">
              <table id="table.dq3.C30DC5" class="memorylayout">
                <colgroup>
		<col width="12%" />
		<col span="7" width="11%" />
	</colgroup>
                <thead>
                  <tr><th>Byte:Bit</th>
			<th>80</th>
			<th>40</th>
			<th>20</th>
			<th>10</th>
			<th>08</th>
			<th>04</th>
			<th>02</th>
			<th>01</th>
		</tr>
                </thead>
                <tbody>
                  <tr><th>00</th>
			<td colspan="8">モンスター ID<code class="code">[0]</code></td>
		</tr>
                  <tr><th>01</th>
			<td colspan="8">オッズ<code class="code">[0]</code></td>
		</tr>
                  <tr><th>02</th>
			<td colspan="8">モンスター ID<code class="code">[1]</code></td>
		</tr>
                  <tr><th>03</th>
			<td colspan="8">オッズ<code class="code">[1]</code></td>
		</tr>
                  <tr><th>04</th>
			<td colspan="8">モンスター ID<code class="code">[2]</code></td>
		</tr>
                  <tr><th>05</th>
			<td colspan="8">オッズ<code class="code">[2]</code></td>
		</tr>
                  <tr><th>06</th>
			<td colspan="8">モンスター ID<code class="code">[3]</code></td>
		</tr>
                  <tr><th>07</th>
			<td colspan="8">オッズ<code class="code">[3]</code></td>
		</tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <div class="variablelist">
            <dl class="variablelist">
              <dt>
                <span class="term">モンスター ID</span>
              </dt>
              <dd>
                <p>リングに出場する選手のモンスター ID を示す。</p>
              </dd>
              <dt>
                <span class="term">オッズ</span>
              </dt>
              <dd>
                <p>オッズを算定するために用いる定数。前項参照。</p>
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>
    <div class="navigation"><hr /><table><tr><td class="online-navigation"><a href="dq3_rename.html" title="5.18. 命名神解析"><img src="image/docbook/prev.png" alt="戻る" /></a></td><td class="online-navigation"><a href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)"><img src="image/docbook/up.png" alt="上に戻る" /></a></td><td class="online-navigation"><a href="dq3_stadium.html" title="5.20. 格闘場解析"><img src="image/docbook/next.png" alt="次へ" /></a></td><td>ドラクエ命</td><td class="online-navigation"><a href="index.html" title="ドラクエ命"><img src="image/docbook/home.png" alt="ホーム" /></a></td><td class="online-navigation"><a href="" title=""><img src="image/docbook/index.png" alt="索引" /></a></td></tr></table><b class="navlabel">Previous: </b><a accesskey="p" class="sectref" href="dq3_rename.html">5.18. 命名神解析</a> <b class="navlabel">Up: </b><a accesskey="u" class="sectref" href="dq3.html">第 5 章 SFC 版ドラクエ 3 (1996)</a> <b class="navlabel">Next: </b><a accesskey="n" class="sectref" href="dq3_stadium.html">5.20. 格闘場解析</a></div>
  </body>
</html>
