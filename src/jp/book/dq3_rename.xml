<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % replacement SYSTEM "replacement.xml">
  %replacement;
]>

<section id="dq3.rename"><?dbhtml filename="dq3_rename.html" ?>
<title>命名神</title>
<para>
本節では命名神について述べる。
</para>

<section id="dq3.rename.structure">
<title>構造に関する構成要素</title>
<para>
命名神が参照するデータおよびそのの構造について述べる。
</para>

<section id="dq3.rename.structure.C30AF5">
<title>配列 <varname>$C30AF5</varname>: ふざけた名前</title>
<para>
アドレス <varname>$C30AF5</varname> に命名神の怒りに触れる名前を表す文字列 ID が配列している。
文字列データ自体は基本的に平仮名をベースとした形式で配列している。
濁点・半濁点が関係しない文字については、対応する平仮名と片仮名同士のコードポイント差が定数となることからこういう形式になっている。
濁点・半濁点が関係する文字については、平仮名と片仮名それぞれをリストしなければならない。
</para>
<table id="table.dq3.C30AF5" class="lighttable">
  <caption>配列 $C30AF5</caption>
  <thead>
    <tr><th>文字列 ID</th><th>文字列</th></tr>
  </thead>
  <tbody>
    <tr><td align="center"><literal>#$02F6</literal></td><td>ちんこ</td></tr>
    <tr><td align="center"><literal>#$02F7</literal></td><td>きんたま</td></tr>
    <tr><td align="center"><literal>#$02F8</literal></td><td>ちんちん</td></tr>
    <tr><td align="center"><literal>#$02F9</literal></td><td>あほ</td></tr>
    <tr><td align="center"><literal>#$02FA</literal></td><td>ちんぽこ</td></tr>
    <tr><td align="center"><literal>#$02FB</literal></td><td>ちんポこ</td></tr>
    <tr><td align="center"><literal>#$02FC</literal></td><td>へんたい</td></tr>
    <tr><td align="center"><literal>#$02FD</literal></td><td>ちんぼ</td></tr>
    <tr><td align="center"><literal>#$02FE</literal></td><td>ちんボ</td></tr>
    <tr><td align="center"><literal>#$02FF</literal></td><td>ちかん</td></tr>
    <tr><td align="center"><literal>#$0300</literal></td><td>おめこ</td></tr>
    <tr><td align="center"><literal>#$0301</literal></td><td>まんこ</td></tr>
    <tr><td align="center"><literal>#$0302</literal></td><td>おまんこ</td></tr>
    <tr><td align="center"><literal>#$0303</literal></td><td>あそこ</td></tr>
    <tr><td align="center"><literal>#$0304</literal></td><td>うんこ</td></tr>
    <tr><td align="center"><literal>#$0305</literal></td><td>でべそ</td></tr>
    <tr><td align="center"><literal>#$0306</literal></td><td>デべそ</td></tr>
    <tr><td align="center"><literal>#$0307</literal></td><td>うんち</td></tr>
    <tr><td align="center"><literal>#$0308</literal></td><td>はなたれ</td></tr>
    <tr><td align="center"><literal>#$0309</literal></td><td>おしっこ</td></tr>
    <tr><td align="center"><literal>#$030A</literal></td><td>せっくす</td></tr>
    <tr><td align="center"><literal>#$030B</literal></td><td>ばか</td></tr>
    <tr><td align="center"><literal>#$030C</literal></td><td>バか</td></tr>
    <tr><td align="center"><literal>#$030D</literal></td><td>おしり</td></tr>
    <tr><td align="center"><literal>#$030E</literal></td><td>まぬけ</td></tr>
    <tr><td align="center"><literal>#$030F</literal></td><td>あなる</td></tr>
    <tr><td align="center"><literal>#$0310</literal></td><td>きちがい</td></tr>
    <tr><td align="center"><literal>#$0311</literal></td><td>すけべ</td></tr>
    <tr><td align="center"><literal>#$0312</literal></td><td>きちガい</td></tr>
    <tr><td align="center"><literal>#$0313</literal></td><td>すけべ</td></tr>
  </tbody>
</table>
</section> <!-- dq3.rename.structure.C30AF5 -->

<section id="dq3.rename.structure.C31368">
<title>配列 <varname>$C31368</varname>: 予約名</title>
<para>
アドレス <varname>$C31368</varname> には予約名を表す文字列 ID が配列している。
物語の登場人物で厳選した者で編成されたものと考えられる。
</para>
<table id="table.dq3.C31368" class="lighttable">
  <caption>配列 $C31368</caption>
  <thead>
    <tr><th>文字列 ID</th><th>文字列</th></tr>
  </thead>
  <tbody>
    <tr><td align="center"><literal>#$0324</literal></td><td>おるてが</td></tr>
    <tr><td align="center"><literal>#$0325</literal></td><td>かんだた</td></tr>
    <tr><td align="center"><literal>#$0326</literal></td><td>がらい</td></tr>
    <tr><td align="center"><literal>#$0327</literal></td><td>おるてガ</td></tr>
    <tr><td align="center"><literal>#$0328</literal></td><td>かんダた</td></tr>
    <tr><td align="center"><literal>#$0329</literal></td><td>ガらい</td></tr>
    <tr><td align="center"><literal>#$032A</literal></td><td>えりっく</td></tr>
    <tr><td align="center"><literal>#$032B</literal></td><td>おりびあ</td></tr>
    <tr><td align="center"><literal>#$032C</literal></td><td>ばらもす</td></tr>
    <tr><td align="center"><literal>#$032D</literal></td><td>ぞーま</td></tr>
    <tr><td align="center"><literal>#$032E</literal></td><td>おりビあ</td></tr>
    <tr><td align="center"><literal>#$032F</literal></td><td>バらもす</td></tr>
    <tr><td align="center"><literal>#$0330</literal></td><td>ゾーま</td></tr>
    <tr><td align="center"><literal>#$0331</literal></td><td>ひみこ</td></tr>
    <tr><td align="center"><literal>#$0332</literal></td><td>るびす</td></tr>
    <tr><td align="center"><literal>#$0333</literal></td><td>のるど</td></tr>
    <tr><td align="center"><literal>#$0334</literal></td><td>ばこた</td></tr>
    <tr><td align="center"><literal>#$0335</literal></td><td>ぜにす</td></tr>
    <tr><td align="center"><literal>#$0336</literal></td><td>るビす</td></tr>
    <tr><td align="center"><literal>#$0337</literal></td><td>のるド</td></tr>
    <tr><td align="center"><literal>#$0338</literal></td><td>バこた</td></tr>
    <tr><td align="center"><literal>#$0339</literal></td><td>ゼにす</td></tr>
  </tbody>
</table>
</section> <!-- dq3.rename.structure.C31368 -->
</section> <!-- dq3.rename.structure -->

<section id="dq3.rename.behavior">
<title>振る舞いに関する構成要素</title>
<para>
命名神に仕える神官の振る舞いについて述べる。
</para>

<section id="dq3.rename.behavior.C3E8D3">
<title>サブルーチン <varname>$C3E8D3</varname>: 命名神メイン</title>
<para>
ダーマの神殿の西側にいる婆サンに「はなす」とサブルーチン <varname>$C3E8D3</varname> が実行される。
以下、要点を列挙する。
</para>
<itemizedlist>
  <listitem>
    <para>
      対象はパーティー内の任意のキャラクターまたはパーティー共有のふくろのうちから選べる。
    </para>
  </listitem>
  <listitem>
    <para>
      対象の現在の名前が怒りに触れているときは、まず呪いの効果音を再生する。
    </para>
  </listitem>
  <listitem>
    <para>
      怒りを解くのに 5,000 ゴールドが必要となる。
      この支払い判定はサブルーチン <varname>$C45B66</varname> で行う。
    </para>
  </listitem>
  <listitem>
    <para>
      入力内容によって神官の反応が違ってくる。このうち最後の二つについては命名神の怒りに触れる。
    </para>
    <itemizedlist>
      <listitem>
        <para>
          入力文字列が現在の名前と全く同じ場合はキャンセル時と同じ扱いとする。
        </para>
      </listitem>
      <listitem>
        <para>
          入力文字列が文字列「ロト」とマッチする場合。
          これは登録所の処理で行う判定処理と同じものを用いる。
        </para>
      </listitem>
      <listitem>
        <para>
          入力文字列が予約名とマッチする場合。
          <xref linkend="dq3.rename.behavior.C3EB3F" xrefstyle="select: labelnumber"/> を参照。
          これは登録所の処理で行う判定処理と同じだ。
        </para>
      </listitem>
      <listitem>
        <para>
          入力文字列が既存の仲間キャラクターの名前と全く同じ場合。
          これは登録所の処理で行う判定処理と同じものを用いる。
        </para>
      </listitem>
      <listitem>
        <para>
          入力文字列がふざけた名前となる場合。
          <xref linkend="dq3.rename.behavior.C3EB2B" xrefstyle="select: labelnumber"/> を参照。
        </para>
      </listitem>
      <listitem>
        <para>
          入力文字列が同一文字の連続形となる場合。
          <xref linkend="dq3.rename.behavior.C3EBAB" xrefstyle="select: labelnumber"/> を参照。
        </para>
      </listitem>
    </itemizedlist>
  </listitem>
  <listitem>
    <para>
      命名神の怒りに触れると、画面がフラッシュして呪いの効果音を再生する。
    </para>
  </listitem>
</itemizedlist>
</section> <!-- dq3.rename.behavior.C3E8D3 -->

<section id="dq3.rename.behavior.C3EB2B">
<title>サブルーチン <varname>$C3EB2B</varname>: 名前がふざけた名前かどうか</title>
<para>
プレイヤーが入力した名前がふざけたものであるかどうかをテストする。
これは後述するサブルーチン <varname>$C3EB53</varname> にブラックリストを指定する形式で実行される。
<xref linkend="dq3.rename.structure.C30AF5" xrefstyle="select: labelnumber"/> および
<xref linkend="dq3.rename.behavior.C3EB53" xrefstyle="select: labelnumber"/> を参照。
</para>
</section> <!-- dq3.rename.behavior.C3EB2B -->

<section id="dq3.rename.behavior.C3EB3F">
<title>サブルーチン <varname>$C3EB3F</varname>: 入力が予約名かどうか</title>
<para>
プレイヤーが入力した名前が、ゲームにより予約された名前であるかどうかをテストする。
これは後述するサブルーチン <varname>$C3EB53</varname> に予約名リストを指定する形式で実行される。
<xref linkend="dq3.rename.structure.C31368" xrefstyle="select: labelnumber"/> および
<xref linkend="dq3.rename.behavior.C3EB53" xrefstyle="select: labelnumber"/> を参照。
</para>
</section> <!-- dq3.rename.behavior.C3EB3F -->

<section id="dq3.rename.behavior.C3EB53">
<title>サブルーチン <varname>$C3EB53</varname>: 名前テスト共通</title>
<para>
サブルーチン <varname>$C3EB53</varname> は呼び出し元が指定する文字列型配列から、文字列を検索する。
</para>
<para>
処理としては二重ループによる線形探索だ。
対応する平仮名と片仮名同士を同じ文字として比較することにより、名前同士が「同じ」かどうかを判定する。
濁点・半濁点の付かない文字は、文字コードの差が一定であることを利用しての比較となるが、
付く文字はそうとも言えないので、リストの方に平仮名と片仮名を重複して定義しておく必要がある。
具体的には掲載データを参照して欲しい。
</para>
</section> <!-- dq3.rename.behavior.C3EB53 -->

<section id="dq3.rename.behavior.C3EBAB">
<title>サブルーチン <varname>C3EBAB</varname>: 名前が同一文字の連続形かどうか</title>
<para>
サブルーチン <varname>C3EBAB</varname> は名前が任意の一文字 4 個が連続する文字列であるかどうかをテストする。
処理内容は十数個の命令からなる単純な配列検索に過ぎない。
</para>
</section> <!-- dq3.rename.behavior.C3EBAB -->

<section id="dq3.rename.behavior.C3EBCD">
<title>サブルーチン <varname>$C3EBCD</varname>: 現在の名前が怒りに触れているかどうか</title>
<para>
サブルーチン <varname>$C3EBCD</varname> は、指定したキャラクターの現在の名前が、
命名神の怒りにふれているものかどうかをテストする。
以下、要点を列挙する。
</para>
<itemizedlist>
  <listitem>
    <para>
      現在の対象者の名前がふざけた名前かどうかを判定する。
      <xref linkend="dq3.rename.behavior.C3EB3F" xrefstyle="select: labelnumber"/> 参照。
    </para>
  </listitem>
  <listitem>
    <para>
      現在の対象者の名前が同一文字の連続形かどうかを判定する。
      <xref linkend="dq3.rename.behavior.C3EBAB" xrefstyle="select: labelnumber"/> 参照。
    </para>
  </listitem>
  <listitem>
    <para>
      どちらかに判定された名前が怒りに触れているものとする。
    </para>
  </listitem>
</itemizedlist>
</section> <!-- dq3.rename.behavior.C3EBCD -->
</section> <!-- dq3.rename.behavior -->
</section> <!-- dq3.rename -->
