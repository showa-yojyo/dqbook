<?xml version="1.0" encoding="UTF-8"?>
<section id="dq6.spell_commands"><?dbhtml filename="dq6_spell_commands.html" ?>
<title>移動中の呪文コマンド処理</title>
<para>
本節では移動中に呪文を唱えるときに発生する処理を呪文ごとに見ていく。
プレイヤーがコマンドメニューから「じゅもん」を選択し、
どのパーティーにメンバーが唱えるのかを選択したあとに一つ呪文を選択する。
すると十分な MP があるときに、プログラムは選択された呪文に対応するサブルーチンを呼び出す。
</para>

<section id="dq6.spell_commands.C3B814">
<title>呪文ハンドラーテーブル</title>
<para>
呪文の文字列インデックスと処理コードの開始アドレスとの対応表はアドレス
<varname>$C3B814</varname> に次のように定義されている。
呪文ウィンドウで選択された呪文文字列のインデックスと行前半が一致すれば、
プログラムカウンターを行後半のアドレスへ JMP させる。
</para>
<programlisting>
C3/B814:    3000A4B9    ; ホイミ
C3/B818:    330049BA    ; べホイミ
C3/B81C:    360050BA    ; べホマ
C3/B820:    390057BA    ; べホマラー
C3/B824:    3A00CABA    ; べホマズン
C3/B828:    3E00D1BA    ; キアリー
C3/B82C:    3B004ABB    ; ザオラル
C3/B830:    3C00F8BB    ; ザオリク
C3/B834:    410070BC    ; ルーラ
C3/B838:    9E004ABD    ; リレミト
C3/B83C:    A900A6BD    ; くちぶえ
C3/B840:    A100DEBD    ; トヘロス
C3/B844:    A00010BE    ; トラマナ
C3/B848:    A40024BE    ; フローミ
C3/B84C:    A2007FBE    ; タカのめ
C3/B850:    A500F9BE    ; とうぞくのはな
C3/B854:    A80055BF    ; しのびあし
C3/B858:    A30077BF    ; ねる
C3/B85C:    A70095BF    ; おおごえ
C3/B860:    AA0066C0    ; あなほり
C3/B864:    9F0044C3    ; インパス
C3/B868:    A6001BC7    ; レミラーマ
C3/B86C:    AB0064C7    ; おもいだす
C3/B870:    AD0079C7    ; もっとおもいだす
C3/B874:    AC008EC7    ; ふかくおもいだす
C3/B878:    AE00A3C7    ; わすれる
</programlisting>
</section> <!-- dq6.spell_commands.C3B814 -->

<section id="dq6.spell_commands.desc">
<title>解析</title>
<para>
以下、各呪文の処理を簡単に説明していく。
その前に、実際にはハンドラーごとにコード化されているものの、
各呪文に共通して見られる仕様傾向を列挙しておく。
これらの事実についてはいちいち個々の呪文解説の項では、例外的な扱いがある場合を除き繰り返さない。

<itemizedlist>
  <listitem>
    <simpara>サブルーチン <varname>$C3B8C5</varname> 呼び出しにより、特定の効果音 (ID: <literal>#$00B0</literal>) を鳴らす。</simpara>
  </listitem>
  <listitem>
    <simpara>途中でキャンセルしたり、呪文の効果が無効であったりすると、呪文選択時に消費した MP を返還する。</simpara>
  </listitem>
  <listitem>
    <simpara>コマンドの対象がパーティーメンバーの一人となるものについては、それをウィンドウ <literal>#$00CA</literal> で決定する。</simpara>
  </listitem>
</itemizedlist>
</para>

<section id="dq6.spell_commands.desc.C3B9A8">
<title>ホイミ・べホイミ・ベホマ</title>
<para>
ホイミ・べホイミ・ベホマの各コマンドは開始直後に同一の処理 <varname>$C3B9A8</varname> に合流するので、まとめて解説する。
</para>
<para>
これらの呪文は、対象者一人が死んでいなければ、そのメンバーの HP をある量だけ回復しようとするものだ。
ここで、ある量とは指定する範囲にある数からランダムに選ぶものであり、
ホイミ系 5 種の呪文に対する回復量テーブルは <varname>$C3B963</varname> において次のように定められている。
<programlisting>
C3/B963:    30001E002800 ; ホイミ
C3/B969:    33004B005F00 ; べホイミ
C3/B96F:    3600E703E703 ; べホマ
C3/B975:    390064007800 ; べホマラー
C3/B97B:    3A00E703E703 ; べホマズン
</programlisting>

十六進数を十進数で書き直し、表にまとめると次のようになる：
  <table class="lighttable">
    <caption>$C3B963 ホイミ系回復量テーブル</caption>
    <thead>
      <tr><th>コマンド</th><th>下限値</th><th>上限値</th></tr>
    </thead>
    <tbody>
      <tr><td>ホイミ    </td><td align="right"> 30</td><td align="right"> 40</td></tr>
      <tr><td>べホイミ  </td><td align="right"> 75</td><td align="right"> 95</td></tr>
      <tr><td>べホマ    </td><td align="right">999</td><td align="right">999</td></tr>
      <tr><td>べホマラー</td><td align="right">100</td><td align="right">120</td></tr>
      <tr><td>べホマズン</td><td align="right">999</td><td align="right">999</td></tr>
    </tbody>
  </table>
</para>
<para>
乱数の適用は、ホイミ系専用サブルーチン <varname>$C3B8FC</varname> で行う。
具体的には、汎用乱数系サブルーチン <varname>$C00F28</varname> を利用して回復量を決める。
つまり、ゼロから回復量範囲の長さまでのいずれかの数をランダムに発生させ、
これに下限値を加えた値を回復量とする。
</para>
<para>
指定メンバーへの HP の回復処理自体はキャラクターのプロパティー設定サブルーチンの一種である
<varname>$C44685</varname>で行う。
回復量が過剰な場合はそこで対処することを期待する。
</para>
<para>
最後に効果音 <literal>#$00CD</literal> を鳴らし、メッセージを表示して終了する。
</para>
</section> <!-- dq6.spell_commands.desc.C3B9A8 -->

<section id="dq6.spell_commands.desc.C3BA5B">
<title>べホマラー・べホマズン</title>
<para>
べホマラー・べホマズンの各コマンドは開始直後に同一の処理 <varname>$C3BA5B</varname> に合流するので、まとめて解説する。
</para>
<para>
これらの呪文は、パーティーにいるメンバーを先頭から順番に、HP をある量だけ回復しようとするものだ。
ただし、死んでいるメンバーは単にスキップする。
また、回復量をメンバーごとに <xref linkend="dq6.spell_commands.desc.C3B9A8"/> のようにしてランダムに決定する。
回復処理、効果音、メッセージについても同様だが、呪文を受けたメンバーごとに発生する。
</para>
<para>
全員の回復メッセージを表示し終えた後、パーティーの HP/MP ウィンドウを表示してコマンドを終了する。
</para>
</section> <!-- dq6.spell_commands.desc.C3BA5B -->

<section id="dq6.spell_commands.desc.C3BAD1">
<title>キアリー</title>
<para>
キアリーは、対象者一人が死んでいなければ、その毒状態をクリアするコマンドだ。
</para>
<para>
サブルーチン <varname>$C44CA3</varname> により、指定メンバーの状態をテストする。
「しに」状態ならばいつものようにキャンセル扱いとする。
そうでなければ、指定メンバーの「もうどく」「どく」フラグがセットされているかをテストする。
これらのフラグのどちらもセットされていないならば、「しかし 何も おこらなかった」を表示して終了する。
この場合には MP の返還は発生しない。
</para>
<para>
対象が本当に毒に冒されている場合には、
キャラクターのプロパティー設定サブルーチンの一種であるサブルーチン
<varname>$C44E2B</varname> により「もうどく」「どく」フラグをリセットする。
</para>
<para>
最後にメッセージ <literal>#$16A9</literal> を表示し、コマンドを終了する。
</para>
</section> <!-- dq6.spell_commands.desc.C3BAD1 -->

<section id="dq6.spell_commands.desc.C3BB4A">
<title>ザオラル</title>
<para>
ザオラルは対象者一人が死んでいれば、半分の確率で生き返らせ、HP を最大値の半分とするコマンドだ。
</para>
<para>
サブルーチン <varname>$C44CA3</varname> により、指定メンバーの状態をテストする。
「しに」状態でなければいつものようにキャンセル扱いとする。
</para>
<para>
死んでいる場合にはサブルーチン <varname>$C00E97</varname> により乱数を発生させる。
この値が奇数ならば（最下位ビットを調べる）、ザオラルの結果を失敗とする。
メッセージ <literal>#$16A8</literal> を表示し、当然ながら MP を返還せずに終了とする。
</para>
<para>
乱数が偶数ならば成功とする。この場合、次の一連の処理を行う：
  <itemizedlist>
    <listitem>
      <simpara>サブルーチン <varname>$C44D34</varname> でメンバーの状態をすべてクリアする。</simpara>
    </listitem>
    <listitem>
      <simpara>サブルーチン <varname>$C44729</varname> でメンバーの最大 HP を取得する。
      次に LSR 命令でその半分の値を計算する。</simpara>
    </listitem>
    <listitem>
      <simpara>サブルーチン <varname>$C44685</varname> でメンバーの HP を回復する。</simpara>
    </listitem>
  </itemizedlist>
</para>
<para>
最後にメッセージ <literal>#$16A7</literal> を表示し、コマンドを終了する。
</para>
</section> <!-- dq6.spell_commands.desc.C3BB4A -->

<section id="dq6.spell_commands.desc.C3BBF8">
<title>ザオリク</title>
<para>
ザオリクは対象者一人が死んでいれば、HP ごと完全回復するコマンドだ。
処理内容は <xref linkend="dq6.spell_commands.desc.C3BB4A" /> で説明したものから、
乱数関連と半減関連を取り除いたものになる。
</para>
</section> <!-- dq6.spell_commands.desc.C3BBF8 -->

<section id="dq6.spell_commands.desc.C3BC70">
<title>ルーラ</title>
<para>
ルーラはパーティーが訪問したことがある場所の一定の集合から一点を選択し、そこへ一瞬で移動するコマンドだ。
次のような処理になっている：

  <itemizedlist>
    <listitem>
      <simpara>
      サブルーチン <varname>$C435B3</varname> を呼び出す。
      これにより、パーティーが一度訪問したすべての移動先候補地点をアドレス <varname>$7E48D8</varname> に配列としてセットする。
      </simpara>
      <simpara>
      なお、訪問情報は <varname>$7E3E60</varname> にビット列として保持されている。
      また、すべての移動先候補地点は <varname>$C8A162</varname> に 1 バイト型の配列として定義されている。
      </simpara>
    </listitem>
    <listitem>
      <simpara>
      次に配列 <varname>$7E48D8</varname> に要素があれば、そこから移動先候補をいくつか取り除く。
      サブルーチン <varname>$C7CAD5</varname> を実行することで、
      パーティーが現在いるフィールド区分（フィールド、したフィールド、かいてい、はざま）に一致しない候補を検索し、取り除く。
      この結果、移動先候補が全くなくなればメッセージ <literal>#$16D8</literal> を表示して、
      コマンドをキャンセル扱いで終了する。
      </simpara>
    </listitem>
    <listitem>
      <simpara>
        ルーラウィンドウを表示する。
        候補先の個数に応じてウィンドウの ID を <literal>#$004E</literal> か <literal>#$004F</literal> に使い分ける。
      </simpara>
    </listitem>
    <listitem>
      <simpara>
        呪文効果音を鳴らしたら、サブルーチン <varname>$C7C650</varname> を実行する。
        このとき、次に述べるような失敗パターンがあり、いずれもコマンドキャンセル扱いとなる。
      </simpara>
      <itemizedlist>
        <listitem>
          <simpara>
            天井に頭をぶつけるパターン。
            この場合はメッセージ <literal>#$16AC</literal> を表示する。
          </simpara>
        </listitem>
        <listitem>
          <simpara>
            不思議なちからで失敗するパターン。
            この場合はメッセージ <literal>#$16D8</literal> を表示する。
          </simpara>
        </listitem>
        <listitem>
          <simpara>
            特定の状況かつ特定の行き先について、パーティーにチャモロがいない（しに状態である）ために失敗するパターン。
            この場合はメッセージ <literal>#$16AD</literal> を表示する。
          </simpara>
        </listitem>
      </itemizedlist>
    </listitem>
    <listitem>
      <simpara>
        以上をすべてクリアすれば画面を切り替えてコマンドを終了する。
      </simpara>
    </listitem>
  </itemizedlist>
</para>
</section> <!-- dq6.spell_commands.desc.C3BC70 -->

<section id="dq6.spell_commands.desc.C3BD4A">
<title>リレミト</title>
<para>
リレミトは現在パーティーがいる地域から「脱出」するコマンドだ。
次のように処理する：

  <itemizedlist>
    <listitem>
      <simpara>サブルーチン <varname>$C7C783</varname> を呼び出すことで、
      パーティーが現在いる地域や状況がリレミトを許可するかどうかを調べる。
      リレミトが意味のない場所ならばメッセージ <literal>#$16D6</literal> を、
      何らかのイベント中であるなどの理由により禁止されているならばメッセージ
      <literal>#$16D8</literal> を、それぞれ表示してコマンドを終了する。
      この場合、消費済みの MP を呪文を唱えたメンバーに返還する。
      </simpara>

      <simpara>サブルーチン <varname>$C7C783</varname> のチェック内容は次のようなものだ：</simpara>
      <itemizedlist>
        <listitem>
          <simpara><code>$7E5EE1 != #$0000</code> であるか。
          ゼロでなければ、リレミトにより「何も起こらない」場である。
          <link linkend="dq6.debug.menu.C906CF">いんちきリレミト</link>すら認めない場ということだ。
          </simpara>
        </listitem>
        <listitem>
          <simpara>現在「不思議なちから」が作用する場にいるか、
          または <code>$7E3E28 &amp; #$0001</code> がセットされているかを調べる。
          どちらかならば、リレミトに「不思議なちから」が作用する。
          </simpara>
        </listitem>
        <listitem>
          <simpara><code>$7E3D2B &amp; #$0002</code> がセットされているか。
          セットされていればリレミトが発動する。
          </simpara>
        </listitem>
      </itemizedlist>

      <simpara>これらを全てクリアすればリレミトが発動する。</simpara>
    </listitem>
    <listitem>
      <simpara>許可されているならば、サブルーチン <varname>$C7C9CE</varname> を実行する。
      これがリレミトの本体処理だ。</simpara>
    </listitem>
  </itemizedlist>

リレミトが成功する条件が思いのほか複雑であることがわかる。
</para>
</section> <!-- dq6.spell_commands.desc.C3BD4A -->

<section id="dq6.spell_commands.desc.C3BDA6">
<title>くちぶえ</title>
<para>
くちぶえは現在パーティーがいる戦闘地域に基いて、強制的に通常戦闘を引き起こすコマンドだ。
次のように処理する：

  <itemizedlist>
    <listitem>
      <simpara>サブルーチン <varname>$C79447</varname> を呼び出し、
      適切なタイルせんとう ID を取得する。
      <xref linkend="dq6.debug.menu.C9086A" />で既定値として表示される値とこの ID は同じだ。
      この値がゼロだと、メッセージ「しかし 何も おこらなかった」を出力してコマンドを終了する。</simpara>
    </listitem>
    <listitem>
      <simpara>現在、通常戦闘が発生してよい状況なのかどうかをフラグ
      <code>$7E3D2A &amp; #$0010</code> をテストすることで確認する。
      なお、このフラグは <xref linkend="dq6.debug.menu.C908E9" />メニューにある「エンカウント」の操作対象そのものだ。
      フラグがリセットされていると、メッセージ「しかし 何も おこらなかった」を出力してコマンドを終了する。</simpara>
    </listitem>
    <listitem>
      <simpara>フラグがセットされていれば、戦闘開始サブルーチン <varname>$C7952C</varname> を呼び出す。</simpara>
    </listitem>
  </itemizedlist>

全くの個人的な感想だが、フラグのテストを ID 取得より先に処理して欲しい。
</para>
</section> <!-- dq6.spell_commands.desc.C3BDA6 -->

<section id="dq6.spell_commands.desc.C3BDDE">
<title>トヘロス</title>
<para>
トヘロスは次の処理を行うコマンドだ：

  <itemizedlist>
    <listitem>
      <simpara>トヘロス系カウンター <varname>$7E3BA9</varname> をリセットする。</simpara>
    </listitem>
    <listitem>
      <simpara>トヘロスフラグ <code>$7E3D2B &amp; #$0004</code> をセットする。</simpara>
    </listitem>
    <listitem>
      <simpara>せいすいフラグ <code>$7E3D2B &amp; #$0010</code> をリセットする。</simpara>
    </listitem>
  </itemizedlist>

最後にメッセージ <literal>#$16B6</literal> を表示し、コマンドを終了する。
</para>
</section> <!-- dq6.spell_commands.desc.C3BDDE -->

<section id="dq6.spell_commands.desc.C3BE10">
<title>トラマナ</title>
<para>
トラマナはトラマナフラグ <code>$7E3D2B &amp; #$0020</code> をセットするコマンドだ。
実装はここというよりはサブルーチン <varname>$C7CC5C</varname> の呼び出しで済ませている。
</para>
</section> <!-- dq6.spell_commands.desc.C3BE10 -->

<section id="dq6.spell_commands.desc.C3BE24">
<title>フローミ</title>
<para>
フローミはパーティーが現在いる場所のメッセージを表示するコマンドだ。
次のように処理する：

  <itemizedlist>
    <listitem>
      <simpara>サブルーチン <varname>$C7CAFA</varname> を呼び出し、
      フローミ名とフローミ階数を得る。
      このフローミ階数がゼロだと、呪文に意味がない旨を示すメッセージ
      (ID <literal>#$16C5</literal>) を表示してコマンドを終了する。
      この場合 MP の返還処理はない。</simpara>
    </listitem>
    <listitem>
      <simpara>フローミ階数の符号により、表示メッセージを若干変える。
      正数の場合は単に ID <literal>#$16C3</literal> のメッセージを出力する。
      負数の場合はいわゆる二の補数で表現された値の絶対値を計算してから
      ID <literal>#$16C4</literal> のメッセージを出力する。
      </simpara>
<programlisting>
C3/BE59:    49FFFF      EOR #$FFFF          <co id="dq6.spell_comannds.desc.C3BE24.co.1" />
C3/BE5C:    1A          INC A               <co id="dq6.spell_comannds.desc.C3BE24.co.2" />
C3/BE5D:    8D2E5A      STA $5A2E           <co id="dq6.spell_comannds.desc.C3BE24.co.3" />
C3/BE60:    AD305A      LDA $5A30           <co id="dq6.spell_comannds.desc.C3BE24.co.4" />
C3/BE63:    2900FF      AND #$FF00
C3/BE66:    8D305A      STA $5A30
C3/BE69:    22C22DC0    JSR $C02DC2         <co id="dq6.spell_comannds.desc.C3BE24.co.5" />
C3/BE6D:    C416
</programlisting>
<calloutlist>
  <callout arearefs="dq6.spell_comannds.desc.C3BE24.co.1 dq6.spell_comannds.desc.C3BE24.co.2">
    <simpara>情報処理試験の基本問題でよく見かけるように、
    負の整数はそのビットを反転させて 1 を加えれば絶対値を得る。</simpara>
  </callout>
  <callout arearefs="dq6.spell_comannds.desc.C3BE24.co.3 dq6.spell_comannds.desc.C3BE24.co.4">
    <simpara><varname>$5A2E</varname> は次のメッセージ中の [BB] に当てはめる値。
    一方 <varname>$5A30</varname> はこの場合は無視してよい。</simpara>
  </callout>
  <callout arearefs="dq6.spell_comannds.desc.C3BE24.co.5">
    <simpara>メッセージ <literal>#$16C4</literal>: ここは [B2]の[AD]地下[BB]階のようだ。</simpara>
  </callout>
</calloutlist>
    </listitem>
  </itemizedlist>

どちらかのメッセージを出力した後、コマンドを終了する。
</para>
</section> <!-- dq6.spell_commands.desc.C3BE24 -->

<section id="dq6.spell_commands.desc.C3BE7F">
<title>タカのめ</title>
<para>
TBW
</para>
</section> <!-- dq6.spell_commands.desc.C3BE7F -->

<section id="dq6.spell_commands.desc.C3BEF9">
<title>とうぞくのはな</title>
<para>
TBW
</para>
</section> <!-- dq6.spell_commands.desc.C3BEF9 -->

<section id="dq6.spell_commands.desc.C3BF55">
<title>しのびあし</title>
<para>
しのびあしは次の処理を行うコマンドだ：

  <itemizedlist>
    <listitem>
      <simpara>しのびあし歩数 <varname>$7E3BAD</varname> をリセットする。</simpara>
    </listitem>
    <listitem>
      <simpara>しのびあしフラグ <code>$7E3D2B &amp; #$0008</code> をセットする。</simpara>
    </listitem>
  </itemizedlist>

最後にメッセージ <literal>#$16B6</literal> を表示し、コマンドを終了する。
</para>
</section> <!-- dq6.spell_commands.desc.C3BF55 -->

<section id="dq6.spell_commands.desc.C3BF77">
<title>ねる</title>
<para>
ねるは本人の状態をサブルーチン <varname>$C44F0D</varname> 呼び出しによってねむり状態にするコマンドだ。
</para>
</section> <!-- dq6.spell_commands.desc.C3BF77 -->

<section id="dq6.spell_commands.desc.C3BF95">
<title>おおごえ</title>
<para>
おおごえは旅の店屋を呼びつけて営業をさせるコマンドだ。次のようなことを行う：

  <itemizedlist>
    <listitem>
      <simpara>トヘロス・せいすい歩数 <varname>$7E3BA9</varname> をリセットする。</simpara>
    </listitem>
    <listitem>
      <simpara>サブルーチン <varname>$C7CC76</varname> を呼び出し、現在おおごえを利用可能かどうかを調べる。
      無効な場合にはメッセージ <literal>#$16D5</literal> を表示してコマンドを終了する。
      </simpara>
    </listitem>
    <listitem>
      <simpara>おおごえフラグ <code>$7E3D2B &amp; #$0040</code> をセットする。</simpara>
    </listitem>
    <listitem>
      <simpara>最近訪問した店と同じ品揃えの旅の店屋、
      ある旅の宿屋、または旅の神父がそれぞれ確率 1/3 で現れる。</simpara>

      <itemizedlist>
        <listitem>
          <simpara>店屋の場合には <varname>$7E3B77</varname> に格納済みの店屋 ID を参照する。
          店の種別に合わせて出力メッセージ用に誰が現れるのかを決め、
          <xref linkend="dq6.shop.hack.C5F5BE" /> を実行する。</simpara>
        </listitem>
        <listitem>
          <simpara>宿屋の場合には ID <literal>#$0024</literal> の宿屋が現れる。
          それから <xref linkend="dq6.inn.hack.C7CF21" /> を実行する。
          宿賃は一人 100 ゴールドだ。</simpara>
        </listitem>
        <listitem>
          <simpara>教会の場合には ID <literal>#$0006</literal> の教会が現れる。
          つまり「おいのりをする」がない教会だ。
          それから <xref linkend="dq6.church.hack.C3D3AE" /> を実行する。</simpara>
        </listitem>
      </itemizedlist>
    </listitem>
    <listitem>
      <simpara>おおごえフラグ <code>$7E3D2B &amp; #$0040</code> をリセットする。</simpara>
    </listitem>
  </itemizedlist>

フラグをリセットしたら、コマンドを終了する。
</para>
</section> <!-- dq6.spell_commands.desc.C3BF95 -->

<section id="dq6.spell_commands.desc.C3C066">
<title>あなほり</title>
<para>
TBW
</para>
</section> <!-- dq6.spell_commands.desc.C3C066 -->

<section id="dq6.spell_commands.desc.C3C344">
<title>インパス</title>
<para>
TBW
</para>
</section> <!-- dq6.spell_commands.desc.C3C344 -->

<section id="dq6.spell_commands.desc.C3C71B">
<title>レミラーマ</title>
<para>
TBW
</para>
</section> <!-- dq6.spell_commands.desc.C3C71B -->

<section id="dq6.spell_commands.desc.C7CDAF">
<title>おもいだす・もっとおもいだす・ふかくおもいだす</title>
<para>
おもいだす・もっとおもいだす・ふかくおもいだすの各コマンドは同一の処理
<varname>$C7CDAF</varname> に合流するので、まとめて解説する。
</para>
<para>
今まで記憶したメッセージの ID は配列 <varname>$7E3EAC</varname> に最大 32 個格納されている。
これらはこのメッセージを配列の先頭から高々規定個数分を連続してウィンドウに出力するコマンド群だ。
メッセージ数の上限はコマンドによって異なり、次のようになっている：

  <table class="lighttable">
    <caption>おもいだす系コマンドのメッセージ数上限</caption>
    <thead>
      <tr><th>コマンド</th><th>上限</th></tr>
    </thead>
    <tbody>
      <tr><td>おもいだす      </td><td align="right"> 3</td></tr>
      <tr><td>もっとおもいだす</td><td align="right">10</td></tr>
      <tr><td>ふかくおもいだす</td><td align="right">32</td></tr>
    </tbody>
  </table>
</para>
<para>
この配列には値 <literal>#$FFFF</literal> が混入していることがある。
そのときにはこの値をスキップして次に行く（配列の末尾まで <literal>#$FFFF</literal> のはずだが）。
また、メッセージ内の米印文字は星印文字に置換して出力する。
</para>
<para>
この配列の中身 32 個が全て <literal>#$FFFF</literal> で埋まっている場合、
このコマンドはメッセージ <literal>#$16DB</literal> を表示して終了する。
</para>
<para>
プレイヤーがメッセージ出力中にキャンセルボタンを押した場合、
出力するメッセージが残っていてもコマンドを終了する。
また、配列内が事実上空のときにはメッセージ <literal>#$16DB</literal> を表示してコマンドを終了する。
</para>
</section> <!-- dq6.spell_commands.desc.C7CDAF -->

<section id="dq6.spell_commands.desc.C3C7A3">
<title>わすれる</title>
<para>
わすれるは、メッセージ配列 <varname>$7E3EAC</varname> の内容を対話的に削除するコマンドだ。
</para>
<para>
この配列の中身 32 個が全て <literal>#$FFFF</literal> で埋まっている場合、
このコマンドはメッセージ <literal>#$16DC</literal> を表示して終了する。
</para>
<para>
候補メッセージがあるならば、画面に「？つまえ」ウィンドウおよびメッセージ出力ウィンドウを表示する。
「？つまえ」ウィンドウは二種類あり、メッセージ個数が 1 ならば ID <literal>#$00A8</literal> のものを用いるが、
普通は <literal>#$00A7</literal> のものを表示する。
プレイヤーは十字キーの左右でメッセージをめくり、対象を一個決定する。
</para>
<para>
何かメッセージを決定すると、ウィンドウ <literal>#$00A6</literal>「わすれる はい・いいえ」を表示する。
プレイヤーが「はい」と答えると、サブルーチン <varname>$C6E125</varname> を呼び出すことで、
現在表示されているメッセージをメッセージ配列 <varname>$7E3EAC</varname> から取り除き、
それ以降のメッセージ ID をすべて最近覚えた方向にシフトし、
配列の末尾に <literal>#$FFFF</literal> をセットするという一連の処理を実行する。
</para>
<para>
画面に「？つまえ」ウィンドウが表示している間にプレイヤーがキャンセルボタンを押すか、
わすれるためのメッセージ配列が空になったらコマンドを終了する。
</para>
</section> <!-- dq6.spell_commands.desc.C3C7A3 -->
</section> <!-- dq6.spell_commands.desc -->
</section> <!-- dq6.spell_commands -->
