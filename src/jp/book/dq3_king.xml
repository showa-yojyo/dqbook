<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % replacement SYSTEM "replacement.xml">
  %replacement;
]>

<section id="dq3.king"><?dbhtml filename="dq3_king.html" ?>
<title>王様解析</title>
<indexterm id="term.dq3.king"><primary>王様</primary></indexterm>
<indexterm id="term.dq3.save.king"><primary>冒険の書</primary><secondary>DQ3</secondary></indexterm>
<para>
	いろいろな国の城の王様・女王様に話すと、一言二言しゃべったあとにおなじみの処理に入る。
	すなわち、パーティの各メンバーについて、次のレベルになるまでに必要な経験値を教えてから、
	それまでのプレイ内容を冒険の書に記録するかどうかを問う処理だ。
	本節ではその処理を解析する。
</para>

<section id="dq3.king.hack">
<title>解析</title>

<section id="dq3.king.hack.C3C07E">
<title>王様共通処理サブルーチン</title>
<para>
	各国の王・女王に「はなす」と、まずはそれぞれに固有の台詞を言うが、
	その後には全員同じく、レベルアップまでの残り経験値告知と、冒険の書記録の問い合わせからなる手続きを行う。
	この共通した手続きを、ここでは王様共通処理サブルーチンと称する。
</para>
<para>
	王様共通処理サブルーチンは <varname>$C3C07E</varname> に定義されている。
	なお、このサブルーチンを呼び出す前に
	<varname>A</varname> レジスタに台詞セット ID をロードすることが事前条件となっている。
	一例を挙げよう。
</para>

<programlisting>
C3/C4BA:    08          PHP
C3/C4BB:    C230        REP #$30
C3/C4BD:    48          PHA
C3/C4BE:    DA          PHX
C3/C4BF:    5A          PHY
C3/C4C0:    8B          PHB
C3/C4C1:    F47E7E      PEA $7E7E
C3/C4C4:    AB          PLB
C3/C4C5:    AB          PLB
C3/C4C6:    8DA033      STA $33A0
C3/C4C9:    8CA233      STY $33A2
C3/C4CC:    A90000      LDA #$0000          <co id="king.1-co" />
C3/C4CF:    227EC0C3    JSR $C3C07E         <co id="king.2-co" />
C3/C4D3:    AB          PLB
C3/C4D4:    C230        REP #$30
C3/C4D6:    7A          PLY
C3/C4D7:    FA          PLX
C3/C4D8:    68          PLA
C3/C4D9:    28          PLP
C3/C4DA:    6B          RTL
</programlisting>
<calloutlist>
  <callout id="king.1" arearefs="king.1-co">
    <para><varname>$C3C07E</varname> 呼び出し直前に <varname>A</varname> レジスタにセットされている値が、人物の台詞を決める。</para>
<para>
一連の処理では、台詞をウィンドウに表示するのに、
<code>LDA addr,X</code>（ここで <varname>X</varname> は上記 <varname>A</varname> の値と一致する）と、
台詞表示サブルーチン <varname>$C1A95A</varname> 呼び出しを組み合わせて実現している。
ここで、<varname>addr</varname> は王様共通処理サブルーチンの直後に定義されている
<link linkend="dq3.text.travel">メッセージ ID</link> 各配列の配置アドレスだ。
</para>
  </callout>
  <callout id="king.2" arearefs="king.2-co">
    <para><varname>$C3C07E</varname> に定義されている王様共通処理サブルーチンを呼び出す。</para>
  </callout>
</calloutlist>

<para>
	サブルーチン <varname>$C3C07E</varname> の実装は以下の通り。
	紙面が煩雑になるのを避けるため、本筋の処理とは本質的に関係のない処理の説明は省く。
</para>
<itemizedlist>
	<listitem>
		<para>
			<code>A &lt;= #$0009</code> のときに限り <code>A = 0</code> とする。
			<varname>A</varname> レジスタの値は王様それぞれの台詞グループの ID だ。
			<code>X = A</code> としておく。
		</para>
	</listitem>
	<listitem>
		<para>
			パーティの各メンバーが次のレベルになるまでに必要な経験値を教えるために、
			<link linkend="dq3.king.hack.C3C3E4">サブルーチン <varname>$C3C3E4</varname></link> を呼び出す。
		</para>
	</listitem>
	<listitem>
		<para>
			メッセージ ID を <varname>$C3C1E3,X</varname> からロードして、
			汎用メッセージ表示サブルーチンを呼び出すことで
			「そなたらの旅の成果をこの冒険の書に記録してもよいかな？」
			系統の台詞を表示する。
		</para>
	</listitem>
	<listitem>
		<para>
			はい・いいえウィンドウを表示して、プレイヤーの入力を待つ。
		</para>
		<itemizedlist>
			<listitem>
				<para>
					キャンセルボタン or いいえ ⇒【冒険の書は更新しない】へ進む。
				</para>
			</listitem>
			<listitem>
				<para>
					それ以外 ⇒【冒険の書番号を尋ねる】へ進む。
				</para>
			</listitem>
		</itemizedlist>
	</listitem>

	<listitem>
		<para>
			【冒険の書番号を尋ねる】
		</para>
		<itemizedlist>
			<listitem>
				<para>
					メッセージ ID を <varname>$C3C1F7,X</varname> からロードして、
					汎用メッセージ表示サブルーチンを呼び出すことで
					「何番の冒険の書に書きとめるかの？」
					系統の台詞を表示する。
				</para>
			</listitem>
			<listitem>
				<para>
					冒険の書リストウィンドウを表示して、プレイヤーの入力を待つ。
				</para>
				<itemizedlist>
					<listitem>
						<para>
							冒険の書を選択した ⇒【冒険の書を選択した】へ進む。
						</para>
					</listitem>
					<listitem>
						<para>
							それ以外 ⇒
						</para>
						<itemizedlist>
							<listitem>
								<para>
									メッセージ ID を <varname>$C3C229,X</varname> からロードして、
									汎用メッセージ表示サブルーチンを呼び出すことで
									「ではまたいつでも来るがよい。○○○○よ！」
									系統の台詞を表示する。
								</para>
							</listitem>
							<listitem>
								<para>
									【終了】へ進む。
								</para>
							</listitem>
						</itemizedlist>
					</listitem>
				</itemizedlist>
			</listitem>
		</itemizedlist>
	</listitem>
	<listitem>
		<para>
			【冒険の書は更新しない】
		</para>
		<itemizedlist>
			<listitem>
				<para>
					メッセージ ID を <varname>$C3C1ED,X</varname> からロードして、
					汎用メッセージ表示サブルーチンを呼び出すことで
					「では書きとめないでおこう」
					系統の台詞を表示する。
				</para>
			</listitem>
			<listitem>
				<para>
					【ゲーム終了の意思を確認】へ進む。
				</para>
			</listitem>
		</itemizedlist>
	</listitem>

	<listitem>
		<para>【冒険の書を選択した】</para>
		<para>
			選択した冒険の書 ID と <varname>$40AB</varname> すなわち現在プレイ中の冒険の書 ID を比較する。
		</para>
		<itemizedlist>
			<listitem>
				<para>
					違うならば、【現在のものではない冒険の書を選択した】へ制御を進める。
				</para>
			</listitem>
			<listitem>
				<para>
					同じならば、次の処理【セーブ】へ制御を進める。
				</para>
			</listitem>
		</itemizedlist>
	</listitem>
	<listitem>
		<para>【セーブ】</para>
		<para>
			<link linkend="dq3.sistersave.hack.C3C251">シスターセーブ</link>と同様の処理をする。
			すなわち、以下のコードを実行する。
		</para>
<programlisting>
C3/C0FB:    ACA033      LDY $33A0
C3/C0FE:    22CE2BC4    JSR $C42BCE         ■(RTL+1) 未解析サブルーチン
C3/C102:    FD
C3/C103:    ACA233      LDY $33A2
C3/C106:    222C2CC4    JSR $C42C2C         ■(RTL+1) 未解析サブルーチン
C3/C10A:    FD
C3/C10B:    224E62C4    JSR $C4624E         ■(RTL+1) 未解析サブルーチン
C3/C10F:    FF
</programlisting>
	</listitem>
	<listitem>
		<para>
			効果音 (ID: <literal>#$002B</literal>) を鳴らし、終わるまで待つ。
		</para>
	</listitem>

	<listitem>
		<para>
			【現在のものではない冒険の書を選択した】
		</para>
		<para>
			<varname>A</varname> レジスタにプレイヤーが選択した冒険の書 ID (<literal>0..2</literal>) がロード済みとなっている。
		</para>
		<itemizedlist>
			<listitem>
				<para>
					選択した冒険の書が未使用かどうかをテストするため、
					<link linkend="dq3.king.hack.C3C300">サブルーチン <varname>$C3C300</varname></link> を呼び出す。
				</para>
				<itemizedlist>
					<listitem>
						<para>
							未使用であれば【セーブ】に制御を移す。
						</para>
					</listitem>
				</itemizedlist>
			</listitem>
			<listitem>
				<para>
					選択した冒険の書の識別用文字列 ID を取得するために
					<link linkend="dq3.king.hack.C3C31F">サブルーチン <varname>$C3C31F</varname></link> を呼び出す。
					そして <varname>$BE77</varname> にセットする。
				</para>
			</listitem>
			<listitem>
				<para>
					選択した冒険の書の勇者レベルを取得するために
					<link linkend="dq3.king.hack.C3C332">サブルーチン <varname>$C3C332</varname></link> を呼び出す。
					そして <varname>$BE81</varname> に <literal>3</literal> バイトサイズでセットする。
				</para>
			</listitem>
			<listitem>
				<para>
					メッセージ ID を <varname>$C3C201,X</varname> からロードして、
					汎用メッセージ表示サブルーチンを呼び出すことで
					「すると○○○○ ＬＶ○○の記録は消えてしまうが？」
					系統の台詞を表示する。
				</para>
			</listitem>
			<listitem>
				<para>
					はい・いいえウィンドウを表示して、プレイヤーの入力を待つ。
				</para>
				<itemizedlist>
					<listitem>
						<para>
							キャンセルボタン or いいえ ⇒【冒険の書番号を尋ねる】へ戻る。
						</para>
					</listitem>
					<listitem>
						<para>
							それ以外 ⇒【セーブ】に制御を移す。
						</para>
					</listitem>
				</itemizedlist>
			</listitem>
		</itemizedlist>
	</listitem>
	<listitem>
		<para>
			【記録終了】
		</para>
		<itemizedlist>
			<listitem>
				<para>
					メッセージ ID を <varname>$C3C20B,X</varname> からロードして、
					汎用メッセージ表示サブルーチンを呼び出すことで
					「しかときろくしたぞよ。またすぐに旅立つつもりか？」
					系統の台詞を表示する。
				</para>
			</listitem>
			<listitem>
				<para>
					はい・いいえウィンドウを表示して、プレイヤーの入力を待つ。
				</para>
				<itemizedlist>
					<listitem>
						<para>
							キャンセルボタン or いいえ ⇒【また会おう】へ進む。
						</para>
					</listitem>
					<listitem>
						<para>
							それ以外 ⇒【終了】へ進む。
						</para>
					</listitem>
				</itemizedlist>
			</listitem>
		</itemizedlist>
	</listitem>

	<listitem>
		<para>
			【ゲーム終了の意思を確認】
		</para>
		<itemizedlist>
			<listitem>
				<para>
					メッセージ ID を <varname>$C3C20B,X</varname> からロードして、
					汎用メッセージ表示サブルーチンを呼び出すことで
					「また すぐに旅立つ つもりかの？」
					系統の台詞を表示する。
				</para>
			</listitem>
			<listitem>
				<para>
					はい・いいえウィンドウを表示して、プレイヤーの入力を待つ。
				</para>
				<itemizedlist>
					<listitem>
						<para>
							キャンセルボタン or いいえ ⇒【さらに確認】へ進む。
						</para>
					</listitem>
					<listitem>
						<para>
							それ以外 ⇒【終了】へ進む。
						</para>
					</listitem>
				</itemizedlist>
			</listitem>
		</itemizedlist>
	</listitem>
	<!-- 冒険の書番号を尋ねる -->
	<listitem>
		<para>
			【さらに確認】
		</para>
		<itemizedlist>
			<listitem>
				<para>
					メッセージ ID を <varname>$C3C21F,X</varname>  からロードして、
					汎用メッセージ表示サブルーチンを呼び出すことで
					「旅の記録が前に書きとめたところまで戻ってしまうが？」
					系統の台詞を表示する。
				</para>
			</listitem>
			<listitem>
				<para>
					はい・いいえウィンドウを表示して、プレイヤーの入力を待つ。
				</para>
				<itemizedlist>
					<listitem>
						<para>
							キャンセルボタン or いいえ ⇒【冒険の書番号を尋ねる】へ戻る。
						</para>
					</listitem>
					<listitem>
						<para>
							それ以外 ⇒【また会おう】へ進む。
						</para>
					</listitem>
				</itemizedlist>
			</listitem>
		</itemizedlist>
	</listitem>
	<listitem>
		<para>
			【また会おう】
		</para>
		<itemizedlist>
			<listitem>
				<para>
					メッセージ ID を <varname>$C3C233,X</varname>  からロードして、
					汎用メッセージ表示サブルーチンを呼び出すことで
					「ではしばし休むがよい！ また会おう！ ○○○○よ！」
					系統の台詞を表示する。
				</para>
			</listitem>
			<listitem>
				<para>
					<code>JMP $C67B76</code> して画面暗転。
				</para>
			</listitem>
		</itemizedlist>
	</listitem>
	<listitem>
		<para>【終了】</para>
		<para>
			サブルーチン呼び出し元に制御を戻す。
		</para>
	</listitem>
</itemizedlist>
</section> <!-- dq3.king.hack.C3C07E -->

<section id="dq3.king.hack.C3C300">
<title>冒険の書が使用済かチェックするサブルーチン</title>
<para>
	サブルーチン <varname>$C3C300</varname> は
	<varname>A</varname> レジスタの値で示される冒険の書が既に使用されているかどうかを調べるものだ。
</para>
<itemizedlist>
	<listitem>
		<para>【事前条件】</para>
		<para>
			<varname>A</varname> レジスタには調べたい冒険の書 ID がロード済み。
			<code>A == 0, 1, 2</code> のどれかである。
		</para>
	</listitem>
	<listitem>
		<para>
			<code>LDA $C3C319,X</code> (where <code>X == A * 2</code>) により、<varname>A</varname> レジスタに <literal>2</literal> バイトの定数をロードする。
			これはアドレス値だ。
		</para>
	</listitem>
	<listitem>
		<para>
			<varname>$0000,X</varname> (where <code>X == A</code>) の値と <literal>1</literal> を比較する。
		</para>
		<itemizedlist>
			<listitem>
				<para>
					等しい ⇒ <varname>Carry</varname> ビットをリセット
				</para>
			</listitem>
			<listitem>
				<para>
					それ以外 ⇒ <varname>Carry</varname> ビットをセット
				</para>
			</listitem>
		</itemizedlist>
	</listitem>
	<listitem>
		<para>
			サブルーチン呼び出し元に制御を戻す。
		</para>
	</listitem>
	<listitem>
		<para>【事後条件】</para>
		<para>
			冒険の書が未使用ならば <code>Carry == 1</code>; そうでなければ <code>Carry == 0</code>
		</para>
	</listitem>
</itemizedlist>
<para>
	小さなデータ領域 <varname>$C3C319</varname> は以下の通りになっている。
	つまり、それぞれの <varname>$7Exxxx</varname> に存在する <literal>2</literal> バイト値が、
	それぞれの冒険の書の使用・未使用のフラグになっているのだ。
</para>
<programlisting>
C3/C319:    6940  ; 冒険の書 1 が使用済ならば $7E4069 == 1
C3/C31B:    6B40  ; 冒険の書 2
C3/C31D:    6D40  ; 冒険の書 3
</programlisting>
</section> <!-- dq3.king.hack.C3C300 -->

<section id="dq3.king.hack.C3C31F">
<title>冒険の書の名前文字列 ID を取得するサブルーチン</title>
<para>
	サブルーチン <varname>$C3C31F</varname> は
	<varname>A</varname> レジスタの値で示される冒険の書の名前文字列 ID を取得する。
	実装は以下の通り。
</para>
<itemizedlist>
	<listitem>
		<para>【事前条件】</para>
		<para>
			<varname>A</varname> レジスタには調べたい冒険の書 ID がロード済み。
			<code>A == 0, 1, 2</code> のどれかである。
		</para>
	</listitem>
	<listitem>
		<para>
			<code>LDA $C3C32C,X</code> (where <code>X == A * 2</code>) により、
			<varname>A</varname> レジスタに <literal>2</literal> バイトの定数をロードする。
			これはアドレス値だ。
		</para>
	</listitem>
	<listitem>
		<para>
			<varname>$0000,X</varname> (where <code>X == A</code>) の値を <varname>A</varname> レジスタにロードする。
		</para>
	</listitem>
	<listitem>
		<para>
			サブルーチン呼び出し元に制御を戻す。
		</para>
	</listitem>
	<listitem>
		<para>【事後条件】</para>
		<para>
			<varname>A</varname> レジスタには冒険の書の名前文字列 ID がロードされている。
		</para>
	</listitem>
</itemizedlist>
<para>
	小さなデータ領域 <varname>$C3C32C</varname> は以下の通りになっている。
	つまり、それぞれの <varname>$7Exxxx</varname> に存在する <literal>2</literal> バイト値が、
	それぞれの冒険の書の名前文字列 ID だ。
</para>
<programlisting>
C3/C32C:    7540  ; $7E4075 を意味する
C3/C32E:    7740  ; $7E4077
C3/C330:    7940  ; $7E4079
</programlisting>
</section> <!-- dq3.king.hack.C3C31F -->

<section id="dq3.king.hack.C3C332">
<title>冒険の書の勇者レベルを取得するサブルーチン</title>
<para>
	サブルーチン <varname>$C3C332</varname> は
	<varname>A</varname> レジスタの値で示される冒険の書の勇者レベルを取得する。
	実装は以下の通り。
</para>
<itemizedlist>
	<listitem>
		<para>【事前条件】</para>
		<para>
			<varname>A</varname> レジスタには調べたい冒険の書 ID がロード済み。
			<code>A == 0, 1, 2</code> のどれかである。
		</para>
	</listitem>
	<listitem>
		<para>
			<code>LDA $C3C33F,X</code> (where <code>X == A * 2</code>) により、
			<varname>A</varname> レジスタに <literal>2</literal> バイトの定数をロードする。
		</para>
	</listitem>
	<listitem>
		<para>
			<varname>$0000,X</varname> (where <code>X == A</code>) の値を <varname>A</varname> レジスタにロードする。
		</para>
	</listitem>
	<listitem>
		<para>
			サブルーチン呼び出し元に制御を戻す。
		</para>
	</listitem>
	<listitem>
		<para>【事後条件】</para>
		<para>
			<varname>A</varname> レジスタには冒険の書の勇者レベルがロードされている。
		</para>
	</listitem>
</itemizedlist>
<para>
	小さなデータ領域 <varname>$C3C33F</varname> は以下の通りになっている。
	つまり、それぞれの <varname>$7Exxxx</varname> に存在する <literal>2</literal> バイト値が、
	それぞれの冒険の書の勇者のレベルだ。
</para>
<programlisting>
C3/C33F:    6F40  ; $7E406F を意味する
C3/C341:    7140  ; $7E4071
C3/C343:    7340  ; $7E4073
</programlisting>
</section> <!-- dq3.king.hack.C3C332 -->

<section id="dq3.king.hack.C3C3E4">
<title>次のレベルに必要な経験値を知らせる処理サブルーチン</title>
<para>
	王様共通処理の中で、この処理だけは個別にサブルーチン化されている。
	サブルーチン <varname>$C3C3E4</varname> の実装は以下の通り。
</para>
<itemizedlist>
	<listitem>
		<para>
			<code>A &lt;= #$0009</code> のときに限り <code>A = 0</code> とする。
			<varname>A</varname> レジスタの値は王様それぞれの台詞グループの ID だ。
			さらに <varname>$74</varname> にこの値をとっておく。
		</para>
	</listitem>
	<listitem>
		<para>
			パーティの人数取得サブルーチン <varname>$C4297C</varname> を呼び出す。
			<varname>Y</varname> レジスタに人数をロードする。
		</para>
	</listitem>
	<listitem>
		<para>
			【一人分の処理開始】
		</para>
		<itemizedlist>
			<listitem>
				<para>
					パーティメンバーの先頭から
					<varname>A</varname> 番目のキャラクターの<emphasis>現在のレベル</emphasis>を取得するために、
					サブルーチン <varname>$C42FEB</varname> を呼び出す。
				</para>
			</listitem>
			<listitem>
				<para>
					<varname>X</varname> = 現在のレベル + <literal>1</literal> とする。すなわち<emphasis>次のレベル</emphasis>だ。
				</para>
			</listitem>
			<listitem>
				<para>
					キャラクターの<emphasis>次のレベルの経験値</emphasis>を取得するために、
					サブルーチン <varname>$C43C07</varname> を呼び出す。
					呼び出し終了後、値が <varname>$70</varname> に <literal>3</literal> バイトサイズでセットされている。
				</para>
				<itemizedlist>
					<listitem>
						<para>
							この呼び出し先によって
							<varname>Carry</varname> ビットがリセットされている場合、
							【現在の経験値を見る】に進む。
						</para>
					</listitem>
				</itemizedlist>
			</listitem>
			<listitem>
				<para>
					メッセージ ID を <varname>$C3C23D,X</varname> (where <code>X == $74</code>) からロードして【台詞表示】に進む。
					これは「○○○○はもう十分に強い！」
					系統の台詞 ID を意味する。
				</para>
			</listitem>
		</itemizedlist>
	</listitem>

	<listitem>
		<para>
			【現在の経験値を見る】
		</para>
		<itemizedlist>
			<listitem>
				<para>
					<literal>3</literal> バイトコピー代入処理として <code>$BE81 = $70</code> する。すなわち、
					キャラクターの次のレベルの経験値を <varname>$BE81</varname> にセットする。
				</para>
			</listitem>
			<listitem>
				<para>
					キャラクターの<emphasis>現在の経験値</emphasis>を調べるべく、
					サブルーチン <varname>$C43B5F</varname> を呼び出す。
					呼び出し先で <varname>$70</varname> が現在の経験値で上書きされる。
				</para>
			</listitem>
			<listitem>
				<para>
					<varname>$71</varname> と <varname>$BE82</varname> を比較する。
					<literal>3</literal> バイト値の上位 <literal>2</literal> バイトの比較だ。
				</para>
				<itemizedlist>
					<listitem>
						<para>
							<code>$71 == $BE82</code> ⇒ さらに <varname>$70</varname> と <varname>$BE81</varname> を比較する。
						</para>
					</listitem>
					<listitem>
						<para>
							<code>$71 &gt; $BE82</code> ⇒【現在の経験値が多すぎ】に進む。
						</para>
					</listitem>
					<listitem>
						<para>
							それ以外は【経験値の差を計算】に進む。
						</para>
					</listitem>
				</itemizedlist>
			</listitem>
			<listitem>
				<para>
					<varname>$70</varname> と <varname>$BE81</varname> を比較する。
				</para>
				<itemizedlist>
					<listitem>
						<para>
							<code>$70 &lt; $BE81</code> ⇒【経験値の差を計算】に進む。
						</para>
					</listitem>
					<listitem>
						<para>
							それ以外 ⇒【現在の経験値が多すぎ】に進む。
						</para>
					</listitem>
				</itemizedlist>
			</listitem>
		</itemizedlist>
	</listitem>

	<listitem>
		<para>
			【経験値の差を計算】
		</para>
		<itemizedlist>
			<listitem>
				<para>
					<code>$BE81 -= $70</code> の算術処理を <literal>3</literal> バイトサイズで行う。
				</para>
			</listitem>
			<listitem>
				<para>
					メッセージ ID を <varname>$C3C1D9,X</varname> (where <code>X == $74</code>) からロードして【台詞表示】に進む。
					これは「次のレベルになるにはあと○○○の経験が必要じゃ」
					系統の台詞 ID を意味する。
				</para>
			</listitem>
		</itemizedlist>
	</listitem>

	<listitem>
		<para>
			【現在の経験値が多すぎ】
		</para>
		<itemizedlist>
			<listitem>
				<para>
					メッセージ ID を <varname>$C3C247,X</varname> (where <code>X == $74</code>) からロードして【台詞表示】に進む。
					これは「○○○○はわしにもわからぬ経験を積んだようじゃな」
					系統の台詞 ID を意味する。
				</para>
			</listitem>
		</itemizedlist>
	</listitem>

	<listitem>
		<para>
			【台詞表示】
		</para>
		<itemizedlist>
			<listitem>
				<para>
					メッセージ表示サブルーチン <varname>$C1A95A</varname> を呼び出す。
				</para>
			</listitem>
			<listitem>
				<para>
					次のキャラクターがいれば、<varname>$BE7D</varname> を
					次のキャラクターにセットして、制御を【一人分の処理開始】に戻す。
				</para>
			</listitem>
		</itemizedlist>
	</listitem>

	<listitem>
		<para>【終了】</para>
		<para>
			サブルーチン呼び出し元に制御を戻す。
		</para>
	</listitem>
</itemizedlist>
</section> <!-- dq3.king.hack.C3C3E4 -->

<section id="dq3.king.hack.lines">
<title>王様処理台詞用メッセージ ID 配列群</title>
<para>
	これまで述べてきた各処理中には、<code>LDA addr,X</code> によってメッセージ ID を参照する箇所がいくつかあった。
	今後の解析作業用に、その一覧を以下にまとめる。
	各 <code>addr,X</code> は <literal>2</literal> バイトサイズの値が <literal>5</literal> 個からなる配列であり、
	各 <literal>2</literal> バイトの値は王様の台詞メッセージ ID だが、
	ここでは <varname>X</varname> がゼロのときの台詞を記しておけば、作業には十分役立つだろう。
</para>
<variablelist>
	<varlistentry>
		<term><varname>$C3C1D9,X</varname></term>
		<listitem>
			<para>[CD][D6]王「[C0]が つぎのレベルに[AD]なるには あと[BB]の[AD]けいけんが 必要じゃ。[AF][AC]</para>
		</listitem>
	</varlistentry>

	<varlistentry>
		<term><varname>$C3C1E3,X</varname></term>
		<listitem>
			<para>[CD][D6]王「そなたらの 旅の せいかを[AD]この 冒険の書に[AD]きろくしても よいかな？[AC]</para>
		</listitem>
	</varlistentry>

	<varlistentry>
		<term><varname>$C3C1ED,X</varname></term>
		<listitem>
			<para>[CD][D6]王「そうか… では[AD]書きとめないでおこう。[AF][AC]</para>
		</listitem>
	</varlistentry>

	<varlistentry>
		<term><varname>$C3C1F7,X</varname></term>
		<listitem>
			<para>[CD][D6]王「では なん番の 冒険の書に[AD]書きとめるかの？[AC]</para>
		</listitem>
	</varlistentry>

	<varlistentry>
		<term><varname>$C3C201,X</varname></term>
		<listitem>
			<para>[CD][D6]王「すると [B2] ＬＶ[BB]の[AD]きろくは 消えてしまうが[AD]それでも いいかな？[AC]</para>
		</listitem>
	</varlistentry>

	<varlistentry>
		<term><varname>$C3C20B,X</varname></term>
		<listitem>
			<para>[CD][D6]王「しかと きろくしたぞよ。[AD]どうじゃ？ また すぐに[AD]旅立つ つもりか？[AC]</para>
		</listitem>
	</varlistentry>

	<varlistentry>
		<term><varname>$C3C215,X</varname></term>
		<listitem>
			<para>[CD][D6]王「また すぐに[AD]旅立つ つもりかの？[AC]</para>
		</listitem>
	</varlistentry>

	<varlistentry>
		<term><varname>$C3C21F,X</varname></term>
		<listitem>
			<para>[CD][D6]王「なんと！ きろくせずに[AD]休むというのか。[AF]...</para>
		</listitem>
	</varlistentry>

	<varlistentry>
		<term><varname>$C3C229,X</varname></term>
		<listitem>
			<para>[CD][D6]王「おや やめるのかね。[AD]では また いつでも 来るがよい。[AD][CB]よ！[AC]</para>
		</listitem>
	</varlistentry>

	<varlistentry>
		<term><varname>$C3C233,X</varname></term>
		<listitem>
			<para>[CD][D6]王「では しばし 休むがよい！[AD]また 会おう！ [CB]よ！[AC]</para>
		</listitem>
	</varlistentry>

	<varlistentry>
		<term><varname>$C3C23D,X</varname></term>
		<listitem>
			<para>[CD][D6]王「[C0]は[AD]もう じゅうぶんに 強い！[AF][AC]</para>
		</listitem>
	</varlistentry>

	<varlistentry>
		<term><varname>$C3C247,X</varname></term>
		<listitem>
			<para>[CD][D6]王「[C0]は わしにも わからぬ[AD]けいけんを つんだようじゃな。[AF]...</para>
		</listitem>
	</varlistentry>
</variablelist>
</section> <!-- dq3.king.hack.lines -->
</section> <!-- dq3.king.hack -->
</section> <!-- dq3.king -->
