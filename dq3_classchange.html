<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>5.17. 転職解析</title>
    <link rel="stylesheet" type="text/css" href="dqbook.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="home" href="index.html" title="ドラクエ命" />
    <link rel="up" href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)" />
    <link rel="prev" href="dq3_bank.html" title="5.16. ゴールド銀行解析" />
    <link rel="next" href="dq3_rename.html" title="5.18. 命名神解析" />
  </head>
  <body>
    <div class="navigation"><table><tr><td class="online-navigation"><a href="dq3_bank.html" title="5.16. ゴールド銀行解析"><img src="image/docbook/prev.png" alt="戻る" /></a></td><td class="online-navigation"><a href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)"><img src="image/docbook/up.png" alt="上に戻る" /></a></td><td class="online-navigation"><a href="dq3_rename.html" title="5.18. 命名神解析"><img src="image/docbook/next.png" alt="次へ" /></a></td><td>ドラクエ命</td><td class="online-navigation"><a href="index.html" title="ドラクエ命"><img src="image/docbook/home.png" alt="ホーム" /></a></td><td class="online-navigation"><a href="" title=""><img src="image/docbook/index.png" alt="索引" /></a></td></tr></table><b class="navlabel">Previous: </b><a accesskey="p" class="sectref" href="dq3_bank.html">5.16. ゴールド銀行解析</a> <b class="navlabel">Up: </b><a accesskey="u" class="sectref" href="dq3.html">第 5 章 SFC 版ドラクエ 3 (1996)</a> <b class="navlabel">Next: </b><a accesskey="n" class="sectref" href="dq3_rename.html">5.18. 命名神解析</a><hr /></div>
    <div class="section">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a id="dq3.classchange"></a>5.17. 転職解析</h2>
          </div>
        </div>
      </div>
      <div class="toc">
        <dl class="toc">
          <dt>
            <span class="section">
              <a href="dq3_classchange.html#dq3.classchange.hack">5.17.1. 解析</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="dq3_classchange.html#dq3.classchange.hack.C3E477">5.17.1.1. 転職共通処理サブルーチン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_classchange.html#dq3.classchange.hack.C3E7CC">5.17.1.2. 装備品の交換</a>
                </span>
              </dt>
            </dl>
          </dd>
        </dl>
      </div>
      <a id="term.dq3.classchange.1" class="indexterm"></a>
      <a id="term.dq3.classchange.2" class="indexterm"></a>
      <p>
	ダーマの神殿にいる神官が行う転職手続きを処理するプログラムの逆アセンブルコードを解析する。
	「転職したいキャラクターの性格によって神官が感想を漏らす」処理と、
	「転職直後のキャラクターの装備をセットする」処理がファミコン版にはなかった機能だが、
	前者は性格と新職業の対をキーにするデータ構造の存在をにおわせるし、
	後者は職業とその装備可能アイテムの線形リスト探索処理を想像させられて、
	興味をそそられる解析テーマとなっている。
</p>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="dq3.classchange.hack"></a>5.17.1. 解析</h3>
            </div>
          </div>
        </div>
        <p>
	<a class="link" href="dq3_classchange.html#dq3.classchange.hack.C3E477" title="5.17.1.1. 転職共通処理サブルーチン">転職処理のメインルーチン</a>は、
	他の店屋系統の共通処理サブルーチンが連なるバンク
	<code class="varname">$C3</code> の逆アセンブルコードをファイルに書き出し、
	その後半部をテキストエディターで眺めていれば見つかるものだ。
</p>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.classchange.hack.C3E477"></a>5.17.1.1. 転職共通処理サブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$C3E477</code> は、
	ダーマの神殿の中央にいる神官に「はなす」と呼び出される処理である。
	逆アセンブルコードで見ると大変長いプログラムのようだが、
	台詞表示サブルーチン呼び出しと「はい・いいえ」メニューウィンドウの表示サブルーチンの呼び出しが多いため、
	解読は本質的に容易い。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			台詞「ここは転職をつかさどるダーマの神殿」(ID: <code class="literal">#$0B10</code>) を表示する。
		</p>
              </li>
              <li class="listitem">
                <p>
			「はい・いいえ」ウィンドウを表示して、プレイヤーの入力を待つ。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					キャンセルボタン or 「いいえ」⇒【転職しない】へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【だれを】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「どなたの職業をかえたいのじゃ？」(ID: <code class="literal">#$0B12</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					ウィンドウ「だれを」を表示し、プレイヤーの入力を待つ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャンセルボタン ⇒【やっぱりやめる】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">$33D6</code>, <code class="varname">$BE7D</code>, <code class="varname">Y</code> に選択キャラクターの並び順 (<code class="literal">0,1,2,3</code>) をセットする。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					キャラクター状態取得サブルーチン <code class="varname">$C43F87</code> を呼び出し、
					パーティにいるキャラクター (<code class="varname">Y</code>) の生死状態値を取得 (<code class="varname">A</code>) する。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							<code class="code">A &amp; 0010h</code> ⇒【死んでいる】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					キャラクター職業取得サブルーチン <code class="varname">$C46951</code> を呼び出し、
					パーティにいるキャラクター (<code class="varname">Y</code>) の職業 ID を取得 (<code class="varname">X</code>) する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">$33DA = X;</code> 職業 ID
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					職業構造体データアドレス取得サブルーチン <code class="varname">$C4691B</code> を呼び出し、
					職業 (<code class="varname">X</code>) のデータアドレスを取得 (<code class="varname">X</code>) する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">$BE77 = X;</code> 職業データアドレス
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					キャラクター主人公判定サブルーチン <code class="varname">$C42DA1</code> を呼び出し、
					パーティにいるキャラクター (<code class="varname">Y</code>) が主人公であるか、テスト (<code class="varname">Carry</code>) する。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							主人公でない ⇒【レベルテスト】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					台詞「おろか者め！ 勇者をやめたいというのか？」(ID: <code class="literal">#$0B14</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					【ほかにも】へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【死んでいる】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「たわけが！ 死んでおるではないか」(ID: <code class="literal">#$0B13</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					【ほかにも】へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【やっぱりやめる】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「ふむ…やめると申すか？」(ID: <code class="literal">#$0B1C</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					【ほかにも】へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【レベルテスト】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					キャラクターレベル取得サブルーチン <code class="varname">$C42FEB</code> を呼び出し、
					パーティにいるキャラクター (<code class="varname">Y</code>) のレベルを取得 (<code class="varname">X</code>) する。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							<code class="code">X &gt;= 20</code> ⇒【どの職業】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					台詞「未熟者の分際で職を変えたいとは～」(ID: <code class="literal">#$0B15</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					【ほかにも】へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【どの職業】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「○○○○がなりたいのはどの職業じゃな？」(ID: <code class="literal">#$0B16</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					職業リストウィンドウを表示して、プレイヤーの入力を待つ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
						キャンセルボタン ⇒【やっぱりやめる】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">$33DC = A;</code> 職業 ID
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					職業名取得サブルーチン <code class="varname">$C4691B</code> を呼び出し、
					職業 (<code class="varname">A</code>) の名前文字列 ID を取得 (<code class="varname">X</code>) する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">$BE77 = X;</code> 名前文字列 ID
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					台詞「○○○○は ××××になりたいと申すか？」(ID: <code class="literal">#$0B17</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					「はい・いいえ」ウィンドウを表示して、プレイヤーの入力を待つ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャンセルボタン or 「いいえ」⇒【どの職業】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					選択した職業 (<code class="varname">$33DC</code>) と今の職業 (<code class="varname">$33DA</code>) を比較する。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							異なる職業である ⇒【確認】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					台詞「○○○○はもうそれになっているぞ」(ID: <code class="literal">#$0B18</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					【どの職業】へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【確認】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<a class="link" href="dq3_classchange.html#dq3.classchange.hack.C3E5F8" title="5.17.1.1.1. 性格によっては神官がコメントを出すサブルーチン">サブルーチン <code class="varname">$E5F8</code></a> を呼び出し、
					キャラクターの性格によっては神官がコメントを出す。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					台詞「一度レベル 1 に戻り～」(ID: <code class="literal">#$0B19</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					「はい・いいえ」ウィンドウを表示して、プレイヤーの入力を待つ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャンセルボタン or 「いいえ」⇒【やっぱりやめる】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					台詞「おお 神よ ○○○○が新たな職につくことを～」(ID: <code class="literal">#$0B1A</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					効果音 (ID: <code class="literal">#$0028</code>) を鳴らし、鳴り終えるまで待つ。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<a class="link" href="dq3_classchange.html#dq3.classchange.hack.C3E79C" title="5.17.1.1.2. 「さとりのしょ」を消費するサブルーチン">サブルーチン <code class="varname">$E79C</code></a> を呼び出し、
					必要ならば「さとりのしょ」をキャラクターの所持品から削除する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">A = $33D6;</code> 選択キャラクター
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="code">X = $33DC;</code> 選択職業
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					サブルーチン <code class="varname">$C46987</code> を呼び出し、
					転職後のキャラクターのパラメータ・ステータス（実は呪いが解ける）を決定する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<a class="link" href="dq3_classchange.html#dq3.classchange.hack.C3E7CC" title="5.17.1.2. 装備品の交換">サブルーチン <code class="varname">$C3E7CC</code></a> を呼び出し、
					選択キャラクターの装備品を変更する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					台詞「よろしい。では今から○○○○は××××じゃ！」(ID: <code class="literal">#$0B1B</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					【ほかにも】へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【やっぱりやめる】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「ふむ… やめると申すか？ それもよろしかろう」(ID: <code class="literal">#$0B1C</code>) を表示する。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【ほかにも】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「ほかにも転職したい者はおるかな？」(ID: <code class="literal">#$0B1D</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					「はい・いいえ」ウィンドウを表示して、プレイヤーの入力を待つ。
				</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" style="list-style-type: square; ">
                          <li class="listitem">
                            <p>
							キャンセルボタン or 「いいえ」⇒【終了】へジャンプ。
						</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
					【だれを】へジャンプ。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【転職しない】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「転職をせぬのじゃな？ まあそれもよかろう」(ID: <code class="literal">#$0B11</code>) を表示する。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【終了】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					台詞「ではゆくがよい」(ID: <code class="literal">#$0B1E</code>) を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					呼び出し元に制御を戻す。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
          <div class="section">
            <div class="titlepage">
              <div>
                <div>
                  <h5 class="title"><a id="dq3.classchange.hack.C3E5F8"></a>5.17.1.1.1. 性格によっては神官がコメントを出すサブルーチン</h5>
                </div>
              </div>
            </div>
            <p>
	サブルーチン <code class="varname">$E5F8</code> は、転職するキャラクターの性格によって、
	神官が余計な一言をはなす処理である。
	以下のような流れになる。
</p>
            <div class="itemizedlist">
              <ul class="itemizedlist" style="list-style-type: disc; ">
                <li class="listitem">
                  <p>
			【事前条件】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<code class="varname">$33D6</code> == 転職したいキャラクターの並び順
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="varname">$33DC</code> == 新職業 ID
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			キャラクター性格取得サブルーチン <code class="varname">$C42E53</code> を呼び出し、
			パーティーにいるキャラクター (<code class="varname">A</code>) の性格を取得 (<code class="varname">Y</code>) する。
		</p>
                </li>
                <li class="listitem">
                  <p>
			構造体データアドレス取得サブルーチン <code class="varname">$C90501</code> を呼び出し、
			性格 (<code class="varname">Y</code>) データ格納アドレスを取得 (<code class="varname">$78</code>) する。
		</p>
                </li>
                <li class="listitem">
                  <p>
			<code class="code">X = $33DC;</code> 新職業 ID
		</p>
                </li>
                <li class="listitem">
                  <p>
			性格名取得サブルーチン <code class="varname">$C42F28</code> を呼び出し、
			性格 (<code class="varname">Y</code>) の名前を表す文字列 ID を取得 (<code class="varname">Y</code>) する。
		</p>
                </li>
                <li class="listitem">
                  <p>
			転職したい職業の職業 ID (<code class="varname">X</code>) により、
			性格構造体データのフィールド値を以下のように取得 (<code class="varname">A</code>) する。
			フィールドの値は必要に応じて右シフトしたものになる。
		</p>
                  <div class="table">
                    <a id="table.dq3.C3E5F8.1"></a>
                    <p class="title">
                      <strong>表 5.29 $E5F8 職業による分岐</strong>
                    </p>
                    <div class="table-contents">
                      <table id="table.dq3.C3E5F8.1" class="lighttable">
                        <thead>
                          <tr>
                            <th>ID</th>
                            <th>職業</th>
                            <th>フィールド</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>
                              <code class="literal">#$0000</code>
                            </td>
                            <td>せんし      </td>
                            <td>
                              <code class="code">A = data[#$0007] &amp; 0780</code>
                            </td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0001</code>
                            </td>
                            <td>ぶとうか    </td>
                            <td>
                              <code class="code">A = data[#$0008] &amp; 0078</code>
                            </td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0002</code>
                            </td>
                            <td>まほうつかい</td>
                            <td>
                              <code class="code">A = data[#$0009] &amp; 0078</code>
                            </td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0003</code>
                            </td>
                            <td>そうりょ    </td>
                            <td>
                              <code class="code">A = data[#$0008] &amp; 0780</code>
                            </td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0004</code>
                            </td>
                            <td>しょうにん  </td>
                            <td>
                              <code class="code">A = data[#$000A] &amp; 0780</code>
                            </td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0005</code>
                            </td>
                            <td>あそびにん  </td>
                            <td>
                              <code class="code">A = data[#$000A] &amp; 0078</code>
                            </td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0006</code>
                            </td>
                            <td>とうぞく    </td>
                            <td>
                              <code class="code">A = data[#$000B] &amp; 0078</code>
                            </td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0007</code>
                            </td>
                            <td>けんじゃ    </td>
                            <td>
                              <code class="code">A = data[#$0009] &amp; 0780</code>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <br class="table-break" />
                </li>
                <li class="listitem">
                  <p>
			<code class="varname">A</code> レジスタの値を基にジャンプテーブルで定義されたアドレスにジャンプし、
			転職したいキャラクターの性格と、
			転職したい職業に応じたコメントをダーマの神官に話させる。
		</p>
                  <div class="table">
                    <a id="table.dq3.C3E5F8.2"></a>
                    <p class="title">
                      <strong>表 5.30 $E5F8 職業による分岐</strong>
                    </p>
                    <div class="table-contents">
                      <table id="table.dq3.C3E5F8.2" class="lighttable">
                        <thead>
                          <tr>
                            <th>A</th>
                            <th>Address</th>
                            <th>コメント</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>
                              <code class="literal">#$0000</code>
                            </td>
                            <td>
                              <code class="varname">$E6E3</code>
                            </td>
                            <td>コメントなし</td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0001</code>
                            </td>
                            <td>
                              <code class="varname">$E6E4</code>
                            </td>
                            <td>「ねっからの××××じゃのう」</td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0002</code>
                            </td>
                            <td>
                              <code class="varname">$E6F4</code>
                            </td>
                            <td>「なんという××××じゃ」</td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0003</code>
                            </td>
                            <td>
                              <code class="varname">$E704</code>
                            </td>
                            <td>「けっこう わらかしてくれるぞ」</td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0004</code>
                            </td>
                            <td>
                              <code class="varname">$E71C</code>
                            </td>
                            <td>「さすが××××性格だけのことはあるのう」</td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0005</code>
                            </td>
                            <td>
                              <code class="varname">$E726</code>
                            </td>
                            <td>「これも世の中がいけないからかの」</td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0006</code>
                            </td>
                            <td>
                              <code class="varname">$E744</code>
                            </td>
                            <td>「ちょっと大変そうな気もするが」</td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0007</code>
                            </td>
                            <td>
                              <code class="varname">$E762</code>
                            </td>
                            <td>「うけねらいかの？」</td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0008</code>
                            </td>
                            <td>
                              <code class="varname">$E77A</code>
                            </td>
                            <td>「天職ともいえるナイスチョイスじゃのう」</td>
                          </tr>
                          <tr>
                            <td>
                              <code class="literal">#$0009</code>
                            </td>
                            <td>
                              <code class="varname">$E784</code>
                            </td>
                            <td>「ずいぶん成長したものよのう」</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <br class="table-break" />
                </li>
                <li class="listitem">
                  <p>
			呼び出し元に制御を戻す。
		</p>
                </li>
              </ul>
            </div>
          </div>
          <div class="section">
            <div class="titlepage">
              <div>
                <div>
                  <h5 class="title"><a id="dq3.classchange.hack.C3E79C"></a>5.17.1.1.2. 「さとりのしょ」を消費するサブルーチン</h5>
                </div>
              </div>
            </div>
            <p>
	サブルーチン <code class="varname">$E79C</code> は必要に応じて、
	転職するキャラクターの所持品から「さとりのしょ」を一つだけ消費する。
</p>
            <div class="itemizedlist">
              <ul class="itemizedlist" style="list-style-type: disc; ">
                <li class="listitem">
                  <p>
			【事前条件】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<code class="varname">$33D6</code> == キャラクターのパーティでの並び順
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="varname">$33DC</code> == 新職業 ID
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			新職業 ID (<code class="varname">$33DC</code>) が「けんじゃ」のそれ (<code class="literal">#$0007</code>) と同じであるかをテストする。
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					異なる ⇒ 呼び出し元に制御を戻す。
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			<code class="code">A = $33D6;</code> 並び順
		</p>
                </li>
                <li class="listitem">
                  <p>
			キャラクター職業 ID 取得サブルーチン <code class="varname">$C46951</code> を呼び出し、
			パーティのキャラクター (<code class="varname">A</code>) の職業 ID を取得 (<code class="varname">A</code>) する。
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					転職前の職業 (<code class="varname">A</code>) が「あそびにん」(<code class="literal">#$0005</code>) ⇒ 呼び出し元に制御を戻す。
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			<code class="code">A = #$0088;</code> 「さとりのしょ」アイテム ID
		</p>
                </li>
                <li class="listitem">
                  <p>
			<code class="code">X = $33D6;</code> 並び順
		</p>
                </li>
                <li class="listitem">
                  <p>
			アイテムサブルーチン <code class="varname">$C44DC0</code> を呼び出し、
			アイテム (<code class="varname">A</code>) をパーティのキャラクター (<code class="varname">X</code>) が何番目に所持しているか (<code class="varname">A</code>) 調べる。
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					所持していない ⇒ 呼び出し元に制御を戻す。
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			アイテム削除サブルーチン <code class="varname">$C4487F</code> を呼び出し、
			キャラクター (<code class="varname">X</code>) の所持品から（<code class="varname">A</code> 番目の）アイテムを削除する。
		</p>
                </li>
              </ul>
            </div>
            <p>
「あそびにん」が「けんじゃ」に転職する場合、「さとりのしょ」を持ち物としてあっても消費されないことがわかる。
</p>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.classchange.hack.C3E7CC"></a>5.17.1.2. 装備品の交換</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$C3E7CC</code> は装備品の交換を行う処理だ。
	<code class="varname">A</code> レジスタの値を変えつつ、補助サブルーチンを呼び続ける。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			【事前条件】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<code class="varname">A</code> == 対象となる職業構造体データの格納アドレス
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					<code class="varname">X</code> == ??
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			<code class="code">$78 = A;</code> キャラクターアドレス
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">A = 0</code> としてから、<a class="link" href="dq3_classchange.html#dq3.classchange.hack.C3E7ED" title="5.17.1.2.1. ある装備種別に関して最適なものを調べる">サブルーチン <code class="varname">$E7ED</code></a> を呼び出して、最適な武器を装備させる。
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">A = 1</code> としてから、<a class="link" href="dq3_classchange.html#dq3.classchange.hack.C3E7ED" title="5.17.1.2.1. ある装備種別に関して最適なものを調べる">サブルーチン <code class="varname">$E7ED</code></a> を呼び出して、最適なよろいを装備させる。
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">A = 2</code> としてから、<a class="link" href="dq3_classchange.html#dq3.classchange.hack.C3E7ED" title="5.17.1.2.1. ある装備種別に関して最適なものを調べる">サブルーチン <code class="varname">$E7ED</code></a> を呼び出して、最適な盾を装備させる。
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">A = 3</code> としてから、<a class="link" href="dq3_classchange.html#dq3.classchange.hack.C3E7ED" title="5.17.1.2.1. ある装備種別に関して最適なものを調べる">サブルーチン <code class="varname">$E7ED</code></a> を呼び出して、最適なかぶとを装備させる。
		</p>
              </li>
              <li class="listitem">
                <p>
			呼び出し元に制御を戻す。
		</p>
              </li>
            </ul>
          </div>
          <div class="section">
            <div class="titlepage">
              <div>
                <div>
                  <h5 class="title"><a id="dq3.classchange.hack.C3E7ED"></a>5.17.1.2.1. ある装備種別に関して最適なものを調べる</h5>
                </div>
              </div>
            </div>
            <p>
	サブルーチン <code class="varname">$E7ED</code> は、転職キャラクターに最適な装備品を検索し、可能ならば装備させる処理である。
	まず、転職したいキャラクターの持ち物から、
	職業・性別・呪いを加味した上で、
	装備可能な道具をすべてチェックする。
	そのうち一番パラメータが上昇するものを検索する。
	次に、ふくろから同様に検索する。
	最後に、検索が成功していれば、その道具をそのキャラクターに装備させる、
	という処理である。
</p>
            <div class="itemizedlist">
              <ul class="itemizedlist" style="list-style-type: disc; ">
                <li class="listitem">
                  <p>
			【事前条件】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<code class="varname">$78</code> = キャラクターアドレス
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="varname">A</code> == アイテム種別 (<code class="literal">0,1,2,3</code>)
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			<code class="code">$2BB8 = A;</code> アイテム種別 (<code class="literal">0,1,2,3</code>)
		</p>
                </li>
                <li class="listitem">
                  <p>
			キャラクター所持品個数取得サブルーチン <code class="varname">$C446A4</code> を呼び出し、
			キャラクター (<code class="varname">$78</code>) の所持品個数を取得 (<code class="varname">A</code>) する。
		</p>
                </li>
                <li class="listitem">
                  <p>
			<code class="code">$2BB2 = A; $7A = A;</code> 所持品個数
		</p>
                </li>
                <li class="listitem">
                  <p>
			<code class="code">$2BBA = 0;</code> アイテムを装備品として見たときの、ステータス上昇値を格納するためのアドレスとなる。
		</p>
                </li>
                <li class="listitem">
                  <p>
			<code class="code">$2BBC = #$FFFF; $2BBE = #$FFFF;</code> それぞれアドレス差とアイテム ID を格納するためのアドレスとなる。
		</p>
                </li>
                <li class="listitem">
                  <p>
			キャラクター所持品個数取得サブルーチン <code class="varname">$C44708</code> を呼び出し、
			キャラクター (<code class="varname">$78</code>) の最初の所持品が格納されているアドレスを取得 (<code class="varname">Y</code>) する。
		</p>
                </li>
                <li class="listitem">
                  <p>
			<code class="code">$2BB6 = Y - 1;</code> キャラクターの最初の所持品が格納されているアドレス
		</p>
                </li>
                <li class="listitem">
                  <p>
			【キャラクターの所持品を調べる】
		</p>
                  <p>
			<code class="varname">$7A</code> をループカウンターとして、キャラクターの持っている道具を調べる。
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<code class="code">X = $0000,Y &amp; 00FFh;</code> キャラクターの所持品アイテム ID
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					アイテム種別取得サブルーチン <code class="varname">$C44FE2</code> を呼び出し、
					アイテム (<code class="varname">X</code>) の種別を取得 (<code class="varname">A</code>) する。
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							<code class="code">A != $2BB8</code> ⇒ ループを continue する。
						</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li class="listitem">
                        <p>
					アイテム呪い属性取得サブルーチン <code class="varname">$C4508A</code> を呼び出し、
					アイテム (<code class="varname">X</code>) が呪われているかどうか (<code class="varname">Carry</code>) を調べる。
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							呪われている ⇒ ループを continue する。
						</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li class="listitem">
                        <p>
					キャラクター装備後パラメータ計算サブルーチン <code class="varname">$C44A72</code> を呼び出し、
					キャラクターが装備品を装備した場合のパラメータを取得する。
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							パラメータが <code class="varname">$2BBA</code> <span class="emphasis"><em>以下</em></span> ⇒ ループを continue する。
						</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="code">$2BBA = A;</code> パラメータ上昇値
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="code">$2BBC = Y - $2BB6;</code> そのアイテムの <code class="varname">$2BB6</code> 基準のアドレスオフセット
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="code">$2BBE = X;</code> そのアイテムのアイテム ID
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			【所持品調査終了】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					キャラクターの所持品個数 (<code class="varname">$2BB2</code>) をチェックする。
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							<code class="code">$2BB2 == 12</code> ⇒【<code class="varname">$2BBC</code> テスト】へジャンプ。
						</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="code">$2BB4 = 0;</code> 候補アイテム個数カウンター
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="code">Y = #$FFFF;</code> ふくろ走査カウンター
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			【ふくろの中身を調べる】
		</p>
                  <p><code class="varname">Y</code> = <code class="literal">0</code> から <code class="literal">255</code> まで、ふくろの道具を調べる。</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<code class="code">A = $3825,Y &amp; #$00FF;</code> アイテム<code class="code">[Y]</code> の個数
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							<code class="code">A == 0</code> ⇒【ふくろ調査終了】へジャンプ。
						</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="code">X = $3725,Y &amp; #$00FF;</code> アイテム<code class="code">[Y]</code> のアイテム ID
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					アイテム種別取得サブルーチン <code class="varname">$C44FE2</code> を呼び出し、
					アイテム (<code class="varname">X</code>) の種別を取得 (<code class="varname">A</code>) する。
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							<code class="code">A != $2BB8</code> ⇒ ループを continue する。
						</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li class="listitem">
                        <p>
					アイテム呪い属性取得サブルーチン <code class="varname">$C4508A</code> を呼び出し、
					アイテム (<code class="varname">X</code>) が呪われているかどうか (<code class="varname">Carry</code>) を調べる。
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							呪われている ⇒ ループを continue する。
						</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li class="listitem">
                        <p>
					キャラクター装備後パラメータ計算サブルーチン <code class="varname">$C44A72</code> を呼び出し、
					キャラクターが装備品を装備した場合のパラメータを取得する。
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							呪われているか、パラメータ値が <code class="varname">$2BBA</code> <span class="emphasis"><em>以下</em></span> ⇒ ループを continue する。
						</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="code">$2BBA = A;</code> パラメータ上昇値
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="code">$2BBC = Y - $2BB6;</code> そのアイテムの <code class="varname">$2BB6</code> 基準のアドレスオフセット
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="code">$2BBE = X;</code> そのアイテムのアイテム ID
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="code">++$2BB4</code>
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			【ふくろ調査終了】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<code class="varname">$2BB4</code> をチェックする。
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							<code class="code">$2BB4 == 0</code> ⇒【<code class="varname">$2BBC</code> テスト】へジャンプ。
						</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="code">A = $2BBE;</code> パラメータ上昇が最も大きい装備可能アイテムのアイテム ID
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					道具袋アイテム減らしサブルーチン <code class="varname">$C453F7</code> を呼び出し、
					道具袋に入っているアイテム (<code class="varname">A</code>) の個数を <code class="literal">1</code> だけ減らす。
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					キャラクター持ち物変更サブルーチン <code class="varname">$C44739</code> を呼び出し、
					キャラクター (<code class="varname">$78</code>) の持ち物にアイテム (<code class="varname">A</code>) を追加し、配列を並び替える。
				</p>
                      </li>
                      <li class="listitem">
                        <p>
					<code class="varname">$2BBC</code> = キャラクターの持ち物<code class="code">[0]</code> アドレスからのオフセット;
					装備させたいアイテムを格納しているアドレス
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			【<code class="varname">$2BBC</code> テスト】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					<code class="varname">$2BBC</code> を調べる。
				</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist" style="list-style-type: square; ">
                            <li class="listitem">
                              <p>
							<code class="code">$2BBC &lt; 0</code> ⇒【終了】へジャンプ。
						</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li class="listitem">
                        <p>
					キャラクター装備変更サブルーチン <code class="varname">$C44C1B</code> を呼び出し、
					キャラクター (<code class="varname">$78</code>) にアイテム (<code class="varname">A</code>) を装備させる。
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p>
			【終了】
		</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                      <li class="listitem">
                        <p>
					呼び出し元に制御を戻す。
				</p>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="navigation"><hr /><table><tr><td class="online-navigation"><a href="dq3_bank.html" title="5.16. ゴールド銀行解析"><img src="image/docbook/prev.png" alt="戻る" /></a></td><td class="online-navigation"><a href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)"><img src="image/docbook/up.png" alt="上に戻る" /></a></td><td class="online-navigation"><a href="dq3_rename.html" title="5.18. 命名神解析"><img src="image/docbook/next.png" alt="次へ" /></a></td><td>ドラクエ命</td><td class="online-navigation"><a href="index.html" title="ドラクエ命"><img src="image/docbook/home.png" alt="ホーム" /></a></td><td class="online-navigation"><a href="" title=""><img src="image/docbook/index.png" alt="索引" /></a></td></tr></table><b class="navlabel">Previous: </b><a accesskey="p" class="sectref" href="dq3_bank.html">5.16. ゴールド銀行解析</a> <b class="navlabel">Up: </b><a accesskey="u" class="sectref" href="dq3.html">第 5 章 SFC 版ドラクエ 3 (1996)</a> <b class="navlabel">Next: </b><a accesskey="n" class="sectref" href="dq3_rename.html">5.18. 命名神解析</a></div>
  </body>
</html>
