<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>3.9. 戦闘コマンド</title>
    <link rel="stylesheet" type="text/css" href="dqbook.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="home" href="index.html" title="ドラクエ命" />
    <link rel="up" href="dq5.html" title="第 3 章 SFC 版ドラクエ 5 (1992)" />
    <link rel="prev" href="dq5_window.html" title="3.8. ウィンドウ" />
    <link rel="next" href="dq5_shop.html" title="3.10. 店屋" />
  </head>
  <body>
    <div class="navigation"><table><tr><td class="online-navigation"><a href="dq5_window.html" title="3.8. ウィンドウ"><img src="image/docbook/prev.png" alt="戻る" /></a></td><td class="online-navigation"><a href="dq5.html" title="第 3 章 SFC 版ドラクエ 5 (1992)"><img src="image/docbook/up.png" alt="上に戻る" /></a></td><td class="online-navigation"><a href="dq5_shop.html" title="3.10. 店屋"><img src="image/docbook/next.png" alt="次へ" /></a></td><td>ドラクエ命</td><td class="online-navigation"><a href="index.html" title="ドラクエ命"><img src="image/docbook/home.png" alt="ホーム" /></a></td><td class="online-navigation"><a href="" title=""><img src="image/docbook/index.png" alt="索引" /></a></td></tr></table><b class="navlabel">Previous: </b><a accesskey="p" class="sectref" href="dq5_window.html">3.8. ウィンドウ</a> <b class="navlabel">Up: </b><a accesskey="u" class="sectref" href="dq5.html">第 3 章 SFC 版ドラクエ 5 (1992)</a> <b class="navlabel">Next: </b><a accesskey="n" class="sectref" href="dq5_shop.html">3.10. 店屋</a><hr /></div>
    <div class="section">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a id="dq5.battle.commands"></a>3.9. 戦闘コマンド</h2>
          </div>
        </div>
      </div>
      <div class="toc">
        <dl class="toc">
          <dt>
            <span class="section">
              <a href="dq5_battle_commands.html#dq5.battle.commands.classification">3.9.1. 戦闘コマンドを分類する</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="dq5_battle_commands.html#dq5.battle.commands.guard">3.9.2. 防御系のコマンド</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="dq5_battle_commands.html#dq5.battle.commands.general">3.9.3. 一般のコマンド</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="dq5_battle_commands.html#dq5.battle.commands.general.name">3.9.3.1. 名前</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq5_battle_commands.html#dq5.battle.commands.general.evaluate">3.9.3.2. 数値の変化量を評価するコード</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq5_battle_commands.html#dq5.battle.commands.general.message">3.9.3.3. 実行時に表示するメッセージ</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq5_battle_commands.html#dq5.battle.commands.general.mp">3.9.3.4. 必要 MP</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq5_battle_commands.html#dq5.battle.commands.general.scope">3.9.3.5. 有効範囲</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq5_battle_commands.html#dq5.battle.commands.general.hostile">3.9.3.6. 目標が敵側に作用するものかどうかのフラグ</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq5_battle_commands.html#dq5.battle.commands.general.execute">3.9.3.7. 実行コード</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="section">
              <a href="dq5_battle_commands.html#dq5.battle.commands.equip">3.9.4. 装備を変更するコマンド</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="dq5_battle_commands.html#dq5.battle.commands.use">3.9.5. 道具を使用するコマンド</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="dq5_battle_commands.html#dq5.battle.commands.use.item">3.9.5.1. アイテム</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq5_battle_commands.html#dq5.battle.commands.use.execute">3.9.5.2. 実行コード</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="section">
              <a href="dq5_battle_commands.html#dq5.battle.commands.data">3.9.6. データ</a>
            </span>
          </dt>
        </dl>
      </div>
      <p>
この節では戦闘コマンドについて述べる。
戦闘コマンドとは、戦闘中の一ターン内において、敵や味方それぞれに対する命令をカプセル化した概念だと定義する。
プログラムコードの観点では、戦闘中に配列 <code class="varname">$1073</code> などに格納される 1 バイトの値を ID とする何らかの配列要素を戦闘コマンドと表現していると解釈する。
</p>
      <p>
本節では最初に実際のプログラムコードに沿う形で戦闘コマンドの分類を行う。
戦闘コマンドと関連性のあるデータについても併せて見ていく。
それから、戦闘コマンド分類のそれぞれについて、付随するモデルの物理的構造やコードの挙動を検討していく。
最後に、コードを分析して得た戦闘コマンドデータを CSV 形式のテキストファイルで提供する。
</p>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="dq5.battle.commands.classification"></a>3.9.1. 戦闘コマンドを分類する</h3>
            </div>
          </div>
        </div>
        <p>
戦闘コマンドを理解するには、配列 <code class="varname">$1037</code> と配列 <code class="varname">$1073</code> について理解する必要がある。
まずはこれらの配列について説明する。
</p>
        <p>
配列 <code class="varname">$1037</code> は次の構造の 1 バイト型データを要素とするものだ：
</p>
        <div class="table">
          <a id="table.dq5.battle.commands.1037"></a>
          <p class="title">
            <strong>表 3.24 構造体 $1037: 戦闘コマンド情報</strong>
          </p>
          <div class="table-contents">
            <table id="table.dq5.battle.commands.1037" class="lighttable">
              <thead>
                <tr>
                  <th>桁</th>
                  <th>意味</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <code class="literal">#$03</code>
                  </td>
                  <td>戦闘コマンド種別</td>
                </tr>
                <tr>
                  <td>
                    <code class="literal">#$7C</code>
                  </td>
                  <td>戦闘コマンドの相手のインデックス</td>
                </tr>
                <tr>
                  <td>
                    <code class="literal">#$80</code>
                  </td>
                  <td>戦闘コマンドの相手が敵側かどうか</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <br class="table-break" />
        <p>
本節では、戦闘コマンド情報構造体の下位 2 ビットの値で戦闘コマンドを分類する。
戦闘処理のコードを解析すると、次のように分類するのが妥当なように思える：
</p>
        <div class="table">
          <a id="table.dq5.battle.commands.kind"></a>
          <p class="title">
            <strong>表 3.25 戦闘コマンド種別</strong>
          </p>
          <div class="table-contents">
            <table id="table.dq5.battle.commands.kind" class="lighttable">
              <thead>
                <tr>
                  <th>値</th>
                  <th>意味</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>0</td>
                  <td>防御系</td>
                </tr>
                <tr>
                  <td>1</td>
                  <td>一般</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>装備変更</td>
                </tr>
                <tr>
                  <td>3</td>
                  <td>道具使用</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <br class="table-break" />
        <p>
さらに、この戦闘コマンド情報配列と一対一対応する配列がアドレス <code class="varname">$1073</code> にあり、
こちらには戦闘コマンドを示す 1 バイトの値を格納する。
戦闘コマンド情報配列と戦闘コマンド配列は両方とも、プレイヤー側馬車外のキャラクター群と
敵側パーティーのキャラクター群の関連情報を保持するのに十分な長さがある。
</p>
        <p>
例えば、自陣側の馬車外メンバーが主人公、スラリンの 2 名で、敵陣がメタルスライム 3 匹 だとしよう。
このときのキャラクター、コマンド情報のアドレス、そしてコマンドのアドレスの対応関係は次のようになる：
</p>
        <table border="0" summary="Simple list" class="simplelist">
          <tr>
            <td>
              <code class="varname">主人公</code>
            </td>
            <td>
              <code class="varname">$1037</code>
            </td>
            <td>
              <code class="varname">$1073</code>
            </td>
          </tr>
          <tr>
            <td>
              <code class="varname">スラリン</code>
            </td>
            <td>
              <code class="varname">$1038</code>
            </td>
            <td>
              <code class="varname">$1074</code>
            </td>
          </tr>
          <tr>
            <td>
              <code class="varname">メタルスライムＡ</code>
            </td>
            <td>
              <code class="varname">$1039</code>
            </td>
            <td>
              <code class="varname">$1075</code>
            </td>
          </tr>
          <tr>
            <td>
              <code class="varname">メタルスライムＢ</code>
            </td>
            <td>
              <code class="varname">$103A</code>
            </td>
            <td>
              <code class="varname">$1076</code>
            </td>
          </tr>
          <tr>
            <td>
              <code class="varname">メタルスライムＣ</code>
            </td>
            <td>
              <code class="varname">$103B</code>
            </td>
            <td>
              <code class="varname">$1077</code>
            </td>
          </tr>
        </table>
        <p>
実は本節での配列の説明は、戦闘コマンド自身を理解し易くするためにかなり簡略化してある。
配列の有効性やコマンド連続実行時の挙動等、言及しなかった事実があることを断っておく。
</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="dq5.battle.commands.guard"></a>3.9.2. 防御系のコマンド</h3>
            </div>
          </div>
        </div>
        <p>
種別が 0 の戦闘コマンドは、一般コマンドの意味で防御系のコマンドをとることが必要のようだ：
</p>
        <pre class="programlisting">
20/8862:    20809F      JSR $9F80           ; $1073,X に戦闘コマンドをセット
20/8865:    C900        CMP #$00
20/8867:    F039        BEQ $88A2
20/8869:    C971        CMP #$71            ; みをまもる１
20/886B:    F02F        BEQ $889C
20/886D:    C972        CMP #$72            ; みをまもる２
20/886F:    F02B        BEQ $889C
20/8871:    C9AC        CMP #$AC            ; 防御中に同種の仲間が登場
20/8873:    F027        BEQ $889C

20/889C:    A900        LDA #$00            ; 戦闘コマンド情報構造体
20/889E:    206B9F      JSR $9F6B           ; $1037,X に戦闘コマンド情報をセット
20/88A1:    60          RTS
</pre>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="dq5.battle.commands.general"></a>3.9.3. 一般のコマンド</h3>
            </div>
          </div>
        </div>
        <p>
種別が 1 の戦闘コマンドには次に挙げる性質、属性がある：
</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem">
              <p>名前</p>
            </li>
            <li class="listitem">
              <p>数値の変化量を評価するコード</p>
            </li>
            <li class="listitem">
              <p>実行時に表示するメッセージ</p>
            </li>
            <li class="listitem">
              <p>必要 MP</p>
            </li>
            <li class="listitem">
              <p>有効範囲</p>
            </li>
            <li class="listitem">
              <p>目標が敵側に作用するものかどうかのフラグ</p>
            </li>
            <li class="listitem">
              <p>実行コード</p>
            </li>
          </ul>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq5.battle.commands.general.name"></a>3.9.3.1. 名前</h4>
              </div>
            </div>
          </div>
          <p>
一般の戦闘コマンドの大半は、ウィンドウのテキスト表示処理に利用できる名前文字列と対応付けられている。
実体はアドレス <code class="varname">$228000</code> にある文字列だが、
<a class="xref" href="dq5_accessor.html#dq5.accessor.specification.functions" title="3.3.3.1. 機能表">3.3.3.1 機能表</a> のキー <code class="literal">#$2B</code> の参照機能を引き起こす
BRK 命令を実行することで、戦闘コマンドの名前にアクセスする。
</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq5.battle.commands.general.evaluate"></a>3.9.3.2. 数値の変化量を評価するコード</h4>
              </div>
            </div>
          </div>
          <p>
何らかのパラメーターを増加または減少するコマンドは、その変化量を評価するためのサブルーチンを必要とする。
そのサブルーチンのアドレスはジャンプテーブル <code class="varname">$20B7F9</code> で定義されていて、
対応するサブルーチンアドレスがあるテーブル列の ID は、戦闘コマンドのそれと一致している。
</p>
          <p>
変化評価を必要としないような戦闘コマンドには、空サブルーチンのアドレスが割り当てられている。
</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq5.battle.commands.general.message"></a>3.9.3.3. 実行時に表示するメッセージ</h4>
              </div>
            </div>
          </div>
          <p>
戦闘コマンドの実行直後には、画面中央下のメッセージウィンドウに臨場感豊かな文言が出力される。
各戦闘コマンドはそのような戦闘メッセージの ID を一つ有する。
このメッセージ ID は配列 <code class="varname">$268565</code> の要素として定義されていて、
配列のインデックスとコマンドの ID が対応している。
</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq5.battle.commands.general.mp"></a>3.9.3.4. 必要 MP</h4>
              </div>
            </div>
          </div>
          <p>
戦闘コマンドを実行するために、実行者の MP を消費する必要があるものが多い。
この情報が配列 <code class="varname">$268765</code> で定義されている。
これは 1 バイトの値を要素とする配列なのだが、MP 情報は <code class="literal">#$1F</code> 部分のビットで定義されている。
そして、配列のインデックスはコマンドの ID と対応している。
</p>
          <p>
さらに、特殊な MP 消費をするコマンドのために、一部はプログラムで消費量を上書きする：
</p>
          <pre class="programlisting">
26/83A1:    BF658726    LDA $268765,X
26/83A5:    291F        AND #$1F            ; 必要 MP
26/83A7:    C91F        CMP #$1F
26/83A9:    F01D        BEQ $83C8           if(MP != 0x1F){
26/83AB:    C91E        CMP #$1E
26/83AD:    D004        BNE $83B3               if(MP == 0x1E){
26/83AF:    A924        LDA #$24                    MP = 36d
26/83B1:    8006        BRA $83B9               }
26/83B3:    C91D        CMP #$1D
26/83B5:    D002        BNE $83B9               else if(AL == 0x1D){
26/83B7:    A9FF        LDA #$FF                    MP = 255d
                                                }
26/83B9:    2C1610      BIT $1016
26/83BC:    C210        REP #$10
26/83BE:    5004        BVC $83C4               ; このあたりの処理は
26/83C0:    0A          ASL A                   ; パルプンテのはやぶさ効果を
26/83C1:    9001        BCC $83C4               ; 考慮するものゆえ
26/83C3:    6A          ROR A                   ; 今は議論しない
26/83C4:    FA          PLX
                                            }
26/83C8:    A900        LDA #$00            ; 消費なし
</pre>
          <p>
このコードの解析によると、マジックナンバーがかなり多いことがわかる。
全ビットがオン、つまり MP が 31 ならばそれは呪文コマンドではないという取り扱いになるようだ。
ベホマズンに対応する消費 MP <code class="literal">#$1E</code> は 36 ポイントに変更する。
さらにメガザルに対応する消費 MP <code class="literal">#$1D</code> は 255 ポイントに変更する。
ここには表れていないが、値 <code class="literal">#$FF</code> もまた「現在の MP の残り全て」を表現するマジックナンバーだろう。
</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq5.battle.commands.general.scope"></a>3.9.3.5. 有効範囲</h4>
              </div>
            </div>
          </div>
          <p>
戦闘コマンドの有効範囲とは、次の表に示す区分のことだ。
</p>
          <div class="table">
            <a id="table.dq5.battle.commands.scope"></a>
            <p class="title">
              <strong>表 3.26 戦闘コマンド有効範囲</strong>
            </p>
            <div class="table-contents">
              <table id="table.dq5.battle.commands.scope" class="lighttable">
                <thead>
                  <tr>
                    <th>値</th>
                    <th>意味</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>0</td>
                    <td>その他</td>
                  </tr>
                  <tr>
                    <td>1</td>
                    <td>単体</td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>グループ</td>
                  </tr>
                  <tr>
                    <td>3</td>
                    <td>全体</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p>
この情報も配列 <code class="varname">$268765</code> で定義されている。
各バイトの <code class="literal">#$60</code> 部分のビットを占める。
</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq5.battle.commands.general.hostile"></a>3.9.3.6. 目標が敵側に作用するものかどうかのフラグ</h4>
              </div>
            </div>
          </div>
          <p>
例えば「メラゾーマ」は敵の誰かに作用するコマンドであるが、「ザオラル」はそうではない。
この情報も配列 <code class="varname">$268765</code> で定義されている。
各バイトの <code class="literal">#$80</code> 部分のビットを占める。
</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq5.battle.commands.general.execute"></a>3.9.3.7. 実行コード</h4>
              </div>
            </div>
          </div>
          <p>
戦闘コマンドを実行するサブルーチンのアドレスは配列 <code class="varname">$268865</code> で定義されている。
配列のインデックスはコマンドの ID と対応している。
</p>
          <p>
ちなみに、この配列は論理的にはジャンプテーブルであるはずなのだが、サブルーチンの呼び出し方が変則的だ。
所定の変数にアドレス値をロードし、直接 JSR する。
</p>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="dq5.battle.commands.equip"></a>3.9.4. 装備を変更するコマンド</h3>
            </div>
          </div>
        </div>
        <p>
種別が 2 の戦闘コマンドとは、プレイヤーの通常の入力操作において次の条件を満たす、味方側キャラクター限定のものをいう：
</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem">
              <p>指定キャラクターのコマンド選択ウィンドウで「どうぐ」を選択した</p>
            </li>
            <li class="listitem">
              <p>どうぐウィンドウで選択した物のアイテム種別が武器である</p>
            </li>
            <li class="listitem">
              <p>指定キャラクターがその武器を装備することが可能である</p>
            </li>
            <li class="listitem">
              <p>「つかう・そうび」ウィンドウで「そうび」を選択した</p>
            </li>
          </ul>
        </div>
        <p>
言い換えると、キャラクターが武器の装備を変更して、さらに直接攻撃をするという流れを生じるコマンドを意味する。
この定義から、武器でないアイテムが関わるどのようなコマンドも、ここで議論するものには該当しないことを意味する。
例えば「ほしふるうでわ」を選択すると、そのターンで実際にそれを装備するが、これは種別 2 のコマンドではない。
後述する種別 3 のコマンドに分類される。
</p>
        <p>
実際には、戦闘コマンド情報を評価するタイミングで次のような操作を施す：
</p>
        <div class="orderedlist">
          <ol class="orderedlist" type="1">
            <li class="listitem">
              <p>
      現在装備している武器があれば、それを外す。
      これに伴って、対象キャラクターの攻撃力と守備力を再評価する。
    </p>
            </li>
            <li class="listitem">
              <p>
      選択したアイテムを装備する。
      やはり対象キャラクターの攻撃力と守備力を再評価する。
    </p>
            </li>
            <li class="listitem">
              <p>
      戦闘コマンドとコマンド種別を「こうげき」コマンドと一般コマンドにそれぞれ置き換える。
      この際、装備を変更したことを示すメッセージを表示する（下記コード片参照）。
    </p>
            </li>
          </ol>
        </div>
        <pre class="programlisting">
20/8583:    A973        LDA #$73            ; 「こうげき」
20/8585:    8DF710      STA $10F7           ; 戦闘コマンド ID
20/8588:    20809F      JSR $9F80           ; コマンドキャラクターの戦闘コマンド ID を設定
20/858B:    20419F      JSR $9F41           ; コマンドキャラクターの戦闘コマンド情報を参照
20/858E:    29FC        AND #$FC
20/8590:    0901        ORA #$01            ; 種別 1: 一般コマンド
20/8592:    206B9F      JSR $9F6B           ; コマンドキャラクターの戦闘コマンド情報を設定
20/8595:    20DF9E      JSR $9EDF           ; コマンドキャラクターを参照
20/8598:    85F5        STA $F5
20/859A:    85F7        STA $F7
20/859C:    00A1        BRK #$A1            ; message #$0028: [F7]は ぶきを [F5]にもちかえた！
20/859E:    28
20/859F:    20D69D      JSR $9DD6           ; 待ち
20/85A2:    ADF710      LDA $10F7           ; 戦闘コマンド ID
20/85A5:    82A6FE      BRL $844E           ; （戦闘コマンド ID による分岐）
</pre>
        <p>
なお、戦闘コマンド ID を収める変数には、
そこに「こうげき」を示す値 <code class="literal">#$73</code> が入るまでは新しく装備する武器のアイテム ID が収められていた。
</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="dq5.battle.commands.use"></a>3.9.5. 道具を使用するコマンド</h3>
            </div>
          </div>
        </div>
        <p>
種別 3 の戦闘コマンドとは、味方側キャラクターに限定された、道具に関する戦闘コマンドを意味する。
先に述べたように、実行時のメッセージに「そうびした！」とあっても、実質的にはこちらの種別になるコマンドが普通にある。
</p>
        <p>
種別が 3 の戦闘コマンドには次に挙げる性質、属性がある：
</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem">
              <p>アイテム</p>
            </li>
            <li class="listitem">
              <p>実行コード</p>
            </li>
          </ul>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq5.battle.commands.use.item"></a>3.9.5.1. アイテム</h4>
              </div>
            </div>
          </div>
          <p>
戦闘コマンド ID はアイテム ID でもあるので、処理コードはアイテムの属性をすべて参照することが可能だ。
例えば、コマンド処理中にアイテムが消耗品であるかどうかを知る必要がある。
アイテムについては <a class="xref" href="dq5_item.html" title="3.13. アイテム">3.13 アイテム</a> で議論する。
</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq5.battle.commands.use.execute"></a>3.9.5.2. 実行コード</h4>
              </div>
            </div>
          </div>
          <p>
実行コードはサブルーチンで実装されている。ジャンプテーブルはアドレス <code class="varname">$20C162</code> にあるのだが、
このテーブルの行番号は戦闘コマンド ID すなわちアイテム ID とは一致していない。
アイテム ID から行番号への対応表がアドレス <code class="varname">$27819A</code> にあり、これを用いて変換する。
たいていのアイテムは「しかし なにも おこらなかった」というメッセージ表示しか引き起こさないので、
それ以外の戦闘コマンドに対してしか意味のある実行コードを用意しなくて済むようにこのような構造になっている。
</p>
          <p>
使用コマンドが何らかの固有処理を有する場合には、その処理コードを特定した直後に、
そのアイテムを消費するかどうかを判定し、消耗品であれば実際にキャラクターの持ち物袋からそれを一つだけ削除する。
その後に固有処理をするサブルーチンを呼び出す。
</p>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="dq5.battle.commands.data"></a>3.9.6. データ</h3>
            </div>
          </div>
        </div>
        <p>
戦闘コマンドデータを CSV で表現したファイルを <a class="xref" href="appendix_b.html" title="付録 B データ">付録 B <em>データ</em></a> から参照できる。
本節で述べた複数の配列とテーブルを水平に結合したり、コメント欄を付加してあったりするので利用者は注意して欲しい。
</p>
      </div>
    </div>
    <div class="navigation"><hr /><table><tr><td class="online-navigation"><a href="dq5_window.html" title="3.8. ウィンドウ"><img src="image/docbook/prev.png" alt="戻る" /></a></td><td class="online-navigation"><a href="dq5.html" title="第 3 章 SFC 版ドラクエ 5 (1992)"><img src="image/docbook/up.png" alt="上に戻る" /></a></td><td class="online-navigation"><a href="dq5_shop.html" title="3.10. 店屋"><img src="image/docbook/next.png" alt="次へ" /></a></td><td>ドラクエ命</td><td class="online-navigation"><a href="index.html" title="ドラクエ命"><img src="image/docbook/home.png" alt="ホーム" /></a></td><td class="online-navigation"><a href="" title=""><img src="image/docbook/index.png" alt="索引" /></a></td></tr></table><b class="navlabel">Previous: </b><a accesskey="p" class="sectref" href="dq5_window.html">3.8. ウィンドウ</a> <b class="navlabel">Up: </b><a accesskey="u" class="sectref" href="dq5.html">第 3 章 SFC 版ドラクエ 5 (1992)</a> <b class="navlabel">Next: </b><a accesskey="n" class="sectref" href="dq5_shop.html">3.10. 店屋</a></div>
  </body>
</html>
