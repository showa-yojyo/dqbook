<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>5.13. 教会解析</title>
    <link rel="stylesheet" type="text/css" href="dqbook.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1" />
    <link rel="home" href="index.html" title="ドラクエ命" />
    <link rel="up" href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)" />
    <link rel="prev" href="dq3_inn.html" title="5.12. 宿屋解析" />
    <link rel="next" href="dq3_pub.html" title="5.14. ルイーダの酒場解析" />
  </head>
  <body>
    <div class="navigation"><table><tr><td class="online-navigation"><a href="dq3_inn.html" title="5.12. 宿屋解析"><img src="image/docbook/prev.png" alt="戻る" /></a></td><td class="online-navigation"><a href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)"><img src="image/docbook/up.png" alt="上に戻る" /></a></td><td class="online-navigation"><a href="dq3_pub.html" title="5.14. ルイーダの酒場解析"><img src="image/docbook/next.png" alt="次へ" /></a></td><td>ドラクエ命</td><td class="online-navigation"><a href="index.html" title="ドラクエ命"><img src="image/docbook/home.png" alt="ホーム" /></a></td><td class="online-navigation"><a href="" title=""><img src="image/docbook/index.png" alt="索引" /></a></td></tr></table><b class="navlabel">Previous: </b><a accesskey="p" class="sectref" href="dq3_inn.html">5.12. 宿屋解析</a> <b class="navlabel">Up: </b><a accesskey="u" class="sectref" href="dq3.html">第 5 章 SFC 版ドラクエ 3 (1996)</a> <b class="navlabel">Next: </b><a accesskey="n" class="sectref" href="dq3_pub.html">5.14. ルイーダの酒場解析</a><hr /></div>
    <div class="section">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a id="dq3.church"></a>5.13. 教会解析</h2>
          </div>
        </div>
      </div>
      <div class="toc">
        <dl class="toc">
          <dt>
            <span class="section">
              <a href="dq3_church.html#dq3.church.hack">5.13.1. 解析</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="dq3_church.html#dq3.church.hack.C3D466">5.13.1.1. 教会処理神父バージョン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_church.html#dq3.church.hack.C3D481">5.13.1.2. 教会処理シスターバージョン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_church.html#dq3.church.hack.C3D49C">5.13.1.3. 教会処理共通サブルーチン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_church.html#dq3.church.hack.C3D554">5.13.1.4. 「いきかえらせる」サブルーチン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_church.html#dq3.church.hack.C3D5DD">5.13.1.5. 「どくのちりょう」サブルーチン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_church.html#dq3.church.hack.C3D64A">5.13.1.6. 「のろいをとく」サブルーチン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_church.html#dq3.church.hack.C3D6B7">5.13.1.7. 「寄付をよろしいかな」サブルーチン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_church.html#dq3.church.hack.C3D700">5.13.1.8. 「いきかえらせる」- 寄付金計算サブルーチン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_church.html#dq3.church.hack.C3D733">5.13.1.9. 「のろいをとく」- 寄付金計算サブルーチン</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="dq3_church.html#dq3.church.hack.C3D74C">5.13.1.10. 「どくのちりょう」- 寄付金計算サブルーチン</a>
                </span>
              </dt>
            </dl>
          </dd>
        </dl>
      </div>
      <a id="term.dq3.church" class="indexterm"></a>
      <p>
	教会にいる神父や（SFC 版ドラクエ 3 では稀だが）シスターに「はなす」ときのプログラムを解析する。
	教会の仕事は仲間パーティーの状態異常を回復するという、非常にわかりやすいものだ。
	そんなプログラムを解析する意味などあるのかと思われるかもしれないが、
	ドラクエの基本処理はやはりおさえておきたい。
</p>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="dq3.church.hack"></a>5.13.1. 解析</h3>
            </div>
          </div>
        </div>
        <p>
	「はなす」対象が神父であるかシスターであるかによらず、同じサブルーチンを呼び出すことで彼らの仕事を実現している。
	唯一の違いは、ウィンドウに表示する台詞が異なるだけである。
	台詞表示サブルーチンは、<code class="varname">A</code> レジスタの値をメッセージ ID として処理する <code class="varname">$C1A95A</code> を用いる。
</p>
        <pre class="programlisting">
C3/D50C:    DC0A    ; [D6]たのもしき 神のしもべよ[AD]わが教会に
C3/D50E:    EE0A    ; [D6]ここは 神にみちびかれし[AD]迷える小羊たちの

C3/D510:    DE0A    ; [D6]どなたを この世へ[AD]呼びもどすのじゃな？[AF]
C3/D512:    F00A    ; [D6]どなたを 生きかえらせて[AD]ほしいのですか？[AF]

C3/D514:    DF0A    ; [D6]ごじょうだんを。[C0]どのは[AD]生きていらっしゃる！[AF]
C3/D516:    F10A    ; [D6]あら？ [C0]さんは[AD]生きていますわ。[AF]
</pre>
        <p>
	こういう具合に、神父とシスターの同じ状況に話す台詞 ID が交互に配列されてある。
	そのために、教会処理の先頭で <code class="varname">X</code> レジスタの値を固定しておき、
	サブルーチン <code class="varname">$C1A95A</code> を呼び出すときには、
	常にその直前に <code class="code">LDA addr,x</code> 命令で表示直前に ID を変える。
	以下の説明で引用する台詞は、特に断らない限り神父のものを使う。
</p>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.church.hack.C3D466"></a>5.13.1.1. 教会処理神父バージョン</h4>
              </div>
            </div>
          </div>
          <p>
	教会にいる神父に「はなす」ときになされる通常の処理は、
	サブルーチン <code class="varname">$C3D466</code> である。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			<code class="varname">A</code> レジスタに <code class="literal">0000h</code> をロードする。
		</p>
              </li>
              <li class="listitem">
                <p>
			<a class="link" href="dq3_church.html#dq3.church.hack.C3D49C" title="5.13.1.3. 教会処理共通サブルーチン">教会処理共通サブルーチン</a>を呼び出す。
		</p>
              </li>
              <li class="listitem">
                <p>
			サブルーチン呼び出し元へ制御を戻す。
		</p>
              </li>
            </ul>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.church.hack.C3D481"></a>5.13.1.2. 教会処理シスターバージョン</h4>
              </div>
            </div>
          </div>
          <p>
	教会にいるシスターに「はなす」ときになされる通常の処理は、
	サブルーチン <code class="varname">$C3D481</code> である。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			<code class="varname">A</code> レジスタに <code class="literal">0002h</code> をロードする。
		</p>
              </li>
              <li class="listitem">
                <p>
			<a class="link" href="dq3_church.html#dq3.church.hack.C3D49C" title="5.13.1.3. 教会処理共通サブルーチン">教会処理共通サブルーチン</a>を呼び出す。
		</p>
              </li>
              <li class="listitem">
                <p>
			サブルーチン呼び出し元へ制御を戻す。
		</p>
              </li>
            </ul>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.church.hack.C3D49C"></a>5.13.1.3. 教会処理共通サブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$C3D49C</code> は、神父とシスターのおつとめ処理の実装だ。
	呼び出し前に <code class="varname">A</code> レジスタに「表示台詞タイプ」をロードしておくのが事前条件になっている。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			<code class="code">X = A</code> とする。これは上述の台詞表示のための対応である。
		</p>
              </li>
              <li class="listitem">
                <p>
			汎用サブルーチン <code class="varname">$C79190</code> を呼び出すことで昼夜チェックを行う。
			それにより「はなす」による最初のあいさつを変えて表示する。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					夜ならば <code class="code">A = $C3D550,X</code>
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					昼ならば <code class="code">A = $C3D50C,X</code>
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【メニュー】
		</p>
                <p>
			ウィンドウ「いきかえらせる・どくのちりょう・のろいをとく・やめる」を表示し、入力を待つ。
			プレイヤーの入力が以下のいずれでもない場合は、制御を次に進める。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					キャンセルボタンで抜けた場合は【終了】に制御を進める。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					「いきかえらせる」を選択した場合は、【いきかえらせる】に制御を進める。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					「どくのちりょう」を選択した場合は、【どくのちりょう】に制御を進める。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					「のろいをとく」を選択した場合は、【のろいをとく】に制御を進める。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【終了】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					メッセージ ID を <code class="varname">$C3D540,X</code> からロードし、台詞「では お気をつけて～」を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					サブルーチン呼び出し元に制御を戻す。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【いきかえらせる】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<a class="link" href="dq3_church.html#dq3.church.hack.C3D554" title="5.13.1.4. 「いきかえらせる」サブルーチン">サブルーチン <code class="varname">$D554</code></a> を呼び出し、制御を【ほかに】へ進める。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【どくのちりょう】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<a class="link" href="dq3_church.html#dq3.church.hack.C3D5DD" title="5.13.1.5. 「どくのちりょう」サブルーチン">サブルーチン <code class="varname">$D5DD</code></a> を呼び出し、制御を【ほかに】へ進める。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【のろいをとく】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					<a class="link" href="dq3_church.html#dq3.church.hack.C3D64A" title="5.13.1.6. 「のろいをとく」サブルーチン">サブルーチン <code class="varname">$D64A</code></a> を呼び出し、制御を次（【ほかに】と同じ位置）に進める。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【ほかに】
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					メッセージ ID を <code class="varname">$C3D53C,X</code> からロードし、台詞「ほかにご用は～」を表示する。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					制御を【メニュー】に戻す。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.church.hack.C3D554"></a>5.13.1.4. 「いきかえらせる」サブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$D554</code> は教会処理「いきかえらせる」の実装である。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			メッセージ ID を <code class="varname">$C3D510,X</code> からロードし、
			メッセージ表示サブルーチンを呼び出すことで、
			台詞「どなたをこの世へ呼びもどすのじゃな？」を言わせる。
		</p>
              </li>
              <li class="listitem">
                <p>
			「だれを」ウィンドウを表示して、プレイヤーの入力を待つ。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					キャンセルボタンを押したときには、
					メッセージ ID を <code class="varname">$C3D538,X</code> からロードし、
					メッセージ表示サブルーチンを呼び出すことで、
					台詞「なんとやめると申されるか」を言わせる。
					その後、サブルーチン呼び出し元に制御を戻す。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					パーティのメンバーを選択したときは、制御を次へ進める。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			選択メンバーの生死状態を示すビットをテストするために
			汎用サブルーチン <code class="varname">$C43F87</code> を呼び出し、<code class="varname">A</code> レジスタの値の <code class="literal">0010h</code> の位を見る。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					もしビットが立っていない場合、
					メッセージ ID を <code class="varname">$C3D514,X</code> からロードし、
					メッセージ表示サブルーチンを呼び出すことで、
					台詞「○○どのは生きていらっしゃる」を言わせる。
					その後、サブルーチン呼び出し元に制御を戻す。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					ビットが立っている場合は、次へ制御を進める。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			<a class="link" href="dq3_church.html#dq3.church.hack.C3D700" title="5.13.1.8. 「いきかえらせる」- 寄付金計算サブルーチン">サブルーチン <code class="varname">$C3D700</code></a> 呼び出しにより、寄付金を設定する。
		</p>
              </li>
              <li class="listitem">
                <p>
			<a class="link" href="dq3_church.html#dq3.church.hack.C3D6B7" title="5.13.1.7. 「寄付をよろしいかな」サブルーチン">サブルーチン <code class="varname">$C3D6B7</code></a> 呼び出しにより、寄付をよろしいかな処理を走らせる。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					寄付を支払っていない場合、制御をサブルーチン呼び出し元に戻す。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					寄付を支払った場合は、制御を次へ進める。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			汎用サブルーチン <code class="varname">$C44045</code> 呼び出しにより、
			選択メンバーの（少なくとも）死亡状態フラグをセットする
			（詳細未調査）。
		</p>
              </li>
              <li class="listitem">
                <p>
			汎用サブルーチン <code class="varname">$C43231</code> 呼び出しにより、
			選択メンバーの HP を最大 HP と同じにする
			（詳細未調査）。
		</p>
              </li>
              <li class="listitem">
                <p>
			汎用サブルーチン <code class="varname">$C43337</code> 呼び出しにより、
			選択メンバーの MP を最大 MP と同じにする
			（詳細未調査）。
		</p>
              </li>
              <li class="listitem">
                <p>
			メッセージ ID を <code class="varname">$C3D518,X</code> からロードし、
			メッセージ表示サブルーチンを呼び出すことで、
			台詞「おお わが主よ！全知全能の神よ！」を言わせる。
		</p>
              </li>
              <li class="listitem">
                <p>
			例の効果音を鳴らす。鳴り終わったら、制御を次へ進める。
		</p>
              </li>
              <li class="listitem">
                <p>
			サブルーチン <code class="varname">$C3BD64</code> を呼び出す。
			パーティの描画を更新するものと思われるが未調査。
		</p>
              </li>
              <li class="listitem">
                <p>
			メッセージ ID を <code class="varname">$C3D51C,X</code> からロードし、
			メッセージ表示サブルーチン（ここだけは <code class="varname">$C1A900</code> を用いる）を呼び出すことで、
			「○○は よみがえった！」を表示する。
		</p>
              </li>
              <li class="listitem">
                <p>
			制御をサブルーチン呼び出し元に戻す。
		</p>
              </li>
            </ul>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.church.hack.C3D5DD"></a>5.13.1.5. 「どくのちりょう」サブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$D5DD</code> は教会処理「どくのちりょう」の実装である。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			メッセージ ID を <code class="varname">$C3D520,X</code> からロードし、
			メッセージ表示サブルーチンを呼び出すことで、
			台詞「どなたの毒を とるのじゃな？」を言わせる。
		</p>
              </li>
              <li class="listitem">
                <p>
			「だれを」ウィンドウを表示して、プレイヤーの入力を待つ。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					キャンセルボタンを押したときには、
					メッセージ ID を <code class="varname">$C3D520,X</code> からロードし、
					メッセージ表示サブルーチンを呼び出すことで、
					台詞「なんとやめると申されるか」を言わせる。
					その後、サブルーチン呼び出し元に制御を戻す。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					パーティのメンバーを選択したときは、制御を次へ進める。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			選択メンバーが毒にかかっているかどうかを示すビットをテストするために
			汎用サブルーチン <code class="varname">$C43F87</code> を呼び出し、<code class="varname">A</code> レジスタの値の <code class="literal">0001h</code> の位を見る。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					もしビットが立っていない場合、
					メッセージ ID を <code class="varname">$C3D524,X</code> からロードし、
					メッセージ表示サブルーチンを呼び出すことで、
					台詞「○○どのは毒におかされていませんぞ」を言わせる。
					その後、サブルーチン呼び出し元に制御を戻す。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					ビットが立っている場合は、次へ制御を進める。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			<a class="link" href="dq3_church.html#dq3.church.hack.C3D74C" title="5.13.1.10. 「どくのちりょう」- 寄付金計算サブルーチン">サブルーチン <code class="varname">$C3D74C</code></a> 呼び出しにより、寄付金を設定する。
		</p>
              </li>
              <li class="listitem">
                <p>
			<a class="link" href="dq3_church.html#dq3.church.hack.C3D6B7" title="5.13.1.7. 「寄付をよろしいかな」サブルーチン">サブルーチン <code class="varname">$C3D6B7</code></a> 呼び出しにより、寄付をよろしいかな処理を走らせる。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					寄付を支払っていない場合、制御をサブルーチン呼び出し元に戻す。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					寄付を支払った場合は、制御を次へ進める。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			汎用サブルーチン <code class="varname">$C440B0</code> 呼び出しにより、
			選択メンバーの毒にかかっていることを示すビットをリセットする。
		</p>
              </li>
              <li class="listitem">
                <p>
			メッセージ ID を <code class="varname">$C3D528,X</code> からロードし、
			メッセージ表示サブルーチンを呼び出すことで、
			台詞「おお神よ おちからを！」を言わせる。
		</p>
              </li>
              <li class="listitem">
                <p>
			例の効果音を鳴らす。
			鳴り終わるのを待って、制御をサブルーチン呼び出し元に戻す。
		</p>
              </li>
            </ul>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.church.hack.C3D64A"></a>5.13.1.6. 「のろいをとく」サブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$D64A</code> は教会処理「のろいをとく」の実装である。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			メッセージ ID を <code class="varname">$C3D544,X</code> からロードし、
			メッセージ表示サブルーチンを呼び出すことで、
			台詞「どなたの呪いを とくのじゃな？」を言わせる。
		</p>
              </li>
              <li class="listitem">
                <p>
			「だれを」ウィンドウを表示して、プレイヤーの入力を待つ。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					キャンセルボタンを押したときには、
					メッセージ ID を <code class="varname">$C3D538,X</code> からロードし、
					メッセージ表示サブルーチンを呼び出すことで、
					台詞「なんとやめると申されるか」を言わせる。
					その後、サブルーチン呼び出し元に制御を戻す。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					パーティのメンバーを選択したときは、制御を次へ進める。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			選択メンバーが呪われているかどうかを示すビットをテストするために
			汎用サブルーチン <code class="varname">$C43F87</code> を呼び出し、<code class="varname">A</code> レジスタの値の <code class="literal">0004h</code> の位を見る。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					もしビットが立っていない場合、
					メッセージ ID を <code class="varname">$C3D548,X</code> からロードし、
					メッセージ表示サブルーチンを呼び出すことで、
					台詞「○○どのは呪われてはいませんぞ」を言わせる。
					その後、サブルーチン呼び出し元に制御を戻す。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					ビットが立っている場合は、次へ制御を進める。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			<a class="link" href="dq3_church.html#dq3.church.hack.C3D733" title="5.13.1.9. 「のろいをとく」- 寄付金計算サブルーチン">サブルーチン <code class="varname">$C3D733</code></a> 呼び出しにより、寄付金を設定する。
		</p>
              </li>
              <li class="listitem">
                <p>
			<a class="link" href="dq3_church.html#dq3.church.hack.C3D6B7" title="5.13.1.7. 「寄付をよろしいかな」サブルーチン">サブルーチン <code class="varname">$C3D6B7</code></a> 呼び出しにより、寄付をよろしいかな処理を走らせる。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					寄付を支払っていない場合、制御をサブルーチン呼び出し元に戻す。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					寄付を支払った場合は、制御を次へ進める。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			汎用サブルーチン <code class="varname">$C44168</code> 呼び出しにより、
			選択メンバーの、呪われている状態であることを示すビットをリセットする。
		</p>
              </li>
              <li class="listitem">
                <p>
			メッセージ ID を <code class="varname">$C3D54C,X</code> からロードし、
			メッセージ表示サブルーチンを呼び出すことで、
			台詞「おお神よ おちからを！」を言わせる。
		</p>
              </li>
              <li class="listitem">
                <p>
			例の効果音を鳴らす。
			鳴り終わるのを待って、制御をサブルーチン呼び出し元に戻す。
		</p>
              </li>
            </ul>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.church.hack.C3D6B7"></a>5.13.1.7. 「寄付をよろしいかな」サブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$C3D6B7</code> は、各メニューに共通する寄付要求の実装である。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			メッセージ ID を <code class="varname">$C3D52C,X</code> からロードし、かつ
			呼び出し前に <code class="varname">$70</code> にセット済みの寄付金額を用いて
			メッセージ表示サブルーチンを呼び出すことで、
			台詞「さすれば わが教会に○○ゴールドの ご寄付を」を言わせる。
		</p>
              </li>
              <li class="listitem">
                <p>
			「はい・いいえ」ウィンドウを表示して、プレイヤーの入力を待つ。
			キャンセルボタン抜けもしくは「いいえ」選択の場合、制御を【No】まで進める。
		</p>
              </li>
              <li class="listitem">
                <p>
			汎用サブルーチン <code class="varname">$C45B66</code> に <code class="varname">$70</code> を引数として渡すことと、
			サブルーチン <code class="varname">$C32209</code> 呼び出しによって、
			所持金から寄付金を減じることを試みる。
		</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" style="list-style-type: circle; ">
                    <li class="listitem">
                      <p>
					所持金更新に失敗した場合、
					メッセージ ID を <code class="varname">$C3D530,X</code> からロードし、
					台詞「寄付をするにはお金がたりないでは～」を言わせる。
				</p>
                      <p>
					【Finish】へ制御を進める。
				</p>
                    </li>
                    <li class="listitem">
                      <p>
					所持金更新に成功した場合、制御を呼び出し元に戻す。
					このとき、<code class="varname">Carry</code> ビットはリセットされていることに注意。
				</p>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p>
			【No】
		</p>
                <p>
			メッセージ ID を <code class="varname">$C3D534,X</code> からロードし、
			台詞「教会への寄付は神への感謝の気持ち～」を言わせる。
		</p>
              </li>
              <li class="listitem">
                <p>
			【Finish】
		</p>
                <p>
			<code class="varname">Carry</code> ビットをセットして制御を呼び出し元に戻す。
		</p>
              </li>
            </ul>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.church.hack.C3D700"></a>5.13.1.8. 「いきかえらせる」- 寄付金計算サブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$C3D700</code> は選択したメンバーを生き返らせるための寄付金額を計算する。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			汎用サブルーチン <code class="varname">$C42FEB</code> により、選択メンバーのレベルを <code class="varname">A</code> レジスタにロードする。
		</p>
              </li>
              <li class="listitem">
                <p>
			レベルの値を <code class="varname">A</code> レジスタの上位バイト (<code class="varname">AH</code>) と下位バイト (<code class="varname">AL</code>) に移す。
		</p>
              </li>
              <li class="listitem">
                <p>
			汎用乗算サブルーチン <code class="varname">$C01098</code> により、積 <code class="code">A = AH * AL</code> を計算する。
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">$70 = A</code> とする。
		</p>
              </li>
              <li class="listitem">
                <p>
			汎用除算サブルーチン <code class="varname">$C0121C</code> により、<code class="code">$70 /= 000Ah</code> とする。
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="code">$70 += 1</code> とする。
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="varname">A</code> レジスタに値 <code class="literal">000Ah</code> をロードし、
			汎用乗算サブルーチン <code class="varname">$C010D6</code> により、<code class="code">$70 *= A</code> とする。
		</p>
              </li>
              <li class="listitem">
                <p>
			制御を呼び出し元に戻す。
		</p>
              </li>
            </ul>
          </div>
          <p>
	このことから、生き返らせるための寄付金は、
	<span class="emphasis"><em>(Lv<sup>2</sup> / 10 + 1) * 10</em></span>
	と憶えておけばよいことがわかる。
</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.church.hack.C3D733"></a>5.13.1.9. 「のろいをとく」- 寄付金計算サブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$C3D733</code> は選択したメンバーの呪いを解くために寄付をする金額を計算する。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			汎用サブルーチン <code class="varname">$C42FEB</code> により、選択メンバーのレベルを <code class="varname">A</code> レジスタにロードする。
		</p>
              </li>
              <li class="listitem">
                <p>
			レベルの値を <code class="varname">A</code> レジスタの上位バイト (<code class="varname">AH</code>) に移す。
		</p>
              </li>
              <li class="listitem">
                <p>
			値 <code class="literal">1Eh</code> を <code class="varname">A</code> レジスタの下位バイト (<code class="varname">AL</code>) に移す。
		</p>
              </li>
              <li class="listitem">
                <p>
			汎用乗算サブルーチン <code class="varname">$C01098</code> により、積 <code class="code">A = AH * AL</code> を計算する。
		</p>
              </li>
              <li class="listitem">
                <p>
			<code class="varname">A</code> レジスタにロード済みの積を <code class="varname">$70</code> にロードする。
		</p>
              </li>
              <li class="listitem">
                <p>
			さらに <code class="varname">$72</code> にゼロをロードする。
		</p>
              </li>
              <li class="listitem">
                <p>
			制御を呼び出し元に戻す。
		</p>
              </li>
            </ul>
          </div>
          <p>
	このことから、呪いを解くための寄付金は、
	<span class="emphasis"><em>レベル * 30</em></span>
	と憶えておけばよいことがわかる。
</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="dq3.church.hack.C3D74C"></a>5.13.1.10. 「どくのちりょう」- 寄付金計算サブルーチン</h4>
              </div>
            </div>
          </div>
          <p>
	サブルーチン <code class="varname">$C3D74C</code> は選択したメンバーの解毒をするために寄付をする金額を計算する。
</p>
          <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem">
                <p>
			汎用サブルーチン <code class="varname">$C42FEB</code> により、選択メンバーのレベルを <code class="varname">A</code> レジスタにロードする。
		</p>
              </li>
              <li class="listitem">
                <p>
			値 <code class="code">A &gt;&gt; 2 + 4</code> を <code class="varname">$70</code> にロードする。
		</p>
              </li>
              <li class="listitem">
                <p>
			さらに <code class="varname">$72</code> にゼロをロードする。
		</p>
              </li>
              <li class="listitem">
                <p>
			制御を呼び出し元に戻す。
		</p>
              </li>
            </ul>
          </div>
          <p>
	このことから、毒の治療に必要な寄付金は、
	<span class="emphasis"><em>レベル / 4 + 4</em></span>
	と憶えておけばよいことがわかる。
</p>
        </div>
      </div>
    </div>
    <div class="navigation"><hr /><table><tr><td class="online-navigation"><a href="dq3_inn.html" title="5.12. 宿屋解析"><img src="image/docbook/prev.png" alt="戻る" /></a></td><td class="online-navigation"><a href="dq3.html" title="第 5 章 SFC 版ドラクエ 3 (1996)"><img src="image/docbook/up.png" alt="上に戻る" /></a></td><td class="online-navigation"><a href="dq3_pub.html" title="5.14. ルイーダの酒場解析"><img src="image/docbook/next.png" alt="次へ" /></a></td><td>ドラクエ命</td><td class="online-navigation"><a href="index.html" title="ドラクエ命"><img src="image/docbook/home.png" alt="ホーム" /></a></td><td class="online-navigation"><a href="" title=""><img src="image/docbook/index.png" alt="索引" /></a></td></tr></table><b class="navlabel">Previous: </b><a accesskey="p" class="sectref" href="dq3_inn.html">5.12. 宿屋解析</a> <b class="navlabel">Up: </b><a accesskey="u" class="sectref" href="dq3.html">第 5 章 SFC 版ドラクエ 3 (1996)</a> <b class="navlabel">Next: </b><a accesskey="n" class="sectref" href="dq3_pub.html">5.14. ルイーダの酒場解析</a></div>
  </body>
</html>
